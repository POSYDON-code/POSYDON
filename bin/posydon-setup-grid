#!/usr/bin/env python
"""Setup a POSYDON MESA grid run.

DEPRECATED: This command is deprecated. Please use 'posydon-grid setup' instead.

This script is maintained for backward compatibility and will be removed
in a future version.

Usage:
    posydon-setup-grid --inifile <file> --grid-type <type> [options]

    Preferred alternative:
    posydon-grid setup --inifile <file> --grid-type <type> [options]
"""
import argparse
import os
import sys
import warnings

from posydon.CLI.grids.setup import run_setup


def parse_commandline():
    """Parse the arguments given on the command-line."""
    parser = argparse.ArgumentParser(
        description='Setup a POSYDON MESA grid run.\n\n'
                    'DEPRECATED: Please use "posydon-grid setup" instead.',
        formatter_class=argparse.RawDescriptionHelpFormatter
    )
    parser.add_argument(
        "--inifile",
        help="Name of ini file of params",
        required=True
    )
    parser.add_argument(
        "--grid-type",
        help="Either you are supplying a grid of points to run MESA on (fixed) "
             "or you are supplying a pre-computed MESA grid and want to sample "
             "new points to run MESA on (dynamic).",
        required=True,
        choices=['fixed', 'dynamic']
    )
    parser.add_argument(
        "--run-directory",
        help="Path where executable will be made and MESA simulation output "
             "will be placed",
        default=os.getcwd()
    )
    parser.add_argument(
        "--submission-type",
        help="Options include creating a shell script or a slurm script",
        default='shell',
        choices=['slurm', 'shell']
    )
    parser.add_argument(
        "-n", "--nproc",
        help="Number of processors",
        type=int,
        default=1
    )
    parser.add_argument(
        "-v", "--verbose",
        nargs="?",
        const="console",
        default=None,
        help="Enable verbose logging. Optionally specify a filename to log to "
             "(e.g., -v logfile.txt). If no filename provided, logs to console."
    )

    args = parser.parse_args()

    # Add command attribute for compatibility with run_setup
    args.command = 'setup'

    return args


def main():
    """Main entry point for posydon-setup-grid (deprecated)."""
    warnings.warn(
        "posydon-setup-grid is deprecated and will be removed in a future version. "
        "Please use 'posydon-grid setup' instead.",
        DeprecationWarning,
        stacklevel=2
    )
    print(
        "\033[93mWarning: posydon-setup-grid is deprecated. "
        "Please use 'posydon-grid setup' instead.\033[0m",
        file=sys.stderr
    )

    args = parse_commandline()
    run_setup(args)


if __name__ == '__main__':
    main()
