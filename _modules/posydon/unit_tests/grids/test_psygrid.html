

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>posydon.unit_tests.grids.test_psygrid &mdash; posydon v2.0.0-dev documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/custom.css?v=d66fa8e6" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=f4b7fd8b"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html">
            
              <img src="../../../../_static/posydon_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction-acknowledgements/intro.html">Introduction, Objectives, and Scope</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction-acknowledgements/collaborative-team.html">Collaborative Team</a></li>
<li class="toctree-l1"><a class="reference external" href="https://posydon.org/papers.html">Publications</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting-started/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting-started/installation-guide.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting-started/verification.html">Verification</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../user-guides/user-roadmap.html">Roadmap to Becoming an Expert POSYDON User</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials and Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials-examples/population-synthesis/binary-pop-syn.html">Binary-Star Population Synthesis with POSYDON</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials-examples/generating-datasets/generating-datasets.html">Crafting the Core Datasets for POSYDON</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials-examples/MESA-grids/running-grids.html">Architecting MESA Simulation Grids with POSYDON</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">In-Depth Components Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../components-overview/mesa-grids.html">MESA Grids API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../components-overview/processing-pipeline.html">Processing Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../components-overview/machine-learning-components.html">Machine Learning Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../components-overview/stellar-binary-simulation.html">Stellar &amp; Binary-star Simulation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../api_reference/posydon.html">posydon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api_reference/bin.html">executables</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Troubleshooting and FAQs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../troubleshooting-faqs/installation-issues.html">Installation Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../troubleshooting-faqs/code-questions.html">Code Usage Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing to POSYDON</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/how-to-contribute.html">How To Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/code-style-guidelines.html">Code Style Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/reporting-issues.html">Reporting issues</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Releases and Datasets</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/POSYDON-code/POSYDON/releases">Releases</a></li>
<li class="toctree-l1"><a class="reference external" href="https://zenodo.org/communities/posydon/">Datasets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contact and Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../contact-support/contact-information.html">Contact Information</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">posydon</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">posydon.unit_tests.grids.test_psygrid</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for posydon.unit_tests.grids.test_psygrid</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Unit tests of posydon/grids/psygrid.py</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__authors__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Matthias Kruckow &lt;Matthias.Kruckow@unige.ch&gt;&quot;</span>
<span class="p">]</span>

<span class="c1"># import the module which will be tested</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">posydon.grids.psygrid</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">totest</span>
<span class="c1"># aliases</span>
<span class="n">np</span> <span class="o">=</span> <span class="n">totest</span><span class="o">.</span><span class="n">np</span>
<span class="n">os</span> <span class="o">=</span> <span class="n">totest</span><span class="o">.</span><span class="n">os</span>
<span class="n">h5py</span> <span class="o">=</span> <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span>

<span class="c1"># import other needed code for the tests, which is not already imported in the</span>
<span class="c1"># module you like to test</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pytest</span><span class="w"> </span><span class="kn">import</span> <span class="n">fixture</span><span class="p">,</span> <span class="n">raises</span><span class="p">,</span> <span class="n">warns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">inspect</span><span class="w"> </span><span class="kn">import</span> <span class="n">isclass</span><span class="p">,</span> <span class="n">isroutine</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shutil</span><span class="w"> </span><span class="kn">import</span> <span class="n">rmtree</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">posydon.utils.posydonwarning</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span><span class="n">InappropriateValueWarning</span><span class="p">,</span>\
                                          <span class="n">MissingFilesWarning</span><span class="p">,</span>\
                                          <span class="n">ReplaceValueWarning</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">posydon.grids.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">SINGLE_OUTPUT_FILE</span><span class="p">,</span> <span class="n">BINARY_OUTPUT_FILE</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">posydon.grids.scrubbing</span><span class="w"> </span><span class="kn">import</span> <span class="n">keep_after_RLO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">posydon.utils.common_functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">initialize_empty_array</span>

<span class="c1"># helper functions</span>
<div class="viewcode-block" id="add_MESA_run_files">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.add_MESA_run_files">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">add_MESA_run_files</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">binary_run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_histories</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>\
                       <span class="n">with_profiles</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create files of one MESA run</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path : str</span>
<span class="sd">        The path to the directory containing all the runs.</span>
<span class="sd">    idx : int</span>
<span class="sd">        Run index. (1, 3, 4, 5, 8, 11, 14, and 17 have a special meaning)</span>
<span class="sd">    binary_run : bool (default: True)</span>
<span class="sd">        If `True` files of a binary run are created, otherwise run of a single</span>
<span class="sd">        star.</span>
<span class="sd">    with_histories : bool (default: True)</span>
<span class="sd">        If `True` creates history files.</span>
<span class="sd">    with_profiles : bool (default: True)</span>
<span class="sd">        If `True` creates final profile files.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        Path to the added run.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotADirectoryError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wrong path: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;idx must be an integer&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;idx cannot be negative&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">binary_run</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;binary_run must be a boolean&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">with_histories</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;with_histories must be a boolean&quot;</span><span class="p">)</span>
    <span class="c1"># create files expected from a MESA run</span>
    <span class="n">idx_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="n">idx</span><span class="p">)</span>
    <span class="c1"># get run directory</span>
    <span class="k">if</span> <span class="n">binary_run</span><span class="p">:</span>
        <span class="n">run_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Zbase_0.0142_m1_</span><span class="si">{</span><span class="n">idx_str</span><span class="si">}</span><span class="s2">_m2_0.9000_initial_z_&quot;</span>\
                   <span class="o">+</span><span class="sa">f</span><span class="s2">&quot;1.4200e-02_initial_period_in_days_</span><span class="si">{</span><span class="n">idx_str</span><span class="si">}</span><span class="s2">e-01_&quot;</span>\
                   <span class="o">+</span><span class="sa">f</span><span class="s2">&quot;grid_index_</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;v1&#39;</span><span class="p">:</span> <span class="c1"># v1 name</span>
            <span class="n">run_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;m1_</span><span class="si">{</span><span class="n">idx_str</span><span class="si">}</span><span class="s2">_m2_0.9000_initial_period_in_days_&quot;</span>\
                   <span class="o">+</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">idx_str</span><span class="si">}</span><span class="s2">e-01_grid_index_</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">run_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Zbase_0.0142_initial_mass_</span><span class="si">{</span><span class="n">idx_str</span><span class="si">}</span><span class="s2">_initial_z_&quot;</span>\
                   <span class="o">+</span><span class="sa">f</span><span class="s2">&quot;1.4200e-02_grid_index_</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;v1&#39;</span><span class="p">:</span> <span class="c1"># v1 name</span>
            <span class="n">run_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;initial_mass_</span><span class="si">{</span><span class="n">idx_str</span><span class="si">}</span><span class="s2">_grid_index_</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">run_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">run_name</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">run_path</span><span class="p">)</span>
    <span class="c1"># get MESA output file</span>
    <span class="k">if</span> <span class="n">binary_run</span><span class="p">:</span>
        <span class="n">OUTPUT_FILE</span> <span class="o">=</span> <span class="n">BINARY_OUTPUT_FILE</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">OUTPUT_FILE</span> <span class="o">=</span> <span class="n">SINGLE_OUTPUT_FILE</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">run_path</span><span class="p">,</span> <span class="n">OUTPUT_FILE</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out_file</span><span class="p">:</span>
        <span class="n">out_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># get inlist_grid_points file: containing masses and period</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">run_path</span><span class="p">,</span> <span class="s2">&quot;inlist_grid_points&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span>\
         <span class="n">inlist_file</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">binary_run</span><span class="p">:</span>
            <span class="n">inlist_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&amp;binary_controls</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">!=</span> <span class="mi">20</span><span class="p">:</span>
                <span class="n">inlist_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">m1 = 1.</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">d0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">inlist_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">m2 = 0.9d0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">inlist_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">initial_period_in_days = 1.</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">d-1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># add value to get Z set in case of getting ignored</span>
                <span class="n">inlist_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Z = 0.0142d0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># add fake value</span>
                <span class="n">inlist_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">test = 0.0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">inlist_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;/ ! end of binary_controls namelist&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inlist_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&amp;controls</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">inlist_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">initial_mass = 1.</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">d0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">inlist_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">initial_z = 0.0142d0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">inlist_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Zbase = 0.0142d0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">inlist_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;/ ! end of star_controls namelist&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">binary_run</span> <span class="ow">and</span> <span class="n">with_histories</span> <span class="ow">and</span> <span class="p">(</span><span class="n">idx</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">):</span>
        <span class="c1"># get binary_history.data</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">run_path</span><span class="p">,</span> <span class="s2">&quot;binary_history.data&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>\
             <span class="k">as</span> <span class="n">binary_history_file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
                <span class="c1"># initial values are read from header, rest does not matter</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">names</span> <span class="o">=</span> <span class="s2">&quot;initial_don_mass initial_acc_mass &quot;</span>\
                            <span class="o">+</span><span class="s2">&quot;initial_period_days</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">binary_history_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;             1.</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">              0.9 &quot;</span>\
                           <span class="o">+</span><span class="sa">f</span><span class="s2">&quot;            1.</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">E-01</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">binary_history_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">binary_history_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test HEADER</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># table with column headers and two rows of all the required</span>
            <span class="c1"># columns</span>
            <span class="n">row1</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">row2</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_BINARY_HISTORY_COLS</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(((</span><span class="n">idx</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">idx</span> <span class="o">==</span> <span class="mi">11</span><span class="p">))</span> <span class="ow">and</span>
                    <span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;model_number&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">])):</span>
                    <span class="c1"># skip special columns</span>
                    <span class="k">continue</span>
                <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot; {:&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
                <span class="n">binary_history_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot; {:&gt;&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">idx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;star_1_mass&quot;</span><span class="p">)):</span>
                    <span class="c1"># get a high mass star for stop_before_carbon_depletion</span>
                    <span class="n">row1</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">100</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">row1</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="n">row2</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
                <span class="c1"># add special columns at end for header and first row</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;model_number&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">]):</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot; {:&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
                    <span class="n">binary_history_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot; {:&gt;&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
                    <span class="n">row1</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">!=</span> <span class="mi">14</span><span class="p">:</span>
                <span class="c1"># add data rows</span>
                <span class="n">binary_history_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">row1</span><span class="p">)</span>
                <span class="n">binary_history_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">row2</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">idx</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_BINARY_HISTORY_COLS</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)):</span>
                <span class="c1"># add frist two columns of third row</span>
                <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_BINARY_HISTORY_COLS</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot; {:&gt;&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
                <span class="n">binary_history_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
                <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_BINARY_HISTORY_COLS</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot; {:&gt;&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
                <span class="n">binary_history_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="c1"># get LOGS directories</span>
    <span class="k">if</span> <span class="n">binary_run</span><span class="p">:</span> <span class="c1"># (none, one, two, none, one, two, ...)</span>
        <span class="n">limit_log_dir</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># (none, one, none, one, ...)</span>
        <span class="n">limit_log_dir</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">idx</span><span class="o">%</span><span class="n">limit_log_dir</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">idx</span><span class="o">==</span><span class="mi">17</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">1</span><span class="p">)):</span>
            <span class="k">continue</span>
        <span class="n">logs_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">run_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;LOGS</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">logs_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">with_histories</span><span class="p">:</span>
            <span class="c1"># get history.data</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">logs_path</span><span class="p">,</span> <span class="s2">&quot;history.data&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span>\
                 <span class="n">history_file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
                    <span class="c1"># initial values are read from header, rest does not matter</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">names</span> <span class="o">=</span> <span class="s2">&quot;initial_Z initial_Y initial_m</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="n">history_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">vals</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;   0.0142      0.25       1.</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="n">history_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">history_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test HEADER</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># table with column headers and two rows of all the required</span>
                <span class="c1"># columns (model_number and star_age need to align with the</span>
                <span class="c1"># binary_history.data where they are the first two columns)</span>
                <span class="n">row1</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">row2</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">binary_run</span><span class="p">:</span>
                    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;model_number&quot;</span><span class="p">,</span> <span class="s2">&quot;star_age&quot;</span><span class="p">]</span>\
                           <span class="o">+</span> <span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_STAR_HISTORY_COLS</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cols</span> <span class="o">=</span> <span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_SINGLE_HISTORY_COLS</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(((</span><span class="n">idx</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">idx</span> <span class="o">==</span> <span class="mi">11</span><span class="p">))</span> <span class="ow">and</span>
                        <span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;model_number&quot;</span><span class="p">,</span> <span class="s2">&quot;star_age&quot;</span><span class="p">])):</span>
                        <span class="c1"># skip extra columns</span>
                        <span class="k">continue</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot; {:&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
                    <span class="n">history_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot; {:&gt;&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
                    <span class="n">row1</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s2">&quot;center_h&quot;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
                        <span class="c1"># creates he depletion</span>
                        <span class="n">row2</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">row2</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">binary_run</span> <span class="ow">and</span> <span class="p">(</span><span class="n">idx</span> <span class="o">==</span> <span class="mi">11</span><span class="p">)):</span>
                    <span class="c1"># add extra columns at end for header and first row</span>
                    <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;model_number&quot;</span><span class="p">,</span> <span class="s2">&quot;star_age&quot;</span><span class="p">]):</span>
                        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot; {:&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
                        <span class="n">history_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
                        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot; {:&gt;&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
                        <span class="n">row1</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="o">!=</span> <span class="mi">14</span><span class="p">:</span>
                    <span class="c1"># add data rows</span>
                    <span class="n">history_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">row1</span><span class="p">)</span>
                    <span class="n">history_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">row2</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">idx</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)):</span>
                    <span class="c1"># add frist two columns of third row</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot; {:&gt;&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
                    <span class="n">history_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot; {:&gt;&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
                    <span class="n">history_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">with_profiles</span><span class="p">:</span>
            <span class="c1"># get final_profile.data</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">logs_path</span><span class="p">,</span> <span class="s2">&quot;final_profile.data&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>\
                 <span class="k">as</span> <span class="n">final_profile_file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
                    <span class="c1"># the first 5 lines are skipped</span>
                    <span class="n">final_profile_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test HEADER</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># table with column headers and two rows of all the required</span>
                <span class="c1"># columns</span>
                <span class="n">row1</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">row2</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_PROFILE_COLS</span><span class="p">):</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot; {:&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
                    <span class="n">final_profile_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot; {:&gt;&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
                    <span class="n">row1</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="n">row2</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">final_profile_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">row1</span><span class="p">)</span>
                <span class="n">final_profile_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">row2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">run_path</span></div>


<div class="viewcode-block" id="get_PSyGrid">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.get_PSyGrid">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_PSyGrid</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span> <span class="n">profile</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a PSyGrid file with two runs</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dir_path : str</span>
<span class="sd">        The path to the directory where to create the PSyGrid.</span>
<span class="sd">    idx : int</span>
<span class="sd">        Grid index.</span>
<span class="sd">    binary_history : ndarray</span>
<span class="sd">        Binary history data.</span>
<span class="sd">    star_history : ndarray</span>
<span class="sd">        Star history data.</span>
<span class="sd">    profile : ndarray</span>
<span class="sd">        Final profile data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        Path to the PSyGrid file.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;grid</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">)</span>
    <span class="n">PSyGrid</span> <span class="o">=</span> <span class="n">totest</span><span class="o">.</span><span class="n">PSyGrid</span><span class="p">()</span>
    <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">path</span>
    <span class="n">PSyGrid</span><span class="o">.</span><span class="n">generate_config</span><span class="p">()</span>
    <span class="n">mesa_dir1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s2">&quot;m1_1.0_m2_1.0_initial_period_in_days&quot;</span>\
                                       <span class="o">+</span><span class="s2">&quot;_0.0_initial_z_0.01_idx_0&quot;</span><span class="p">)</span>
    <span class="n">mesa_dir2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s2">&quot;m1_1.0_m2_1.0_initial_period_in_days&quot;</span>\
                                       <span class="o">+</span><span class="s2">&quot;_</span><span class="si">{}</span><span class="s2">_initial_z_0.01_idx_1&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>\
                                        <span class="n">binary_history</span><span class="p">[</span><span class="s1">&#39;period_days&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_file</span><span class="p">:</span>
        <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;/grid/run0/&quot;</span><span class="p">)</span>
        <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;/grid/run1/binary_history&quot;</span><span class="p">,</span>\
                                 <span class="n">data</span><span class="o">=</span><span class="n">binary_history</span><span class="p">)</span>
        <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;/grid/run1/history1&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">star_history</span><span class="p">)</span>
        <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;/grid/run1/history2&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">star_history</span><span class="p">)</span>
        <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;/grid/run1/final_profile1&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">profile</span><span class="p">)</span>
        <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;/grid/run1/final_profile2&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">profile</span><span class="p">)</span>
        <span class="n">ini_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> <span class="p">(</span><span class="n">binary_history</span><span class="p">[</span><span class="s1">&#39;period_days&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])],</span>\
                           <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;period_days&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">)])</span>
        <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;/grid/initial_values&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">ini_val</span><span class="p">)</span>
        <span class="n">fin_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s2">&quot;TF1&quot;</span><span class="p">),</span>\
                            <span class="p">(</span><span class="n">binary_history</span><span class="p">[</span><span class="s1">&#39;period_days&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;TF1&quot;</span><span class="p">)],</span>\
                           <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;period_days&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">),</span>\
                                  <span class="p">(</span><span class="s1">&#39;termination_flag_1&#39;</span><span class="p">,</span>\
                                   <span class="n">totest</span><span class="o">.</span><span class="n">H5_UNICODE_DTYPE</span><span class="p">)])</span>
        <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;/grid/final_values&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">fin_val</span><span class="p">)</span>
        <span class="n">hdf5_file</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">]</span> <span class="o">=</span>\
         <span class="n">totest</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">)))</span>
        <span class="n">rel_paths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">mesa_dir1</span><span class="p">),</span> <span class="p">(</span><span class="n">mesa_dir2</span><span class="p">)],</span>\
                             <span class="n">dtype</span><span class="o">=</span><span class="n">totest</span><span class="o">.</span><span class="n">H5_UNICODE_DTYPE</span><span class="p">)</span>
        <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;relative_file_paths&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">rel_paths</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path</span></div>


<div class="viewcode-block" id="star_history">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.star_history">[docs]</a>
<span class="nd">@fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">star_history</span><span class="p">():</span>
    <span class="c1"># a temporary star history for testing</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.0e+2</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.0e+3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)],</span>\
                    <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;star_age&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;center_he4&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">)])</span></div>


<div class="viewcode-block" id="binary_history">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.binary_history">[docs]</a>
<span class="nd">@fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">binary_history</span><span class="p">():</span>
    <span class="c1"># a temporary binary history for testing</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.0e+2</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.0e+3</span><span class="p">)],</span>\
                    <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;period_days&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">)])</span></div>


<div class="viewcode-block" id="profile">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.profile">[docs]</a>
<span class="nd">@fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">profile</span><span class="p">():</span>
    <span class="c1"># a temporary profile for testing</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0e+3</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.0e+2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)],</span>\
                    <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;mass&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;radius&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">)])</span></div>



<span class="c1"># define test classes collecting several test functions</span>
<div class="viewcode-block" id="TestElements">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestElements</span><span class="p">:</span>
    <span class="c1"># check for objects, which should be an element of the tested module</span>
<div class="viewcode-block" id="TestElements.test_dir">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_dir">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ALL_PROPERTIES&#39;</span><span class="p">,</span> <span class="s1">&#39;Catch_POSYDON_Warnings&#39;</span><span class="p">,</span> <span class="s1">&#39;ConfigFile&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;DEFAULT_BINARY_HISTORY_COLS&#39;</span><span class="p">,</span> <span class="s1">&#39;DEFAULT_EEP_HISTORY_COLS&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;DEFAULT_HISTORY_DS_EXCLUDE&#39;</span><span class="p">,</span> <span class="s1">&#39;DEFAULT_PROFILE_COLS&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;DEFAULT_PROFILE_DS_EXCLUDE&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;DEFAULT_SINGLE_HISTORY_COLS&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;DEFAULT_STAR_HISTORY_COLS&#39;</span><span class="p">,</span> <span class="s1">&#39;EEP_FILE_EXTENSIONS&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;EXTRA_COLS_DS_EXCLUDE&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;EXTRA_STAR_COLS_AT_HE_DEPLETION&#39;</span><span class="p">,</span> <span class="s1">&#39;GRIDPROPERTIES&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;GridError&#39;</span><span class="p">,</span> <span class="s1">&#39;GridReader&#39;</span><span class="p">,</span> <span class="s1">&#39;H5_REC_STR_DTYPE&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;H5_UNICODE_DTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;HDF5_MEMBER_SIZE&#39;</span><span class="p">,</span> <span class="s1">&#39;IgnoreReason&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;N_FLAGS&#39;</span><span class="p">,</span> <span class="s1">&#39;N_FLAGS_SINGLE&#39;</span><span class="p">,</span> <span class="s1">&#39;POSYDONError&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;PROPERTIES_ALLOWED&#39;</span><span class="p">,</span> <span class="s1">&#39;PROPERTIES_TO_BE_CONSISTENT&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;PROPERTIES_TO_BE_NONE&#39;</span><span class="p">,</span> <span class="s1">&#39;PROPERTIES_TO_BE_SET&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;PSyGrid&#39;</span><span class="p">,</span> <span class="s1">&#39;PSyGridIterator&#39;</span><span class="p">,</span> <span class="s1">&#39;PSyRunView&#39;</span><span class="p">,</span> <span class="s1">&#39;Pwarn&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;TERMINATION_FLAG_COLUMNS&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;TERMINATION_FLAG_COLUMNS_SINGLE&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;THRESHOLD_CENTRAL_ABUNDANCE&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;THRESHOLD_CENTRAL_ABUNDANCE_LOOSE_C&#39;</span><span class="p">,</span> <span class="s1">&#39;TrackDownsampler&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;VALID_KEYS&#39;</span><span class="p">,</span> <span class="s1">&#39;WARN_VALUES&#39;</span><span class="p">,</span> <span class="s1">&#39;__authors__&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;__builtins__&#39;</span><span class="p">,</span> <span class="s1">&#39;__cached__&#39;</span><span class="p">,</span> <span class="s1">&#39;__doc__&#39;</span><span class="p">,</span> <span class="s1">&#39;__file__&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;__loader__&#39;</span><span class="p">,</span> <span class="s1">&#39;__name__&#39;</span><span class="p">,</span> <span class="s1">&#39;__package__&#39;</span><span class="p">,</span> <span class="s1">&#39;__spec__&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;add_field&#39;</span><span class="p">,</span> <span class="s1">&#39;ast&#39;</span><span class="p">,</span> <span class="s1">&#39;check_state_from_history&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;check_state_of_star_history_array&#39;</span><span class="p">,</span> <span class="s1">&#39;downsample_history&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;downsample_profile&#39;</span><span class="p">,</span> <span class="s1">&#39;fix_He_core&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;get_detected_initial_RLO&#39;</span><span class="p">,</span> <span class="s1">&#39;get_flag_from_MESA_output&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;get_flags_from_MESA_run&#39;</span><span class="p">,</span> <span class="s1">&#39;get_i_He_depl&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;get_nearest_known_initial_RLO&#39;</span><span class="p">,</span> <span class="s1">&#39;glob&#39;</span><span class="p">,</span> <span class="s1">&#39;h5py&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;infer_interpolation_class&#39;</span><span class="p">,</span> <span class="s1">&#39;infer_star_state&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;initial_values_from_dirname&#39;</span><span class="p">,</span> <span class="s1">&#39;initialize_empty_array&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;join_grids&#39;</span><span class="p">,</span> <span class="s1">&#39;join_lists&#39;</span><span class="p">,</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;keep_after_RLO&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;keep_till_central_abundance_He_C&#39;</span><span class="p">,</span> <span class="s1">&#39;np&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;orbital_separation_from_period&#39;</span><span class="p">,</span> <span class="s1">&#39;os&#39;</span><span class="p">,</span> <span class="s1">&#39;pd&#39;</span><span class="p">,</span> <span class="s1">&#39;plot1D&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;plot2D&#39;</span><span class="p">,</span> <span class="s1">&#39;read_EEP_data_file&#39;</span><span class="p">,</span> <span class="s1">&#39;read_MESA_data_file&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;read_initial_values&#39;</span><span class="p">,</span> <span class="s1">&#39;scrub&#39;</span><span class="p">,</span> <span class="s1">&#39;tqdm&#39;</span><span class="p">}</span>
        <span class="n">totest_elements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">totest</span><span class="p">))</span>
        <span class="n">missing_in_test</span> <span class="o">=</span> <span class="n">elements</span> <span class="o">-</span> <span class="n">totest_elements</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_in_test</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;There are missing objects in &quot;</span>\
                                          <span class="o">+</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">totest</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: &quot;</span>\
                                          <span class="o">+</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">missing_in_test</span><span class="si">}</span><span class="s2">. Please &quot;</span>\
                                          <span class="o">+</span><span class="s2">&quot;check, whether they have been &quot;</span>\
                                          <span class="o">+</span><span class="s2">&quot;removed on purpose and update &quot;</span>\
                                          <span class="o">+</span><span class="s2">&quot;this unit test.&quot;</span>
        <span class="n">new_in_test</span> <span class="o">=</span> <span class="n">totest_elements</span> <span class="o">-</span> <span class="n">elements</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_in_test</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;There are new objects in &quot;</span>\
                                      <span class="o">+</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">totest</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">new_in_test</span><span class="si">}</span><span class="s2">. &quot;</span>\
                                      <span class="o">+</span><span class="s2">&quot;Please check, whether they have been &quot;</span>\
                                      <span class="o">+</span><span class="s2">&quot;added on purpose and update this &quot;</span>\
                                      <span class="o">+</span><span class="s2">&quot;unit test.&quot;</span></div>


<div class="viewcode-block" id="TestElements.test_instance_HDF5_MEMBER_SIZE">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_HDF5_MEMBER_SIZE">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_HDF5_MEMBER_SIZE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">HDF5_MEMBER_SIZE</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>\
               <span class="s2">&quot;HDF5_MEMBER_SIZE is of type: &quot;</span>\
               <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">HDF5_MEMBER_SIZE</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_H5_UNICODE_DTYPE">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_H5_UNICODE_DTYPE">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_H5_UNICODE_DTYPE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">H5_UNICODE_DTYPE</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>\
               <span class="s2">&quot;H5_UNICODE_DTYPE is of type: &quot;</span>\
               <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">H5_UNICODE_DTYPE</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_H5_REC_STR_DTYPE">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_H5_REC_STR_DTYPE">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_H5_REC_STR_DTYPE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">H5_REC_STR_DTYPE</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
               <span class="s2">&quot;H5_REC_STR_DTYPE is of type: &quot;</span>\
               <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">H5_REC_STR_DTYPE</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_VALID_KEYS">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_VALID_KEYS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_VALID_KEYS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">VALID_KEYS</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span>\
               <span class="s2">&quot;VALID_KEYS is of type: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">VALID_KEYS</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_WARN_VALUES">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_WARN_VALUES">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_WARN_VALUES</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">WARN_VALUES</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span>\
               <span class="s2">&quot;WARN_VALUES is of type: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">WARN_VALUES</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_N_FLAGS">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_N_FLAGS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_N_FLAGS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">N_FLAGS</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>\
               <span class="s2">&quot;N_FLAGS is of type: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">N_FLAGS</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_N_FLAGS_SINGLE">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_N_FLAGS_SINGLE">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_N_FLAGS_SINGLE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">N_FLAGS_SINGLE</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>\
               <span class="s2">&quot;N_FLAGS_SINGLE is of type: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">N_FLAGS_SINGLE</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_TERMINATION_FLAG_COLUMNS">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_TERMINATION_FLAG_COLUMNS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_TERMINATION_FLAG_COLUMNS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">TERMINATION_FLAG_COLUMNS</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span>\
               <span class="s2">&quot;TERMINATION_FLAG_COLUMNS is of type: &quot;</span>\
               <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">TERMINATION_FLAG_COLUMNS</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_TERMINATION_FLAG_COLUMNS_SINGLE">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_TERMINATION_FLAG_COLUMNS_SINGLE">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_TERMINATION_FLAG_COLUMNS_SINGLE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">TERMINATION_FLAG_COLUMNS_SINGLE</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span>\
               <span class="s2">&quot;TERMINATION_FLAG_COLUMNS_SINGLE is of type: &quot;</span>\
               <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">TERMINATION_FLAG_COLUMNS_SINGLE</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_DEFAULT_BINARY_HISTORY_COLS">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_DEFAULT_BINARY_HISTORY_COLS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_DEFAULT_BINARY_HISTORY_COLS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_BINARY_HISTORY_COLS</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span>\
               <span class="s2">&quot;DEFAULT_BINARY_HISTORY_COLS is of type: &quot;</span>\
               <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_BINARY_HISTORY_COLS</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_DEFAULT_STAR_HISTORY_COLS">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_DEFAULT_STAR_HISTORY_COLS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_DEFAULT_STAR_HISTORY_COLS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_STAR_HISTORY_COLS</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span>\
               <span class="s2">&quot;DEFAULT_STAR_HISTORY_COLS is of type: &quot;</span>\
               <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_STAR_HISTORY_COLS</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_DEFAULT_SINGLE_HISTORY_COLS">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_DEFAULT_SINGLE_HISTORY_COLS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_DEFAULT_SINGLE_HISTORY_COLS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_SINGLE_HISTORY_COLS</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span>\
               <span class="s2">&quot;DEFAULT_SINGLE_HISTORY_COLS is of type: &quot;</span>\
               <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_SINGLE_HISTORY_COLS</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_DEFAULT_EEP_HISTORY_COLS">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_DEFAULT_EEP_HISTORY_COLS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_DEFAULT_EEP_HISTORY_COLS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_EEP_HISTORY_COLS</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span>\
               <span class="s2">&quot;DEFAULT_EEP_HISTORY_COLS is of type: &quot;</span>\
               <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_EEP_HISTORY_COLS</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_DEFAULT_PROFILE_COLS">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_DEFAULT_PROFILE_COLS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_DEFAULT_PROFILE_COLS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_PROFILE_COLS</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span>\
               <span class="s2">&quot;DEFAULT_PROFILE_COLS is of type: &quot;</span>\
               <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_PROFILE_COLS</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_EXTRA_STAR_COLS_AT_HE_DEPLETION">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_EXTRA_STAR_COLS_AT_HE_DEPLETION">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_EXTRA_STAR_COLS_AT_HE_DEPLETION</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">EXTRA_STAR_COLS_AT_HE_DEPLETION</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span>\
               <span class="s2">&quot;EXTRA_STAR_COLS_AT_HE_DEPLETION is of type: &quot;</span>\
               <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">EXTRA_STAR_COLS_AT_HE_DEPLETION</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_DEFAULT_HISTORY_DS_EXCLUDE">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_DEFAULT_HISTORY_DS_EXCLUDE">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_DEFAULT_HISTORY_DS_EXCLUDE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_HISTORY_DS_EXCLUDE</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span>\
               <span class="s2">&quot;DEFAULT_HISTORY_DS_EXCLUDE is of type: &quot;</span>\
               <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_HISTORY_DS_EXCLUDE</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_DEFAULT_PROFILE_DS_EXCLUDE">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_DEFAULT_PROFILE_DS_EXCLUDE">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_DEFAULT_PROFILE_DS_EXCLUDE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_PROFILE_DS_EXCLUDE</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span>\
               <span class="s2">&quot;DEFAULT_PROFILE_DS_EXCLUDE is of type: &quot;</span>\
               <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_PROFILE_DS_EXCLUDE</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_EXTRA_COLS_DS_EXCLUDE">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_EXTRA_COLS_DS_EXCLUDE">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_EXTRA_COLS_DS_EXCLUDE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">EXTRA_COLS_DS_EXCLUDE</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span>\
               <span class="s2">&quot;EXTRA_COLS_DS_EXCLUDE is of type: &quot;</span>\
               <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">EXTRA_COLS_DS_EXCLUDE</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_GRIDPROPERTIES">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_GRIDPROPERTIES">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_GRIDPROPERTIES</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">GRIDPROPERTIES</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span>\
               <span class="s2">&quot;GRIDPROPERTIES is of type: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">GRIDPROPERTIES</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_PSyGrid">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_PSyGrid">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_PSyGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isclass</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">PSyGrid</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestElements.test_instance_PSyGridIterator">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_PSyGridIterator">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_PSyGridIterator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isclass</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">PSyGridIterator</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestElements.test_instance_PSyRunView">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_PSyRunView">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_PSyRunView</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isclass</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">PSyRunView</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestElements.test_instance_downsample_history">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_downsample_history">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_downsample_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">downsample_history</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestElements.test_instance_downsample_profile">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_downsample_profile">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_downsample_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">downsample_profile</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestElements.test_instance_PROPERTIES_ALLOWED">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_PROPERTIES_ALLOWED">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_PROPERTIES_ALLOWED</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_ALLOWED</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span>\
               <span class="s2">&quot;PROPERTIES_ALLOWED is of type: &quot;</span>\
               <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_ALLOWED</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_PROPERTIES_TO_BE_SET">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_PROPERTIES_TO_BE_SET">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_PROPERTIES_TO_BE_SET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_TO_BE_SET</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span>\
               <span class="s2">&quot;PROPERTIES_TO_BE_SET is of type: &quot;</span>\
               <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_TO_BE_SET</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_PROPERTIES_TO_BE_NONE">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_PROPERTIES_TO_BE_NONE">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_PROPERTIES_TO_BE_NONE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_TO_BE_NONE</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span>\
               <span class="s2">&quot;PROPERTIES_TO_BE_NONE is of type: &quot;</span>\
               <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_TO_BE_NONE</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_PROPERTIES_TO_BE_CONSISTENT">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_PROPERTIES_TO_BE_CONSISTENT">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_PROPERTIES_TO_BE_CONSISTENT</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_TO_BE_CONSISTENT</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span>\
               <span class="s2">&quot;PROPERTIES_TO_BE_CONSISTENT is of type: &quot;</span>\
               <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_TO_BE_CONSISTENT</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_ALL_PROPERTIES">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_ALL_PROPERTIES">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_ALL_PROPERTIES</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">ALL_PROPERTIES</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span>\
               <span class="s2">&quot;ALL_PROPERTIES is of type: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">ALL_PROPERTIES</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestElements.test_instance_join_grids">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestElements.test_instance_join_grids">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_instance_join_grids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">join_grids</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestValues">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestValues</span><span class="p">:</span>
    <span class="c1"># check that the values fit</span>
<div class="viewcode-block" id="TestValues.test_value_HDF5_MEMBER_SIZE">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_HDF5_MEMBER_SIZE">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_HDF5_MEMBER_SIZE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">totest</span><span class="o">.</span><span class="n">HDF5_MEMBER_SIZE</span> <span class="o">==</span> <span class="mi">2147483647</span></div>


<div class="viewcode-block" id="TestValues.test_value_H5_UNICODE_DTYPE">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_H5_UNICODE_DTYPE">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_H5_UNICODE_DTYPE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">totest</span><span class="o">.</span><span class="n">H5_UNICODE_DTYPE</span> <span class="o">==</span> <span class="n">h5py</span><span class="o">.</span><span class="n">string_dtype</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestValues.test_value_H5_REC_STR_DTYPE">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_H5_REC_STR_DTYPE">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_H5_REC_STR_DTYPE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="s2">&quot;S&quot;</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">H5_REC_STR_DTYPE</span></div>


<div class="viewcode-block" id="TestValues.test_value_VALID_KEYS">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_VALID_KEYS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_VALID_KEYS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;binary_history&quot;</span><span class="p">,</span> <span class="s2">&quot;history1&quot;</span><span class="p">,</span> <span class="s2">&quot;history2&quot;</span><span class="p">,</span> <span class="s2">&quot;final_profile1&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;final_profile2&quot;</span><span class="p">,</span> <span class="s2">&quot;initial_values&quot;</span><span class="p">,</span> <span class="s2">&quot;final_values&quot;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">VALID_KEYS</span></div>


<div class="viewcode-block" id="TestValues.test_value_WARN_VALUES">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_WARN_VALUES">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_WARN_VALUES</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="s2">&quot;suppress&quot;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">WARN_VALUES</span></div>


<div class="viewcode-block" id="TestValues.test_value_N_FLAGS">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_N_FLAGS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_N_FLAGS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">totest</span><span class="o">.</span><span class="n">N_FLAGS</span> <span class="o">==</span> <span class="mi">4</span></div>


<div class="viewcode-block" id="TestValues.test_value_N_FLAGS_SINGLE">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_N_FLAGS_SINGLE">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_N_FLAGS_SINGLE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">totest</span><span class="o">.</span><span class="n">N_FLAGS_SINGLE</span> <span class="o">==</span> <span class="mi">2</span></div>


<div class="viewcode-block" id="TestValues.test_value_TERMINATION_FLAG_COLUMNS">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_TERMINATION_FLAG_COLUMNS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_TERMINATION_FLAG_COLUMNS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
            <span class="k">assert</span> <span class="sa">f</span><span class="s2">&quot;termination_flag_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">TERMINATION_FLAG_COLUMNS</span></div>


<div class="viewcode-block" id="TestValues.test_value_TERMINATION_FLAG_COLUMNS_SINGLE">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_TERMINATION_FLAG_COLUMNS_SINGLE">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_TERMINATION_FLAG_COLUMNS_SINGLE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="sa">f</span><span class="s2">&quot;termination_flag_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span>\
                   <span class="n">totest</span><span class="o">.</span><span class="n">TERMINATION_FLAG_COLUMNS_SINGLE</span></div>


<div class="viewcode-block" id="TestValues.test_value_DEFAULT_BINARY_HISTORY_COLS">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_DEFAULT_BINARY_HISTORY_COLS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_DEFAULT_BINARY_HISTORY_COLS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;model_number&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;star_1_mass&quot;</span><span class="p">,</span> <span class="s2">&quot;star_2_mass&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;period_days&quot;</span><span class="p">,</span> <span class="s2">&quot;binary_separation&quot;</span><span class="p">,</span> <span class="s2">&quot;lg_system_mdot_1&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;lg_system_mdot_2&quot;</span><span class="p">,</span> <span class="s2">&quot;lg_wind_mdot_1&quot;</span><span class="p">,</span> <span class="s2">&quot;lg_wind_mdot_2&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;lg_mstar_dot_1&quot;</span><span class="p">,</span> <span class="s2">&quot;lg_mstar_dot_2&quot;</span><span class="p">,</span> <span class="s2">&quot;lg_mtransfer_rate&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;xfer_fraction&quot;</span><span class="p">,</span> <span class="s2">&quot;rl_relative_overflow_1&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;rl_relative_overflow_2&quot;</span><span class="p">,</span> <span class="s2">&quot;trap_radius&quot;</span><span class="p">,</span> <span class="s2">&quot;acc_radius&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;t_sync_rad_1&quot;</span><span class="p">,</span> <span class="s2">&quot;t_sync_conv_1&quot;</span><span class="p">,</span> <span class="s2">&quot;t_sync_rad_2&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;t_sync_conv_2&quot;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_BINARY_HISTORY_COLS</span></div>


<div class="viewcode-block" id="TestValues.test_value_DEFAULT_STAR_HISTORY_COLS">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_DEFAULT_STAR_HISTORY_COLS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_DEFAULT_STAR_HISTORY_COLS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;he_core_mass&quot;</span><span class="p">,</span> <span class="s2">&quot;c_core_mass&quot;</span><span class="p">,</span> <span class="s2">&quot;o_core_mass&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;he_core_radius&quot;</span><span class="p">,</span> <span class="s2">&quot;c_core_radius&quot;</span><span class="p">,</span> <span class="s2">&quot;o_core_radius&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;center_h1&quot;</span><span class="p">,</span> <span class="s2">&quot;center_he4&quot;</span><span class="p">,</span> <span class="s2">&quot;center_c12&quot;</span><span class="p">,</span> <span class="s2">&quot;center_n14&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;center_o16&quot;</span><span class="p">,</span> <span class="s2">&quot;surface_h1&quot;</span><span class="p">,</span> <span class="s2">&quot;surface_he4&quot;</span><span class="p">,</span> <span class="s2">&quot;surface_c12&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;surface_n14&quot;</span><span class="p">,</span> <span class="s2">&quot;surface_o16&quot;</span><span class="p">,</span> <span class="s2">&quot;c12_c12&quot;</span><span class="p">,</span> <span class="s2">&quot;center_gamma&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;avg_c_in_c_core&quot;</span><span class="p">,</span> <span class="s2">&quot;surf_avg_omega&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;surf_avg_omega_div_omega_crit&quot;</span><span class="p">,</span> <span class="s2">&quot;log_LH&quot;</span><span class="p">,</span> <span class="s2">&quot;log_LHe&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;log_LZ&quot;</span><span class="p">,</span> <span class="s2">&quot;log_Lnuc&quot;</span><span class="p">,</span> <span class="s2">&quot;log_Teff&quot;</span><span class="p">,</span> <span class="s2">&quot;log_L&quot;</span><span class="p">,</span> <span class="s2">&quot;log_R&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;log_center_T&quot;</span><span class="p">,</span> <span class="s2">&quot;log_center_Rho&quot;</span><span class="p">,</span> <span class="s2">&quot;total_moment_of_inertia&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;spin_parameter&quot;</span><span class="p">,</span> <span class="s2">&quot;log_total_angular_momentum&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;conv_env_top_mass&quot;</span><span class="p">,</span> <span class="s2">&quot;conv_env_bot_mass&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;conv_env_top_radius&quot;</span><span class="p">,</span> <span class="s2">&quot;conv_env_bot_radius&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;conv_env_turnover_time_g&quot;</span><span class="p">,</span> <span class="s2">&quot;conv_env_turnover_time_l_b&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;conv_env_turnover_time_l_t&quot;</span><span class="p">,</span> <span class="s2">&quot;envelope_binding_energy&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;mass_conv_reg_fortides&quot;</span><span class="p">,</span> <span class="s2">&quot;thickness_conv_reg_fortides&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;radius_conv_reg_fortides&quot;</span><span class="p">,</span> <span class="s2">&quot;lambda_CE_1cent&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;lambda_CE_10cent&quot;</span><span class="p">,</span> <span class="s2">&quot;lambda_CE_30cent&quot;</span><span class="p">,</span> <span class="s2">&quot;co_core_mass&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;co_core_radius&quot;</span><span class="p">,</span> <span class="s2">&quot;lambda_CE_pure_He_star_10cent&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;log_L_div_Ledd&quot;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_STAR_HISTORY_COLS</span></div>


<div class="viewcode-block" id="TestValues.test_value_DEFAULT_SINGLE_HISTORY_COLS">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_DEFAULT_SINGLE_HISTORY_COLS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_DEFAULT_SINGLE_HISTORY_COLS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;model_number&quot;</span><span class="p">,</span> <span class="s2">&quot;star_age&quot;</span><span class="p">,</span> <span class="s2">&quot;star_mass&quot;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_SINGLE_HISTORY_COLS</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_STAR_HISTORY_COLS</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_SINGLE_HISTORY_COLS</span></div>


<div class="viewcode-block" id="TestValues.test_value_DEFAULT_EEP_HISTORY_COLS">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_DEFAULT_EEP_HISTORY_COLS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_DEFAULT_EEP_HISTORY_COLS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;star_age&quot;</span><span class="p">,</span> <span class="s2">&quot;star_mass&quot;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_EEP_HISTORY_COLS</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_STAR_HISTORY_COLS</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_EEP_HISTORY_COLS</span></div>


<div class="viewcode-block" id="TestValues.test_value_DEFAULT_PROFILE_COLS">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_DEFAULT_PROFILE_COLS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_DEFAULT_PROFILE_COLS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">,</span> <span class="s2">&quot;mass&quot;</span><span class="p">,</span> <span class="s2">&quot;logRho&quot;</span><span class="p">,</span> <span class="s2">&quot;omega&quot;</span><span class="p">,</span> <span class="s2">&quot;energy&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;x_mass_fraction_H&quot;</span><span class="p">,</span> <span class="s2">&quot;y_mass_fraction_He&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;z_mass_fraction_metals&quot;</span><span class="p">,</span> <span class="s2">&quot;neutral_fraction_H&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;neutral_fraction_He&quot;</span><span class="p">,</span> <span class="s2">&quot;avg_charge_He&quot;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_PROFILE_COLS</span></div>


<div class="viewcode-block" id="TestValues.test_value_EXTRA_STAR_COLS_AT_HE_DEPLETION">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_EXTRA_STAR_COLS_AT_HE_DEPLETION">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_EXTRA_STAR_COLS_AT_HE_DEPLETION</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;avg_c_in_c_core&quot;</span><span class="p">,</span> <span class="s2">&quot;co_core_mass&quot;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">EXTRA_STAR_COLS_AT_HE_DEPLETION</span></div>


<div class="viewcode-block" id="TestValues.test_value_DEFAULT_HISTORY_DS_EXCLUDE">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_DEFAULT_HISTORY_DS_EXCLUDE">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_DEFAULT_HISTORY_DS_EXCLUDE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;model_number&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;star_age&quot;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_HISTORY_DS_EXCLUDE</span></div>


<div class="viewcode-block" id="TestValues.test_value_DEFAULT_PROFILE_DS_EXCLUDE">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_DEFAULT_PROFILE_DS_EXCLUDE">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_DEFAULT_PROFILE_DS_EXCLUDE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;mass&quot;</span><span class="p">,</span> <span class="s2">&quot;star_mass&quot;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_PROFILE_DS_EXCLUDE</span></div>


<div class="viewcode-block" id="TestValues.test_value_EXTRA_COLS_DS_EXCLUDE">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_EXTRA_COLS_DS_EXCLUDE">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_EXTRA_COLS_DS_EXCLUDE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;acc_radius&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;avg_charge_He&quot;</span><span class="p">,</span> <span class="s2">&quot;c12_c12&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;c_core_radius&quot;</span><span class="p">,</span> <span class="s2">&quot;center_c12&quot;</span><span class="p">,</span> <span class="s2">&quot;center_gamma&quot;</span><span class="p">,</span> <span class="s2">&quot;center_n14&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;center_o16&quot;</span><span class="p">,</span> <span class="s2">&quot;co_core_radius&quot;</span><span class="p">,</span> <span class="s2">&quot;conv_env_bot_mass&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;conv_env_bot_radius&quot;</span><span class="p">,</span> <span class="s2">&quot;conv_env_top_mass&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;conv_env_top_radius&quot;</span><span class="p">,</span> <span class="s2">&quot;conv_env_turnover_time_g&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;conv_env_turnover_time_l_b&quot;</span><span class="p">,</span> <span class="s2">&quot;conv_env_turnover_time_l_t&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;envelope_binding_energy&quot;</span><span class="p">,</span> <span class="s2">&quot;he_core_radius&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;lambda_CE_10cent&quot;</span><span class="p">,</span> <span class="s2">&quot;lambda_CE_1cent&quot;</span><span class="p">,</span> <span class="s2">&quot;lambda_CE_30cent&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;lambda_CE_pure_He_star_10cent&quot;</span><span class="p">,</span> <span class="s2">&quot;lg_mstar_dot_1&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;lg_mstar_dot_2&quot;</span><span class="p">,</span> <span class="s2">&quot;lg_wind_mdot_1&quot;</span><span class="p">,</span> <span class="s2">&quot;lg_wind_mdot_2&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;log_LH&quot;</span><span class="p">,</span> <span class="s2">&quot;log_LHe&quot;</span><span class="p">,</span> <span class="s2">&quot;log_LZ&quot;</span><span class="p">,</span> <span class="s2">&quot;log_Lnuc&quot;</span><span class="p">,</span> <span class="s2">&quot;mass&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;mass_conv_reg_fortides&quot;</span><span class="p">,</span> <span class="s2">&quot;model_number&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;neutral_fraction_H&quot;</span><span class="p">,</span> <span class="s2">&quot;neutral_fraction_He&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;o_core_radius&quot;</span><span class="p">,</span> <span class="s2">&quot;radius_conv_reg_fortides&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;rl_relative_overflow_1&quot;</span><span class="p">,</span> <span class="s2">&quot;rl_relative_overflow_2&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;spin_parameter&quot;</span><span class="p">,</span> <span class="s2">&quot;star_age&quot;</span><span class="p">,</span> <span class="s2">&quot;star_mass&quot;</span><span class="p">,</span> <span class="s2">&quot;surf_avg_omega&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;surf_avg_omega_div_omega_crit&quot;</span><span class="p">,</span> <span class="s2">&quot;surface_c12&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;surface_h1&quot;</span><span class="p">,</span> <span class="s2">&quot;surface_he4&quot;</span><span class="p">,</span> <span class="s2">&quot;surface_n14&quot;</span><span class="p">,</span> <span class="s2">&quot;surface_o16&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;t_sync_conv_1&quot;</span><span class="p">,</span> <span class="s2">&quot;t_sync_conv_2&quot;</span><span class="p">,</span> <span class="s2">&quot;t_sync_rad_1&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;t_sync_rad_2&quot;</span><span class="p">,</span> <span class="s2">&quot;thickness_conv_reg_fortides&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;trap_radius&quot;</span><span class="p">,</span> <span class="s2">&quot;x_mass_fraction_H&quot;</span><span class="p">,</span> <span class="s2">&quot;xfer_fraction&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;y_mass_fraction_He&quot;</span><span class="p">,</span> <span class="s2">&quot;z_mass_fraction_metals&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;log_L_div_Ledd&quot;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">EXTRA_COLS_DS_EXCLUDE</span></div>


<div class="viewcode-block" id="TestValues.test_value_GRIDPROPERTIES">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_GRIDPROPERTIES">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_GRIDPROPERTIES</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="s2">&quot;compression&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;star1_history_saved_columns&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;star2_history_saved_columns&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;binary_history_saved_columns&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;star1_profile_saved_columns&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;star2_profile_saved_columns&quot;</span><span class="p">,</span> <span class="s2">&quot;eep&quot;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">GRIDPROPERTIES</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">GRIDPROPERTIES</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;max_number_of_runs&quot;</span><span class="p">,</span> <span class="s2">&quot;history_DS_error&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;profile_DS_error&quot;</span><span class="p">,</span> <span class="s2">&quot;profile_DS_interval&quot;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">GRIDPROPERTIES</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">GRIDPROPERTIES</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span>\
                                                         <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;history_DS_exclude&quot;</span><span class="p">,</span> <span class="s2">&quot;profile_DS_exclude&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;initial_value_columns&quot;</span><span class="p">,</span> <span class="s2">&quot;final_value_columns&quot;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">GRIDPROPERTIES</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">GRIDPROPERTIES</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;start_at_RLO&quot;</span><span class="p">,</span> <span class="s2">&quot;stop_before_carbon_depletion&quot;</span><span class="p">,</span> <span class="s2">&quot;binary&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;initial_RLO_fix&quot;</span><span class="p">,</span> <span class="s2">&quot;He_core_fix&quot;</span><span class="p">,</span> <span class="s2">&quot;accept_missing_profile&quot;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">GRIDPROPERTIES</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">GRIDPROPERTIES</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span></div>


<div class="viewcode-block" id="TestValues.test_value_PROPERTIES_ALLOWED">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_PROPERTIES_ALLOWED">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_PROPERTIES_ALLOWED</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_ALLOWED</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_ALLOWED</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestValues.test_value_PROPERTIES_TO_BE_SET">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_PROPERTIES_TO_BE_SET">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_PROPERTIES_TO_BE_SET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_TO_BE_SET</span></div>


<div class="viewcode-block" id="TestValues.test_value_PROPERTIES_TO_BE_NONE">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_PROPERTIES_TO_BE_NONE">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_PROPERTIES_TO_BE_NONE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;max_number_of_runs&quot;</span><span class="p">,</span> <span class="s2">&quot;star1_history_saved_columns&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;star2_history_saved_columns&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;binary_history_saved_columns&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;star1_profile_saved_columns&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;star2_profile_saved_columns&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;initial_value_columns&quot;</span><span class="p">,</span> <span class="s2">&quot;final_value_columns&quot;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_TO_BE_NONE</span>
            <span class="k">assert</span> <span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_TO_BE_NONE</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="TestValues.test_value_PROPERTIES_TO_BE_CONSISTENT">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_PROPERTIES_TO_BE_CONSISTENT">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_PROPERTIES_TO_BE_CONSISTENT</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span> <span class="s2">&quot;eep&quot;</span><span class="p">,</span> <span class="s2">&quot;start_at_RLO&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;stop_before_carbon_depletion&quot;</span><span class="p">,</span> <span class="s2">&quot;initial_RLO_fix&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;He_core_fix&quot;</span><span class="p">,</span> <span class="s2">&quot;accept_missing_profile&quot;</span><span class="p">,</span> <span class="s2">&quot;history_DS_error&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;history_DS_exclude&quot;</span><span class="p">,</span> <span class="s2">&quot;profile_DS_error&quot;</span><span class="p">,</span>\
                  <span class="s2">&quot;profile_DS_exclude&quot;</span><span class="p">,</span> <span class="s2">&quot;profile_DS_interval&quot;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_TO_BE_CONSISTENT</span></div>


<div class="viewcode-block" id="TestValues.test_value_ALL_PROPERTIES">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestValues.test_value_ALL_PROPERTIES">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_ALL_PROPERTIES</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_ALLOWED</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">ALL_PROPERTIES</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_TO_BE_CONSISTENT</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">ALL_PROPERTIES</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_TO_BE_NONE</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">ALL_PROPERTIES</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_TO_BE_SET</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">ALL_PROPERTIES</span></div>
</div>



<div class="viewcode-block" id="TestFunctions">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestFunctions">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestFunctions</span><span class="p">:</span>
<div class="viewcode-block" id="TestFunctions.ConfigFile">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestFunctions.ConfigFile">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ConfigFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># a ConfigFile object for testing</span>
        <span class="n">configfile</span> <span class="o">=</span> <span class="n">totest</span><span class="o">.</span><span class="n">ConfigFile</span><span class="p">()</span>
        <span class="n">configfile</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="s2">&quot;binary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">configfile</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="s2">&quot;history_DS_error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">configfile</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="s2">&quot;history_DS_exclude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">configfile</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="s2">&quot;profile_DS_error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">configfile</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="s2">&quot;profile_DS_exclude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">configfile</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="s2">&quot;profile_DS_interval&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">configfile</span></div>


<div class="viewcode-block" id="TestFunctions.no_path">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestFunctions.no_path">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">no_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">):</span>
        <span class="c1"># a path which does not exist for testing</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;does_not_exist.test&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestFunctions.h5_out_path">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestFunctions.h5_out_path">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">h5_out_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">):</span>
        <span class="c1"># a path to write to</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;out.h5&quot;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="TestFunctions.grid1_path">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestFunctions.grid1_path">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">grid1_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span> <span class="n">profile</span><span class="p">):</span>
        <span class="c1"># a path to a psygrid file for testing</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">get_PSyGrid</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span>
        <span class="c1"># modify hdf5 file: &#39;ignored_no_RLO&#39; flag</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_file</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">hdf5_file</span><span class="p">[</span><span class="s2">&quot;/grid/final_values&quot;</span><span class="p">]</span>
            <span class="n">fin_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s2">&quot;TF1&quot;</span><span class="p">),</span>\
                                <span class="p">(</span><span class="n">binary_history</span><span class="p">[</span><span class="s1">&#39;period_days&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> \
                                 <span class="s2">&quot;ignored_no_RLO&quot;</span><span class="p">)],</span>\
                               <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;period_days&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">),</span>\
                                      <span class="p">(</span><span class="s1">&#39;termination_flag_1&#39;</span><span class="p">,</span>\
                                       <span class="n">totest</span><span class="o">.</span><span class="n">H5_UNICODE_DTYPE</span><span class="p">)])</span>
            <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;/grid/final_values&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">fin_val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span></div>


<div class="viewcode-block" id="TestFunctions.grid2_path">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestFunctions.grid2_path">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">grid2_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span> <span class="n">profile</span><span class="p">):</span>
        <span class="c1"># a path to a psygrid file for testing</span>
        <span class="k">return</span> <span class="n">get_PSyGrid</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestFunctions.grid_path_bad_ini">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestFunctions.grid_path_bad_ini">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">grid_path_bad_ini</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span>\
                          <span class="n">profile</span><span class="p">):</span>
        <span class="c1"># a path to a psygrid file for testing</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">get_PSyGrid</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span>
        <span class="c1"># modify hdf5 file: &#39;bad&#39; in initial_values</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_file</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">hdf5_file</span><span class="p">[</span><span class="s2">&quot;/grid/initial_values&quot;</span><span class="p">]</span>
            <span class="n">ini_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> <span class="p">(</span><span class="n">binary_history</span><span class="p">[</span><span class="s1">&#39;period_days&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])],</span>\
                               <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;bad&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">)])</span>
            <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;/grid/initial_values&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">ini_val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span></div>


<div class="viewcode-block" id="TestFunctions.grid_path_bad_fin">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestFunctions.grid_path_bad_fin">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">grid_path_bad_fin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span>\
                          <span class="n">profile</span><span class="p">):</span>
        <span class="c1"># a path to a psygrid file for testing</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">get_PSyGrid</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span>
        <span class="c1"># modify hdf5 file: &#39;termination_flag_bad&#39; in final_values</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_file</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">hdf5_file</span><span class="p">[</span><span class="s2">&quot;/grid/final_values&quot;</span><span class="p">]</span>
            <span class="n">fin_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s2">&quot;TF1&quot;</span><span class="p">),</span>\
                                <span class="p">(</span><span class="n">binary_history</span><span class="p">[</span><span class="s1">&#39;period_days&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;TF1&quot;</span><span class="p">)],</span>\
                               <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;period_days&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">),</span>\
                                      <span class="p">(</span><span class="s1">&#39;termination_flag_bad&#39;</span><span class="p">,</span>\
                                       <span class="n">totest</span><span class="o">.</span><span class="n">H5_UNICODE_DTYPE</span><span class="p">)])</span>
            <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;/grid/final_values&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">fin_val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span></div>


<div class="viewcode-block" id="TestFunctions.grid_path_start_RLO">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestFunctions.grid_path_start_RLO">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">grid_path_start_RLO</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span>\
                            <span class="n">profile</span><span class="p">):</span>
        <span class="c1"># a path to a psygrid file for testing</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">get_PSyGrid</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span>
        <span class="c1"># modify hdf5 file: replace &#39;start_at_RLO&#39; in config</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_file</span><span class="p">:</span>
            <span class="n">old_text</span> <span class="o">=</span> <span class="s2">&quot;&#39;start_at_RLO&#39;: False&quot;</span>
            <span class="n">new_text</span> <span class="o">=</span> <span class="s2">&quot;&#39;start_at_RLO&#39;: True&quot;</span>
            <span class="n">newconfig</span> <span class="o">=</span> <span class="n">hdf5_file</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old_text</span><span class="p">,</span> <span class="n">new_text</span><span class="p">)</span>
            <span class="n">hdf5_file</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newconfig</span>
        <span class="k">return</span> <span class="n">path</span></div>


<div class="viewcode-block" id="TestFunctions.grid_path_initial_RLO">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestFunctions.grid_path_initial_RLO">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">grid_path_initial_RLO</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span>\
                              <span class="n">profile</span><span class="p">):</span>
        <span class="c1"># a path to a psygrid file for testing</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;grid_initial_RLO.h5&quot;</span><span class="p">)</span>
        <span class="n">PSyGrid</span> <span class="o">=</span> <span class="n">totest</span><span class="o">.</span><span class="n">PSyGrid</span><span class="p">()</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">path</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">generate_config</span><span class="p">()</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;UnitTest1&quot;</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;initial_RLO_fix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ini_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>\
                            <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">[</span><span class="s1">&#39;period_days&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>\
                            <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>\
                            <span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)],</span>\
                           <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;star_1_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">),</span>\
                                  <span class="p">(</span><span class="s1">&#39;star_2_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">),</span>\
                                  <span class="p">(</span><span class="s1">&#39;period_days&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">)])</span>
        <span class="n">mesa_dir</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;m1_1.0_m2_1.0_initial_period_in_&quot;</span>\
                                           <span class="o">+</span><span class="s2">&quot;days_0.0_initial_z_0.01_idx_0&quot;</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
            <span class="n">m1</span> <span class="o">=</span> <span class="n">ini_val</span><span class="p">[</span><span class="s1">&#39;star_1_mass&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="n">ini_val</span><span class="p">[</span><span class="s1">&#39;star_2_mass&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">ini_val</span><span class="p">[</span><span class="s1">&#39;period_days&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">mesa_dir</span> <span class="o">+=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;m1_</span><span class="si">{</span><span class="n">m1</span><span class="si">}</span><span class="s2">_m2_</span><span class="si">{</span><span class="n">m2</span><span class="si">}</span><span class="s2">_initial_&quot;</span>\
                                                <span class="o">+</span><span class="sa">f</span><span class="s2">&quot;period_in_days_</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">_&quot;</span>\
                                                <span class="o">+</span><span class="sa">f</span><span class="s2">&quot;initial_z_0.01_idx_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)]</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_file</span><span class="p">:</span>
            <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;/grid/run0/&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
                <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/grid/run</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">/binary_history&quot;</span><span class="p">,</span>\
                                         <span class="n">data</span><span class="o">=</span><span class="n">binary_history</span><span class="p">)</span>
                <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/grid/run</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">/history1&quot;</span><span class="p">,</span>\
                                         <span class="n">data</span><span class="o">=</span><span class="n">star_history</span><span class="p">)</span>
                <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/grid/run</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">/history2&quot;</span><span class="p">,</span>\
                                         <span class="n">data</span><span class="o">=</span><span class="n">star_history</span><span class="p">)</span>
                <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/grid/run</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">/final_profile1&quot;</span><span class="p">,</span>\
                                         <span class="n">data</span><span class="o">=</span><span class="n">profile</span><span class="p">)</span>
                <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/grid/run</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">/final_profile2&quot;</span><span class="p">,</span>\
                                         <span class="n">data</span><span class="o">=</span><span class="n">profile</span><span class="p">)</span>
            <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;/grid/initial_values&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">ini_val</span><span class="p">)</span>
            <span class="n">fin_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s2">&quot;TF1&quot;</span><span class="p">,</span> <span class="s2">&quot;TF2&quot;</span><span class="p">,</span> <span class="s2">&quot;TF3&quot;</span><span class="p">,</span>\
                                 <span class="s2">&quot;TF4&quot;</span><span class="p">,</span> <span class="s2">&quot;IC&quot;</span><span class="p">),</span>\
                                <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">[</span><span class="s1">&#39;period_days&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>\
                                 <span class="s2">&quot;TF1&quot;</span><span class="p">,</span> <span class="s2">&quot;TF2&quot;</span><span class="p">,</span> <span class="s2">&quot;TF3&quot;</span><span class="p">,</span> <span class="s2">&quot;TF4&quot;</span><span class="p">,</span> <span class="s2">&quot;IC&quot;</span><span class="p">),</span>\
                                <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;Terminate because of &quot;</span>\
                                                <span class="o">+</span><span class="s2">&quot;overflowing initial model&quot;</span><span class="p">,</span>\
                                 <span class="s2">&quot;iRLOTF2&quot;</span><span class="p">,</span> <span class="s2">&quot;iRLOTF3&quot;</span><span class="p">,</span> <span class="s2">&quot;iRLOTF4&quot;</span><span class="p">,</span> <span class="s2">&quot;IC&quot;</span><span class="p">),</span>\
                                <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;forced_initial_RLO&quot;</span><span class="p">,</span>\
                                 <span class="s2">&quot;fRLOTF2&quot;</span><span class="p">,</span> <span class="s2">&quot;fRLOTF3&quot;</span><span class="p">,</span> <span class="s2">&quot;fRLOTF4&quot;</span><span class="p">,</span> <span class="s2">&quot;IC&quot;</span><span class="p">),</span>\
                                <span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;TF1&quot;</span><span class="p">,</span> <span class="s2">&quot;TF2&quot;</span><span class="p">,</span> <span class="s2">&quot;TF3&quot;</span><span class="p">,</span> <span class="s2">&quot;TF4&quot;</span><span class="p">,</span>\
                                 <span class="s2">&quot;IC&quot;</span><span class="p">),</span>\
                                <span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;TF1&quot;</span><span class="p">,</span> <span class="s2">&quot;TF2&quot;</span><span class="p">,</span> <span class="s2">&quot;TF3&quot;</span><span class="p">,</span> <span class="s2">&quot;TF4&quot;</span><span class="p">,</span>\
                                 <span class="s2">&quot;IC&quot;</span><span class="p">)],</span>\
                               <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;star_1_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">),</span>\
                                      <span class="p">(</span><span class="s1">&#39;star_2_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">),</span>\
                                      <span class="p">(</span><span class="s1">&#39;period_days&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">),</span>\
                                      <span class="p">(</span><span class="s1">&#39;termination_flag_1&#39;</span><span class="p">,</span>\
                                       <span class="n">totest</span><span class="o">.</span><span class="n">H5_UNICODE_DTYPE</span><span class="p">),</span>\
                                      <span class="p">(</span><span class="s1">&#39;termination_flag_2&#39;</span><span class="p">,</span>\
                                       <span class="n">totest</span><span class="o">.</span><span class="n">H5_UNICODE_DTYPE</span><span class="p">),</span>\
                                      <span class="p">(</span><span class="s1">&#39;termination_flag_3&#39;</span><span class="p">,</span>\
                                       <span class="n">totest</span><span class="o">.</span><span class="n">H5_UNICODE_DTYPE</span><span class="p">),</span>\
                                      <span class="p">(</span><span class="s1">&#39;termination_flag_4&#39;</span><span class="p">,</span>\
                                       <span class="n">totest</span><span class="o">.</span><span class="n">H5_UNICODE_DTYPE</span><span class="p">),</span>\
                                      <span class="p">(</span><span class="s1">&#39;interpolation_class&#39;</span><span class="p">,</span>\
                                       <span class="n">totest</span><span class="o">.</span><span class="n">H5_UNICODE_DTYPE</span><span class="p">)])</span>
            <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;/grid/final_values&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">fin_val</span><span class="p">)</span>
            <span class="n">hdf5_file</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">]</span> <span class="o">=</span>\
             <span class="n">totest</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">)))</span>
            <span class="n">rel_paths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">mesa_dir</span><span class="p">],</span>\
                                 <span class="n">dtype</span><span class="o">=</span><span class="n">totest</span><span class="o">.</span><span class="n">H5_UNICODE_DTYPE</span><span class="p">)</span>
            <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;relative_file_paths&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">rel_paths</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span></div>


    <span class="c1"># test functions</span>
<div class="viewcode-block" id="TestFunctions.test_downsample_history">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestFunctions.test_downsample_history">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_downsample_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ConfigFile</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span>\
                                <span class="n">binary_history</span><span class="p">):</span>
        <span class="c1"># missing argument</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;missing 4 required positional &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;arguments: &#39;bh&#39;, &#39;h1&#39;, &#39;h2&#39;, and &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;&#39;params&#39;&quot;</span><span class="p">):</span>
            <span class="n">totest</span><span class="o">.</span><span class="n">downsample_history</span><span class="p">()</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;&#39;NoneType&#39; object is not subscriptable&quot;</span><span class="p">):</span>
            <span class="n">totest</span><span class="o">.</span><span class="n">downsample_history</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># examples: failed</span>
        <span class="k">for</span> <span class="n">bh</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">h1</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">star_history</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">h2</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">star_history</span><span class="p">]:</span>
                    <span class="k">assert</span> <span class="n">totest</span><span class="o">.</span><span class="n">downsample_history</span><span class="p">(</span><span class="n">bh</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">,</span> <span class="n">ConfigFile</span><span class="p">)</span>\
                           <span class="o">==</span> <span class="p">(</span><span class="n">bh</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">)</span>
        <span class="n">ConfigFile</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="s2">&quot;history_DS_error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="k">assert</span> <span class="n">totest</span><span class="o">.</span><span class="n">downsample_history</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ConfigFile</span><span class="p">)</span> <span class="o">==</span>\
               <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># bad input</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[(</span><span class="n">bh</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">)</span> <span class="k">for</span> <span class="n">bh</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span>\
                                         <span class="n">binary_history</span><span class="p">[[</span><span class="s1">&#39;period_days&#39;</span><span class="p">]]]</span>\
                              <span class="k">for</span> <span class="n">h1</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">star_history</span><span class="p">[[</span><span class="s1">&#39;center_he4&#39;</span><span class="p">]]]</span>\
                              <span class="k">for</span> <span class="n">h2</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">star_history</span><span class="p">]]</span>
        <span class="n">tests</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">bh</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;argument of type &#39;NoneType&#39; is not &quot;</span>\
                                         <span class="o">+</span><span class="s2">&quot;iterable&quot;</span><span class="p">):</span>
                <span class="n">totest</span><span class="o">.</span><span class="n">downsample_history</span><span class="p">(</span><span class="n">bh</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">,</span> <span class="n">ConfigFile</span><span class="p">)</span>
        <span class="n">ConfigFile</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="s2">&quot;history_DS_exclude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;star_age&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">bh</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">h1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;&#39;NoneType&#39; object is not &quot;</span>\
                                             <span class="o">+</span><span class="s2">&quot;subscriptable&quot;</span><span class="p">):</span>
                    <span class="n">totest</span><span class="o">.</span><span class="n">downsample_history</span><span class="p">(</span><span class="n">bh</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">,</span> <span class="n">ConfigFile</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;no field of name star_age&quot;</span><span class="p">):</span>
                    <span class="n">totest</span><span class="o">.</span><span class="n">downsample_history</span><span class="p">(</span><span class="n">bh</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">,</span> <span class="n">ConfigFile</span><span class="p">)</span>
        <span class="n">ConfigFile</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="s2">&quot;binary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">bh</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;&#39;NoneType&#39; object is not &quot;</span>\
                                             <span class="o">+</span><span class="s2">&quot;subscriptable&quot;</span><span class="p">):</span>
                    <span class="n">totest</span><span class="o">.</span><span class="n">downsample_history</span><span class="p">(</span><span class="n">bh</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">,</span> <span class="n">ConfigFile</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;no field of name age&quot;</span><span class="p">):</span>
                    <span class="n">totest</span><span class="o">.</span><span class="n">downsample_history</span><span class="p">(</span><span class="n">bh</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">,</span> <span class="n">ConfigFile</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Unequal numbers of rows in histories.&quot;</span><span class="p">):</span>
            <span class="n">totest</span><span class="o">.</span><span class="n">downsample_history</span><span class="p">(</span><span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span>\
                                      <span class="n">star_history</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">ConfigFile</span><span class="p">)</span>
        <span class="c1"># examples:</span>
        <span class="n">bh</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">h2</span> <span class="o">=</span> <span class="n">totest</span><span class="o">.</span><span class="n">downsample_history</span><span class="p">(</span><span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span>\
                                               <span class="n">star_history</span><span class="p">,</span> <span class="n">ConfigFile</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">bh</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">star_history</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">h2</span><span class="p">,</span> <span class="n">star_history</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestFunctions.test_downsample_profile">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestFunctions.test_downsample_profile">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_downsample_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ConfigFile</span><span class="p">,</span> <span class="n">profile</span><span class="p">):</span>
        <span class="c1"># missing argument</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;missing 2 required positional &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;arguments: &#39;profile&#39; and &#39;params&#39;&quot;</span><span class="p">):</span>
            <span class="n">totest</span><span class="o">.</span><span class="n">downsample_profile</span><span class="p">()</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;&#39;NoneType&#39; object is not subscriptable&quot;</span><span class="p">):</span>
            <span class="n">totest</span><span class="o">.</span><span class="n">downsample_profile</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># examples: failed</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">downsample_profile</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">ConfigFile</span><span class="p">),</span>\
                              <span class="n">profile</span><span class="p">)</span>
        <span class="n">ConfigFile</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="s2">&quot;profile_DS_error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="k">assert</span> <span class="n">totest</span><span class="o">.</span><span class="n">downsample_profile</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">ConfigFile</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;argument of type &#39;NoneType&#39; is not &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;iterable&quot;</span><span class="p">):</span>
            <span class="n">totest</span><span class="o">.</span><span class="n">downsample_profile</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">ConfigFile</span><span class="p">)</span>
        <span class="c1"># examples</span>
        <span class="n">ConfigFile</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="s2">&quot;profile_DS_exclude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mass&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">downsample_profile</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">ConfigFile</span><span class="p">),</span>\
                              <span class="n">profile</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestFunctions.test_join_grids">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestFunctions.test_join_grids">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_join_grids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">,</span> <span class="n">no_path</span><span class="p">,</span> <span class="n">h5_out_path</span><span class="p">,</span> <span class="n">grid1_path</span><span class="p">,</span>\
                        <span class="n">grid2_path</span><span class="p">,</span> <span class="n">grid_path_bad_ini</span><span class="p">,</span> <span class="n">grid_path_bad_fin</span><span class="p">,</span>\
                        <span class="n">grid_path_start_RLO</span><span class="p">,</span> <span class="n">grid_path_initial_RLO</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">check_h5_content</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">required_data</span><span class="o">=</span><span class="p">{},</span> <span class="n">required_attrs</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Function to check an hdf5 file</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            path : str</span>
<span class="sd">                Location of the hdf5 file</span>
<span class="sd">            required_data : dict (optional)</span>
<span class="sd">                A dictionary where the keys are references to objects/datasets</span>
<span class="sd">                in the hdf5 file and the items are the ndarrays to be checked</span>
<span class="sd">                against (if the item is None, only the existence of the object</span>
<span class="sd">                is checked)</span>
<span class="sd">            required_attrs : dict (optional)</span>
<span class="sd">                A dictionary where the keys are references to attributes in the</span>
<span class="sd">                hdf5 file and the items are lists of strings to be part of this</span>
<span class="sd">                attribute</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># test that file exists</span>
            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_file</span><span class="p">:</span>
                <span class="c1"># test attribute content</span>
                <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">vs</span> <span class="ow">in</span> <span class="n">required_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vs</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">hdf5_file</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
                <span class="c1"># test data content</span>
                <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">required_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">hdf5_file</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">hdf5_file</span><span class="p">[</span><span class="n">s</span><span class="p">][()],</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">mock_get_detected_initial_RLO</span><span class="p">(</span><span class="n">grid</span><span class="p">):</span>
            <span class="c1"># mocked list of initial RLO systems</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;description&quot;</span> <span class="ow">in</span> <span class="n">grid</span><span class="o">.</span><span class="n">config</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">grid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;UnitTest1&quot;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[{</span><span class="s2">&quot;star_1_mass&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;star_2_mass&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>\
                             <span class="s2">&quot;period_days&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;termination_flag_3&quot;</span><span class="p">:</span> <span class="s2">&quot;rTF3&quot;</span><span class="p">,</span>\
                             <span class="s2">&quot;termination_flag_4&quot;</span><span class="p">:</span> <span class="s2">&quot;rTF4&quot;</span><span class="p">},</span>\
                            <span class="p">{</span><span class="s2">&quot;star_1_mass&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;star_2_mass&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>\
                             <span class="s2">&quot;period_days&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;termination_flag_3&quot;</span><span class="p">:</span> <span class="s2">&quot;rTF3&quot;</span><span class="p">,</span>\
                             <span class="s2">&quot;termination_flag_4&quot;</span><span class="p">:</span> <span class="s2">&quot;rTF4&quot;</span><span class="p">},</span>\
                            <span class="p">{</span><span class="s2">&quot;star_1_mass&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;star_2_mass&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>\
                             <span class="s2">&quot;period_days&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s2">&quot;termination_flag_3&quot;</span><span class="p">:</span> <span class="s2">&quot;rTF3&quot;</span><span class="p">,</span>\
                             <span class="s2">&quot;termination_flag_4&quot;</span><span class="p">:</span> <span class="s2">&quot;rTF4&quot;</span><span class="p">},</span>\
                            <span class="p">{</span><span class="s2">&quot;star_1_mass&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s2">&quot;star_2_mass&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>\
                             <span class="s2">&quot;period_days&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;termination_flag_3&quot;</span><span class="p">:</span> <span class="s2">&quot;rTF3&quot;</span><span class="p">,</span>\
                             <span class="s2">&quot;termination_flag_4&quot;</span><span class="p">:</span> <span class="s2">&quot;rTF4&quot;</span><span class="p">}]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">mock_get_nearest_known_initial_RLO</span><span class="p">(</span><span class="n">mass1</span><span class="p">,</span> <span class="n">mass2</span><span class="p">,</span>\
                                               <span class="n">known_initial_RLO</span><span class="p">):</span>
            <span class="c1"># mocked nearest initial RLO system</span>
            <span class="k">if</span> <span class="n">mass1</span> <span class="o">==</span> <span class="mf">3.0</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;star_1_mass&quot;</span><span class="p">:</span> <span class="n">mass1</span><span class="p">,</span> <span class="s2">&quot;star_2_mass&quot;</span><span class="p">:</span> <span class="n">mass2</span><span class="p">,</span>\
                        <span class="s2">&quot;period_days&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s2">&quot;termination_flag_3&quot;</span><span class="p">:</span> <span class="s2">&quot;rTF3&quot;</span><span class="p">}</span>
            <span class="k">elif</span> <span class="n">mass1</span> <span class="o">==</span> <span class="mf">4.0</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;star_1_mass&quot;</span><span class="p">:</span> <span class="n">mass1</span><span class="p">,</span> <span class="s2">&quot;star_2_mass&quot;</span><span class="p">:</span> <span class="n">mass2</span><span class="p">,</span>\
                        <span class="s2">&quot;period_days&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s2">&quot;termination_flag_4&quot;</span><span class="p">:</span> <span class="s2">&quot;rTF4&quot;</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;star_1_mass&quot;</span><span class="p">:</span> <span class="n">mass1</span><span class="p">,</span> <span class="s2">&quot;star_2_mass&quot;</span><span class="p">:</span> <span class="n">mass2</span><span class="p">,</span>\
                        <span class="s2">&quot;period_days&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">}</span>
        <span class="c1"># missing argument</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;missing 2 required positional &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;arguments: &#39;input_paths&#39; and &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;&#39;output_path&#39;&quot;</span><span class="p">):</span>
            <span class="n">totest</span><span class="o">.</span><span class="n">join_grids</span><span class="p">()</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">):</span>
            <span class="n">totest</span><span class="o">.</span><span class="n">join_grids</span><span class="p">([</span><span class="n">no_path</span><span class="p">],</span> <span class="n">h5_out_path</span><span class="p">)</span>
        <span class="c1"># examples: one grid</span>
        <span class="n">totest</span><span class="o">.</span><span class="n">join_grids</span><span class="p">([</span><span class="n">grid2_path</span><span class="p">],</span> <span class="n">h5_out_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">rd</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;/grid/&#39;</span><span class="p">,</span> <span class="s1">&#39;/grid/run0/&#39;</span><span class="p">,</span> <span class="s1">&#39;/grid/run1/&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">grid2_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)[</span><span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">rd</span><span class="p">[</span><span class="n">group</span><span class="o">+</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">ra</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&#39;description&#39;: &#39;joined&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;compression&#39;: &#39;gzip9&#39;&quot;</span><span class="p">]</span>\
                        <span class="o">+</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&#39;: None&quot;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span>\
                          <span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_TO_BE_NONE</span><span class="p">]}</span>
        <span class="n">check_h5_content</span><span class="p">(</span><span class="n">h5_out_path</span><span class="p">,</span> <span class="n">required_data</span><span class="o">=</span><span class="n">rd</span><span class="p">,</span> <span class="n">required_attrs</span><span class="o">=</span><span class="n">ra</span><span class="p">)</span>
        <span class="c1"># examples: two grids</span>
        <span class="n">totest</span><span class="o">.</span><span class="n">join_grids</span><span class="p">([</span><span class="n">grid1_path</span><span class="p">,</span> <span class="n">grid2_path</span><span class="p">],</span> <span class="n">h5_out_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">check_h5_content</span><span class="p">(</span><span class="n">h5_out_path</span><span class="p">,</span> <span class="n">required_data</span><span class="o">=</span><span class="n">rd</span><span class="p">,</span> <span class="n">required_attrs</span><span class="o">=</span><span class="n">ra</span><span class="p">)</span>
        <span class="c1"># examples: three grids</span>
        <span class="n">totest</span><span class="o">.</span><span class="n">join_grids</span><span class="p">([</span><span class="n">grid2_path</span><span class="p">,</span> <span class="n">grid1_path</span><span class="p">,</span> <span class="n">grid2_path</span><span class="p">],</span> <span class="n">h5_out_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">check_h5_content</span><span class="p">(</span><span class="n">h5_out_path</span><span class="p">,</span> <span class="n">required_data</span><span class="o">=</span><span class="n">rd</span><span class="p">,</span> <span class="n">required_attrs</span><span class="o">=</span><span class="n">ra</span><span class="p">)</span>
        <span class="c1"># bad input: consistent values do not match</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">grid2_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_file</span><span class="p">:</span>
            <span class="n">config2</span> <span class="o">=</span> <span class="n">hdf5_file</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_TO_BE_CONSISTENT</span><span class="p">:</span>
            <span class="n">sep</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&#39;: &quot;</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">config2</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;[&quot;</span><span class="p">:</span> <span class="c1"># check for lists</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">sep</span><span class="p">]</span> <span class="o">+</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;],&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;{&quot;</span><span class="p">:</span> <span class="c1"># check for dicts</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">sep</span><span class="p">]</span> <span class="o">+</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;},&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">sep</span><span class="p">]</span> <span class="o">+</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">newconfig</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39;test&#39;,&quot;</span> <span class="o">+</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># the last entry</span>
                <span class="n">newconfig</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39;test&#39;&quot;</span> <span class="o">+</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">grid2_path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_file</span><span class="p">:</span>
                <span class="n">hdf5_file</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newconfig</span>
            <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Inconsistent value for `</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">`: &quot;</span>\
                                          <span class="o">+</span><span class="s2">&quot;test !=&quot;</span><span class="p">):</span>
                <span class="n">totest</span><span class="o">.</span><span class="n">join_grids</span><span class="p">([</span><span class="n">grid1_path</span><span class="p">,</span> <span class="n">grid2_path</span><span class="p">],</span> <span class="n">h5_out_path</span><span class="p">,</span>\
                                  <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">grid2_path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_file</span><span class="p">:</span> <span class="c1"># restore config</span>
            <span class="n">hdf5_file</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config2</span>
        <span class="c1"># bad input: initial values have different type</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Initial values dtype&#39;s do not match.&quot;</span><span class="p">):</span>
            <span class="n">totest</span><span class="o">.</span><span class="n">join_grids</span><span class="p">([</span><span class="n">grid1_path</span><span class="p">,</span> <span class="n">grid_path_bad_ini</span><span class="p">],</span> <span class="n">h5_out_path</span><span class="p">,</span>\
                              <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># bad input: final values have different type</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Final values dtype&#39;s do not match.&quot;</span><span class="p">):</span>
            <span class="n">totest</span><span class="o">.</span><span class="n">join_grids</span><span class="p">([</span><span class="n">grid1_path</span><span class="p">,</span> <span class="n">grid_path_bad_fin</span><span class="p">],</span> <span class="n">h5_out_path</span><span class="p">,</span>\
                              <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># bad input: disallowed value (reuse config2)</span>
        <span class="k">for</span> <span class="n">p</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_ALLOWED</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">sep</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&#39;: &quot;</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">config2</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;[&quot;</span><span class="p">:</span> <span class="c1"># check for lists</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">sep</span><span class="p">]</span> <span class="o">+</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;],&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;{&quot;</span><span class="p">:</span> <span class="c1"># check for dicts</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">sep</span><span class="p">]</span> <span class="o">+</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;},&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">sep</span><span class="p">]</span> <span class="o">+</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">newconfig</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39;test&#39;,&quot;</span> <span class="o">+</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># the last entry</span>
                <span class="n">newconfig</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39;test&#39;&quot;</span> <span class="o">+</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">grid2_path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_file</span><span class="p">:</span>
                <span class="n">hdf5_file</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newconfig</span>
            <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Only grid with `</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">`=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2"> can be &quot;</span>\
                                          <span class="o">+</span><span class="s2">&quot;joined.&quot;</span><span class="p">):</span>
                <span class="n">totest</span><span class="o">.</span><span class="n">join_grids</span><span class="p">([</span><span class="n">grid2_path</span><span class="p">],</span> <span class="n">h5_out_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">grid2_path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_file</span><span class="p">:</span> <span class="c1"># restore config</span>
            <span class="n">hdf5_file</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config2</span>
        <span class="c1"># examples: RLO grid</span>
        <span class="n">totest</span><span class="o">.</span><span class="n">join_grids</span><span class="p">([</span><span class="n">grid_path_start_RLO</span><span class="p">],</span> <span class="n">h5_out_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">check_h5_content</span><span class="p">(</span><span class="n">h5_out_path</span><span class="p">,</span> <span class="n">required_data</span><span class="o">=</span><span class="n">rd</span><span class="p">,</span> <span class="n">required_attrs</span><span class="o">=</span><span class="n">ra</span><span class="p">)</span>
        <span class="c1"># examples: initial RLO</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">totest</span><span class="p">,</span> <span class="s2">&quot;get_detected_initial_RLO&quot;</span><span class="p">,</span>\
                            <span class="n">mock_get_detected_initial_RLO</span><span class="p">)</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">totest</span><span class="p">,</span> <span class="s2">&quot;get_nearest_known_initial_RLO&quot;</span><span class="p">,</span>\
                            <span class="n">mock_get_nearest_known_initial_RLO</span><span class="p">)</span>
        <span class="n">totest</span><span class="o">.</span><span class="n">join_grids</span><span class="p">([</span><span class="n">grid_path_initial_RLO</span><span class="p">],</span> <span class="n">h5_out_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">check_h5_content</span><span class="p">(</span><span class="n">h5_out_path</span><span class="p">,</span> <span class="n">required_data</span><span class="o">=</span><span class="n">rd</span><span class="p">,</span> <span class="n">required_attrs</span><span class="o">=</span><span class="n">ra</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">grid_path_initial_RLO</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_file</span><span class="p">:</span>
            <span class="n">ini_val</span> <span class="o">=</span> <span class="n">hdf5_file</span><span class="p">[</span><span class="s1">&#39;/grid/initial_values&#39;</span><span class="p">][()]</span>
            <span class="n">fin_val</span> <span class="o">=</span> <span class="n">hdf5_file</span><span class="p">[</span><span class="s1">&#39;/grid/final_values&#39;</span><span class="p">][()]</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">h5_out_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_file</span><span class="p">:</span>
            <span class="n">new_ini_val</span> <span class="o">=</span> <span class="n">hdf5_file</span><span class="p">[</span><span class="s1">&#39;/grid/initial_values&#39;</span><span class="p">][()]</span>
            <span class="n">new_fin_val</span> <span class="o">=</span> <span class="n">hdf5_file</span><span class="p">[</span><span class="s1">&#39;/grid/final_values&#39;</span><span class="p">][()]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;star_1_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;star_2_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;period_days&#39;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">ini_val</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">new_ini_val</span><span class="p">[</span><span class="n">col</span><span class="p">],</span>\
                                  <span class="n">equal_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">fin_val</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">new_fin_val</span><span class="p">[</span><span class="n">col</span><span class="p">],</span>\
                                  <span class="n">equal_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]:</span> <span class="c1"># done initial RLO replacements</span>
            <span class="n">fin_val</span><span class="p">[</span><span class="s1">&#39;termination_flag_1&#39;</span><span class="p">][</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;forced_initial_RLO&#39;</span>
            <span class="n">fin_val</span><span class="p">[</span><span class="s1">&#39;termination_flag_2&#39;</span><span class="p">][</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;forced_initial_RLO&#39;</span>
            <span class="n">fin_val</span><span class="p">[</span><span class="s1">&#39;interpolation_class&#39;</span><span class="p">][</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;initial_MT&#39;</span>
        <span class="n">fin_val</span><span class="p">[</span><span class="s1">&#39;termination_flag_3&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;rTF3&#39;</span>
        <span class="n">fin_val</span><span class="p">[</span><span class="s1">&#39;termination_flag_4&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;rTF4&#39;</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;termination_flag_1&#39;</span><span class="p">,</span> <span class="s1">&#39;termination_flag_2&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;termination_flag_3&#39;</span><span class="p">,</span> <span class="s1">&#39;termination_flag_4&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;interpolation_class&#39;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">fin_val</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">new_fin_val</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
        <span class="c1"># examples: compressions</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;lzf&quot;</span><span class="p">,</span> <span class="s2">&quot;gzip&quot;</span><span class="p">,</span> <span class="s2">&quot;gzip9&quot;</span><span class="p">]:</span>
            <span class="n">totest</span><span class="o">.</span><span class="n">join_grids</span><span class="p">([</span><span class="n">grid2_path</span><span class="p">],</span> <span class="n">h5_out_path</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">c</span><span class="p">,</span>\
                              <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ra</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&#39;compression&#39;: None&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ra</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&#39;compression&#39;: &#39;&quot;</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
            <span class="n">check_h5_content</span><span class="p">(</span><span class="n">h5_out_path</span><span class="p">,</span> <span class="n">required_data</span><span class="o">=</span><span class="n">rd</span><span class="p">,</span> <span class="n">required_attrs</span><span class="o">=</span><span class="n">ra</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;gzipT&quot;</span><span class="p">,</span> <span class="s2">&quot;gzip10&quot;</span><span class="p">]:</span>
            <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;GZIP compression level must be &quot;</span>\
                                          <span class="o">+</span><span class="s2">&quot;0-9.&quot;</span><span class="p">):</span>
                <span class="n">totest</span><span class="o">.</span><span class="n">join_grids</span><span class="p">([</span><span class="n">grid2_path</span><span class="p">],</span> <span class="n">h5_out_path</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">c</span><span class="p">,</span>\
                                  <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;zip&quot;</span><span class="p">]:</span>
            <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Unknown compression `</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">`.&quot;</span><span class="p">):</span>
                <span class="n">totest</span><span class="o">.</span><span class="n">join_grids</span><span class="p">([</span><span class="n">grid2_path</span><span class="p">],</span> <span class="n">h5_out_path</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">c</span><span class="p">,</span>\
                                  <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestPSyGrid">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestPSyGrid</span><span class="p">:</span>
<div class="viewcode-block" id="TestPSyGrid.PSyGrid">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.PSyGrid">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">PSyGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># initialize an instance of the class with defaults</span>
        <span class="k">return</span> <span class="n">totest</span><span class="o">.</span><span class="n">PSyGrid</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestPSyGrid.reset_grid">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.reset_grid">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">reset_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TestGrid</span><span class="p">):</span>
        <span class="c1"># function to reset a test grid and have the default config</span>
        <span class="n">TestGrid</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span> <span class="c1"># reset</span>
        <span class="n">TestGrid</span><span class="o">.</span><span class="n">generate_config</span><span class="p">()</span> <span class="c1"># set default config</span></div>


<div class="viewcode-block" id="TestPSyGrid.Empty_dir">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.Empty_dir">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">Empty_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">):</span>
        <span class="c1"># create an empty directory</span>
        <span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;empty&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dir_path</span></div>


<div class="viewcode-block" id="TestPSyGrid.eep_files">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.eep_files">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">eep_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">):</span>
        <span class="c1"># create eep files</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;eeps_OK&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ext</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">EEP_FILE_EXTENSIONS</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;file</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">ext</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">eep_file</span><span class="p">:</span>
                <span class="n">eep_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span></div>


<div class="viewcode-block" id="TestPSyGrid.same_eep_files">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.same_eep_files">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">same_eep_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">):</span>
        <span class="c1"># create eep files</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;eeps_same_name&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ext</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">EEP_FILE_EXTENSIONS</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;file&quot;</span><span class="o">+</span><span class="n">ext</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">eep_file</span><span class="p">:</span>
                <span class="n">eep_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span></div>


<div class="viewcode-block" id="TestPSyGrid.MESA_no_histories">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.MESA_no_histories">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">MESA_no_histories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">):</span>
        <span class="c1"># create files expected from a MESA run, but no histories</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;MESA_no_histories&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="c1"># get run directories for index 0 to 2</span>
            <span class="n">add_MESA_run_files</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">binary_run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_histories</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                               <span class="n">with_profiles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span></div>


<div class="viewcode-block" id="TestPSyGrid.MESA_files_single">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.MESA_files_single">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">MESA_files_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">):</span>
        <span class="c1"># create files expected from a MESA run of a single star</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;MESA_single_runs&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="c1"># get run directories for index 0 to 1</span>
            <span class="n">add_MESA_run_files</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">binary_run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">with_histories</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>\
                               <span class="n">with_profiles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span></div>


<div class="viewcode-block" id="TestPSyGrid.MESA_files">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.MESA_files">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">MESA_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">):</span>
        <span class="c1"># create files expected from a MESA run of a binary</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;MESA_runs&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="c1"># get run directories for index 0 to 3</span>
            <span class="n">add_MESA_run_files</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">binary_run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_histories</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>\
                               <span class="n">with_profiles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span></div>


<div class="viewcode-block" id="TestPSyGrid.MESA_v1_files">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.MESA_v1_files">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">MESA_v1_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">):</span>
        <span class="c1"># create files expected from a MESA run in v1 of a binary</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;MESA_runs_v1&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="c1"># get run directories for index 0 to 3</span>
            <span class="n">add_MESA_run_files</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">binary_run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_histories</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>\
                               <span class="n">with_profiles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span></div>


<div class="viewcode-block" id="TestPSyGrid.MESA_EEPs_single">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.MESA_EEPs_single">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">MESA_EEPs_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MESA_files_single</span><span class="p">):</span>
        <span class="c1"># create files expected from a MESA run of a single star</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">MESA_files_single</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MESA_files_single</span><span class="p">,</span> <span class="s2">&quot;eeps&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">searchfor</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MESA_files_single</span><span class="p">,</span> <span class="s2">&quot;Zbase*&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">dirname</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">searchfor</span><span class="p">):</span>
                <span class="c1"># copy history file to become an EEP file</span>
                <span class="n">history_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="s2">&quot;LOGS1&quot;</span><span class="p">,</span>\
                                                <span class="s2">&quot;history.data&quot;</span><span class="p">)</span>
                <span class="n">eep_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>\
                                                  <span class="o">+</span><span class="s2">&quot;.data.eep&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">history_filename</span><span class="p">):</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">eep_filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">test_file</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span> <span class="c1"># add additional header lines</span>
                            <span class="n">test_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Test EEP_HEADER</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">history_filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data_file</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data_file</span><span class="p">:</span> <span class="c1"># copy data</span>
                                <span class="n">test_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">path</span></div>


<div class="viewcode-block" id="TestPSyGrid.grid_path">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.grid_path">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">grid_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span> <span class="n">profile</span><span class="p">):</span>
        <span class="c1"># a path to a psygrid file for testing</span>
        <span class="k">return</span> <span class="n">get_PSyGrid</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestPSyGrid.grid_path_negative_run">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.grid_path_negative_run">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">grid_path_negative_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span>\
                               <span class="n">profile</span><span class="p">):</span>
        <span class="c1"># a path to a psygrid file for testing</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">get_PSyGrid</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span>
        <span class="c1"># modify hdf5 file: add group for run -1</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_file</span><span class="p">:</span>
            <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;/grid/run-1/&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span></div>


<div class="viewcode-block" id="TestPSyGrid.grid_path_additional_run">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.grid_path_additional_run">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">grid_path_additional_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span>\
                                 <span class="n">profile</span><span class="p">):</span>
        <span class="c1"># a path to a psygrid file for testing</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">get_PSyGrid</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span>
        <span class="c1"># modify hdf5 file: add group for run 1000</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_file</span><span class="p">:</span>
            <span class="n">hdf5_file</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;/grid/run1000/&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span></div>


<div class="viewcode-block" id="TestPSyGrid.grid_path_missing_run">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.grid_path_missing_run">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">grid_path_missing_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span>\
                              <span class="n">profile</span><span class="p">):</span>
        <span class="c1"># a path to a psygrid file for testing</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">get_PSyGrid</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span>
        <span class="c1"># modify hdf5 file: add group for run 1000</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_file</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">hdf5_file</span><span class="p">[</span><span class="s2">&quot;/grid/run1/&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">path</span></div>


<div class="viewcode-block" id="TestPSyGrid.grid_path_no_runs">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.grid_path_no_runs">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">grid_path_no_runs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span>\
                          <span class="n">profile</span><span class="p">):</span>
        <span class="c1"># a path to a psygrid file for testing</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">get_PSyGrid</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span>
        <span class="c1"># modify hdf5 file: add group for run 1000</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_file</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">hdf5_file</span><span class="p">[</span><span class="s2">&quot;/grid/run0/&quot;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">hdf5_file</span><span class="p">[</span><span class="s2">&quot;/grid/run1/&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">path</span></div>


    <span class="c1"># test the PSyGrid class</span>
<div class="viewcode-block" id="TestPSyGrid.test_init">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_init">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">mock_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">filepath</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>
        <span class="c1"># check that the instance is of correct type and all code in the</span>
        <span class="c1"># __init__ got executed: the elements are created and initialized</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">totest</span><span class="o">.</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kc">False</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="n">mock_load</span><span class="p">)</span>
        <span class="n">test_PSyGrid</span> <span class="o">=</span> <span class="n">totest</span><span class="o">.</span><span class="n">PSyGrid</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="s2">&quot;./test&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">test_PSyGrid</span><span class="o">.</span><span class="n">filepath</span> <span class="o">==</span> <span class="s2">&quot;./test&quot;</span>
        <span class="k">assert</span> <span class="n">test_PSyGrid</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_reset">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_reset">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">_reset</span><span class="p">)</span>
        <span class="c1"># this function gets called during __init__</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">hdf5</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">MESA_dirs</span> <span class="o">==</span> <span class="p">[]</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">initial_values</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">final_values</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">totest</span><span class="o">.</span><span class="n">ConfigFile</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">n_runs</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">eeps</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">hdf5</span> <span class="o">=</span> <span class="s2">&quot;Test&quot;</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">MESA_dirs</span> <span class="o">=</span> <span class="s2">&quot;Test&quot;</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">initial_values</span> <span class="o">=</span> <span class="s2">&quot;Test&quot;</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">final_values</span> <span class="o">=</span> <span class="s2">&quot;Test&quot;</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="s2">&quot;Test&quot;</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">n_runs</span> <span class="o">=</span> <span class="s2">&quot;Test&quot;</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">eeps</span> <span class="o">=</span> <span class="s2">&quot;Test&quot;</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_make_compression_args">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_make_compression_args">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_make_compression_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">_make_compression_args</span><span class="p">)</span>
        <span class="c1"># this function gets called during _reset (hence, during __init__)</span>
        <span class="c1"># examples no compression information yet</span>
        <span class="k">del</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">compression_args</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="s2">&quot;compression_args&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_make_compression_args</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="s2">&quot;compression_args&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">compression_args</span> <span class="o">==</span> <span class="p">{}</span>
        <span class="c1"># examples: simple compressions</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;lzf&quot;</span><span class="p">,</span> <span class="s2">&quot;gzip&quot;</span><span class="p">]:</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;compression&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_make_compression_args</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">compression_args</span> <span class="o">==</span> <span class="p">{}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">compression_args</span><span class="p">[</span><span class="s2">&quot;compression&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">c</span>
        <span class="c1"># examples: gzip with optional level</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;compression&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;gzip</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_make_compression_args</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">compression_args</span><span class="p">[</span><span class="s2">&quot;compression&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;gzip&quot;</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">compression_args</span><span class="p">[</span><span class="s2">&quot;compression_opts&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">l</span>
        <span class="c1"># bad input</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;gzipt&quot;</span><span class="p">,</span> <span class="s2">&quot;gzip10&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">]:</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;compression&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
            <span class="k">if</span> <span class="s2">&quot;gzip&quot;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;GZIP compression level must be 0-9.&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unknown compression `</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">`.&quot;</span>
            <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="n">m</span><span class="p">):</span>
                <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_make_compression_args</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_discover_eeps">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_discover_eeps">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_discover_eeps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">,</span> <span class="n">Empty_dir</span><span class="p">,</span> <span class="n">eep_files</span><span class="p">,</span>\
                           <span class="n">same_eep_files</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">_discover_eeps</span><span class="p">)</span>
        <span class="c1"># examples: no eeps found</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">eeps</span> <span class="o">=</span> <span class="s2">&quot;Test&quot;</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_discover_eeps</span><span class="p">(</span><span class="n">Empty_dir</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">eeps</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="c1"># examples: eeps with each file extension found</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_discover_eeps</span><span class="p">(</span><span class="n">eep_files</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">EEP_FILE_EXTENSIONS</span><span class="p">)):</span>
            <span class="n">eep_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;file</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">assert</span> <span class="n">eep_id</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">eeps</span>
            <span class="k">assert</span> <span class="n">totest</span><span class="o">.</span><span class="n">EEP_FILE_EXTENSIONS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span>\
                   <span class="n">PSyGrid</span><span class="o">.</span><span class="n">eeps</span><span class="p">[</span><span class="n">eep_id</span><span class="p">][</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">EEP_FILE_EXTENSIONS</span><span class="p">[</span><span class="n">i</span><span class="p">]):]</span>
        <span class="c1"># bad input: eep files with same identifier</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_discover_eeps</span><span class="p">(</span><span class="n">same_eep_files</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_say">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_say">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_say</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">,</span> <span class="n">capsys</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">_say</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">v</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_say</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">capsys</span><span class="o">.</span><span class="n">readouterr</span><span class="p">()</span><span class="o">.</span><span class="n">out</span> <span class="o">==</span> <span class="s2">&quot;Test</span><span class="se">\n</span><span class="s2">&quot;</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_generate_config">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_generate_config">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_generate_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">generate_config</span><span class="p">)</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;`UnitTest` is not a valid parameter &quot;</span>\
                                    <span class="o">+</span><span class="s2">&quot;name.&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">generate_config</span><span class="p">(</span><span class="n">UnitTest</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="c1"># examples: set each grid property</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">GRIDPROPERTIES</span><span class="p">:</span>
            <span class="c1"># compression is special, because it is checked for allowed values</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;compression&quot;</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="s2">&quot;UnitTest&quot;</span><span class="p">}</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">generate_config</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">GRIDPROPERTIES</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">cc</span><span class="p">:</span> <span class="c1"># the set value</span>
                    <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">cc</span><span class="p">]</span> <span class="o">==</span> <span class="n">args</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span> <span class="c1"># the default value</span>
                    <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">cc</span><span class="p">]</span> <span class="o">==</span> <span class="n">totest</span><span class="o">.</span><span class="n">GRIDPROPERTIES</span><span class="p">[</span><span class="n">cc</span><span class="p">]</span>
        <span class="c1"># examples: set all grid properties</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">GRIDPROPERTIES</span><span class="p">:</span>
            <span class="c1"># compression is special, because it is checked for allowed values</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;compression&quot;</span><span class="p">:</span>
                <span class="n">args</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">args</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;UnitTest&quot;</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">generate_config</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">GRIDPROPERTIES</span><span class="p">:</span>
            <span class="c1"># all have the set value</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">cc</span><span class="p">]</span> <span class="o">==</span> <span class="n">args</span><span class="p">[</span><span class="n">cc</span><span class="p">]</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_create">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_create">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">,</span> <span class="n">Empty_dir</span><span class="p">,</span> <span class="n">MESA_files</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">create</span><span class="p">)</span>
        <span class="c1"># missing argument</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;missing 1 required positional &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;argument: &#39;MESA_grid_path&#39;&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;`warn` must be in: &quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;./&quot;</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="s2">&quot;UnitTest&quot;</span><span class="p">)</span>
        <span class="c1"># bad input</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;The path of the HDF5 file was not &quot;</span>\
                                      <span class="o">+</span><span class="s2">&quot;defined.&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;./&quot;</span><span class="p">)</span>
        <span class="c1"># bad input</span>
        <span class="n">MESA_PATH</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Empty_dir</span><span class="p">)</span>
        <span class="n">PSyGrid_path</span> <span class="o">=</span> <span class="s2">&quot;TestGrid.h5&quot;</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;No folders found in </span><span class="si">{</span><span class="n">MESA_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">MESA_PATH</span><span class="p">,</span> <span class="n">psygrid_path</span><span class="o">=</span><span class="n">PSyGrid_path</span><span class="p">)</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">FileExistsError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">PSyGrid_path</span><span class="si">}</span><span class="s2"> already &quot;</span>\
                                           <span class="o">+</span><span class="s2">&quot;exists.&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">MESA_PATH</span><span class="p">,</span> <span class="n">psygrid_path</span><span class="o">=</span><span class="n">PSyGrid_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">PSyGrid_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">PSyGrid_path</span><span class="p">)</span>
        <span class="c1"># examples</span>
        <span class="n">PSyGrid_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="s2">&quot;../TestGrid.h5&quot;</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="n">psygrid_path</span><span class="o">=</span><span class="n">PSyGrid_path</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>\
                       <span class="n">warn</span><span class="o">=</span><span class="s2">&quot;suppress&quot;</span><span class="p">)</span>
        <span class="c1"># examples</span>
        <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because of &quot;</span>\
                                              <span class="o">+</span><span class="s2">&quot;missing binary history in:&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="n">psygrid_path</span><span class="o">=</span><span class="n">PSyGrid_path</span><span class="p">,</span>\
                           <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="s2">&quot;end&quot;</span><span class="p">)</span>
        <span class="c1"># examples</span>
        <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because of &quot;</span>\
                                              <span class="o">+</span><span class="s2">&quot;missing binary history in:&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="n">psygrid_path</span><span class="o">=</span><span class="n">PSyGrid_path</span><span class="p">,</span>\
                           <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_create_psygrid">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_create_psygrid">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_create_psygrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">,</span> <span class="n">Empty_dir</span><span class="p">,</span> <span class="n">MESA_no_histories</span><span class="p">,</span>\
                            <span class="n">MESA_files_single</span><span class="p">,</span> <span class="n">eep_files</span><span class="p">,</span> <span class="n">MESA_EEPs_single</span><span class="p">,</span>\
                            <span class="n">MESA_files</span><span class="p">,</span> <span class="n">MESA_v1_files</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">check_len</span><span class="p">(</span><span class="n">Grid</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">Grid</span><span class="o">.</span><span class="n">initial_values</span><span class="p">)</span> <span class="o">==</span> <span class="n">N</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">Grid</span><span class="o">.</span><span class="n">final_values</span><span class="p">)</span> <span class="o">==</span> <span class="n">N</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">Grid</span><span class="o">.</span><span class="n">MESA_dirs</span><span class="p">)</span> <span class="o">==</span> <span class="n">N</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">check_keys</span><span class="p">(</span><span class="n">Grid</span><span class="p">,</span> <span class="n">keys_initial_values</span><span class="p">,</span> <span class="n">keys_final_values</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys_initial_values</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Grid</span><span class="o">.</span><span class="n">initial_values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys_final_values</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Grid</span><span class="o">.</span><span class="n">final_values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
        <span class="n">SINGLE_KEYS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;S1_&quot;</span><span class="o">+</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_SINGLE_HISTORY_COLS</span><span class="p">]</span>
        <span class="n">BINARY_KEYS</span> <span class="o">=</span> <span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_BINARY_HISTORY_COLS</span>\
                      <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;S1_&quot;</span><span class="o">+</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_STAR_HISTORY_COLS</span><span class="p">]</span>\
                      <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;S2_&quot;</span><span class="o">+</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_STAR_HISTORY_COLS</span><span class="p">]</span>
        <span class="n">SINGLE_INITIAL_KEYS</span> <span class="o">=</span> <span class="n">SINGLE_KEYS</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">]</span>
        <span class="n">BINARY_INITIAL_KEYS</span> <span class="o">=</span> <span class="n">BINARY_KEYS</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">]</span>
        <span class="n">SINGLE_FINAL_KEYS</span> <span class="o">=</span> <span class="n">SINGLE_KEYS</span>\
                            <span class="o">+</span> <span class="n">totest</span><span class="o">.</span><span class="n">TERMINATION_FLAG_COLUMNS_SINGLE</span>
        <span class="n">BINARY_FINAL_KEYS</span> <span class="o">=</span> <span class="n">BINARY_KEYS</span> <span class="o">+</span> <span class="n">totest</span><span class="o">.</span><span class="n">TERMINATION_FLAG_COLUMNS</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">mock_get_nearest_known_initial_RLO</span><span class="p">(</span><span class="n">mass1</span><span class="p">,</span> <span class="n">mass2</span><span class="p">,</span>\
                                               <span class="n">known_initial_RLO</span><span class="p">):</span>
            <span class="c1"># mocked nearest initial RLO system</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;star_1_mass&quot;</span><span class="p">:</span> <span class="n">mass1</span><span class="p">,</span> <span class="s2">&quot;star_2_mass&quot;</span><span class="p">:</span> <span class="n">mass2</span><span class="p">,</span>\
                    <span class="s2">&quot;period_days&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s2">&quot;termination_flag_3&quot;</span><span class="p">:</span> <span class="s2">&quot;rTF3&quot;</span><span class="p">,</span>\
                    <span class="s2">&quot;termination_flag_4&quot;</span><span class="p">:</span> <span class="s2">&quot;rTF4&quot;</span><span class="p">}</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">mock_get_nearest_known_initial_RLO2</span><span class="p">(</span><span class="n">mass1</span><span class="p">,</span> <span class="n">mass2</span><span class="p">,</span>\
                                                <span class="n">known_initial_RLO</span><span class="p">):</span>
            <span class="c1"># mocked nearest initial RLO system</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;star_1_mass&quot;</span><span class="p">:</span> <span class="n">mass1</span><span class="p">,</span> <span class="s2">&quot;star_2_mass&quot;</span><span class="p">:</span> <span class="n">mass2</span><span class="p">,</span>\
                    <span class="s2">&quot;period_days&quot;</span><span class="p">:</span> <span class="mf">0.11</span><span class="p">,</span> <span class="s2">&quot;termination_flag_4&quot;</span><span class="p">:</span> <span class="s2">&quot;rTF4&quot;</span><span class="p">}</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">mock_keep_after_RLO</span><span class="p">(</span><span class="n">bh</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">):</span>
            <span class="c1"># mocked nearest initial RLO system</span>
            <span class="k">if</span> <span class="n">h2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">keep_after_RLO</span><span class="p">(</span><span class="n">bh</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">mock_initialize_empty_array_noX</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
            <span class="n">new_arr</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s2">&quot;X&quot;</span><span class="p">]]</span>
            <span class="k">return</span> <span class="n">initialize_empty_array</span><span class="p">(</span><span class="n">new_arr</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">mock_initialize_empty_array_noY</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
            <span class="n">new_arr</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s2">&quot;Y&quot;</span><span class="p">]]</span>
            <span class="k">return</span> <span class="n">initialize_empty_array</span><span class="p">(</span><span class="n">new_arr</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">mock_initialize_empty_array_noZ</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
            <span class="n">new_arr</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s2">&quot;Z&quot;</span><span class="p">]]</span>
            <span class="k">return</span> <span class="n">initialize_empty_array</span><span class="p">(</span><span class="n">new_arr</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">mock_get_flags_from_MESA_run</span><span class="p">(</span><span class="n">MESA_log_path</span><span class="p">,</span> <span class="n">binary_history</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>\
                                         <span class="n">history1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">history2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>\
                                         <span class="n">start_at_RLO</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">newTF1</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;Terminate because of overflowing initial model&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>\
                    <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">)</span>
        <span class="c1"># missing argument</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;missing 2 required positional &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;arguments: &#39;MESA_path&#39; and &#39;hdf5&#39;&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">()</span>
        <span class="c1"># bad input</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="s2">&quot;./&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># examples: no data</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Empty_dir</span><span class="p">,</span> <span class="s2">&quot;../TestPSyGrid.h5&quot;</span><span class="p">)</span>
        <span class="n">MESA_PATH</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Empty_dir</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;No folders found in </span><span class="si">{</span><span class="n">MESA_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_PATH</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;PSyGrid object cannot be &quot;</span>\
                                             <span class="o">+</span><span class="s2">&quot;created: No history data in &quot;</span>\
                                             <span class="o">+</span><span class="s2">&quot;all runs.&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_no_histories</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># examples: single</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;binary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because of &quot;</span>\
                                              <span class="o">+</span><span class="s2">&quot;missing history in:&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files_single</span><span class="p">,</span>\
                                    <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">SINGLE_INITIAL_KEYS</span><span class="p">,</span> <span class="n">SINGLE_FINAL_KEYS</span><span class="p">)</span>
        <span class="c1"># examples: EEPs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;eep&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Empty_dir</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;No folders found in </span><span class="si">{</span><span class="n">MESA_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">ReplaceValueWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Selected EEPs, switching &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;to single-star grid.&quot;</span><span class="p">):</span>
                <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_PATH</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;eep&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eep_files</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;binary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;No matching EEP file for&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files_single</span><span class="p">,</span>\
                                    <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;eep&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MESA_EEPs_single</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;binary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;No matching EEP file for&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files_single</span><span class="p">,</span>\
                                    <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="c1"># examples: binary grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="n">N_MESA_runs</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># one run (idx==3, without histories) is always skipped</span>
        <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because of &quot;</span>\
                                              <span class="o">+</span><span class="s2">&quot;missing binary history in:&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span>\
                                    <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="p">)</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">BINARY_INITIAL_KEYS</span><span class="p">,</span> <span class="n">BINARY_FINAL_KEYS</span><span class="p">)</span>
        <span class="c1"># examples: v1 run</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because of &quot;</span>\
                                              <span class="o">+</span><span class="s2">&quot;missing binary history in:&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_v1_files</span><span class="p">,</span>\
                                    <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="p">)</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">BINARY_INITIAL_KEYS</span><span class="p">,</span> <span class="n">BINARY_FINAL_KEYS</span><span class="p">)</span>
        <span class="c1"># examples: max_number_of_runs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="n">N_MESA_runs_limited</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;max_number_of_runs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">N_MESA_runs_limited</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span>\
                                <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs_limited</span><span class="p">)</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">BINARY_INITIAL_KEYS</span><span class="p">,</span> <span class="n">BINARY_FINAL_KEYS</span><span class="p">)</span>
        <span class="c1"># examples: decide_columns</span>
        <span class="n">BH_cols</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;star_1_mass&quot;</span><span class="p">,</span> <span class="s2">&quot;star_2_mass&quot;</span><span class="p">)</span>
        <span class="c1">## extra column: &quot;model_number&quot;, others are required ones</span>
        <span class="n">SH_cols</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;model_number&quot;</span><span class="p">,</span> <span class="s2">&quot;surface_h1&quot;</span><span class="p">,</span> <span class="s2">&quot;center_h1&quot;</span><span class="p">,</span> <span class="s2">&quot;center_he4&quot;</span><span class="p">,</span>\
                   <span class="s2">&quot;center_c12&quot;</span><span class="p">,</span> <span class="s2">&quot;log_LH&quot;</span><span class="p">,</span> <span class="s2">&quot;log_LHe&quot;</span><span class="p">,</span> <span class="s2">&quot;log_Lnuc&quot;</span><span class="p">)</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;binary_history_saved_columns&quot;</span><span class="p">,</span> <span class="n">BH_cols</span><span class="p">),</span>\
                 <span class="p">(</span><span class="s2">&quot;star1_history_saved_columns&quot;</span><span class="p">,</span> <span class="n">SH_cols</span><span class="p">),</span>\
                 <span class="p">(</span><span class="s2">&quot;star2_history_saved_columns&quot;</span><span class="p">,</span> <span class="n">SH_cols</span><span class="p">),</span>\
                 <span class="p">(</span><span class="s2">&quot;star1_profile_saved_columns&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;mass&quot;</span><span class="p">,)),</span>\
                 <span class="p">(</span><span class="s2">&quot;star2_profile_saved_columns&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;mass&quot;</span><span class="p">,))]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;binary&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="s2">&quot;model_number&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="s2">&quot;S&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_model_number&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">cols</span>
            <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;of missing binary &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;history in:&quot;</span><span class="p">):</span>
                <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span>\
                                         <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
            <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="p">)</span>
            <span class="k">assert</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">initial_values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span>\
                   <span class="p">(</span><span class="s2">&quot;model_number&quot;</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">)</span>
            <span class="k">assert</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">final_values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span>\
                   <span class="p">(</span><span class="s2">&quot;model_number&quot;</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;of missing binary &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;history in:&quot;</span><span class="p">):</span>
                <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span>\
                                         <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
            <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="p">)</span>
            <span class="k">assert</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">initial_values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span>\
                   <span class="p">((</span><span class="s2">&quot;model_number&quot;</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;binary&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">))</span>
            <span class="k">assert</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">final_values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span>\
                   <span class="p">((</span><span class="s2">&quot;model_number&quot;</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;binary&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;S1_star_age&quot;</span><span class="p">,</span> <span class="s2">&quot;S2_star_age&quot;</span><span class="p">]:</span>
                <span class="k">assert</span> <span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">initial_values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span>\
                       <span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_STAR_HISTORY_COLS</span><span class="p">)</span>
                <span class="k">assert</span> <span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">final_values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span>\
                       <span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_STAR_HISTORY_COLS</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>
            <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;of missing binary &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;history in:&quot;</span><span class="p">):</span>
                <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span>\
                                         <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
            <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="p">)</span>
            <span class="k">assert</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">initial_values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span>\
                   <span class="p">((</span><span class="s2">&quot;model_number&quot;</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;binary&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">))</span>
            <span class="k">assert</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">final_values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span>\
                   <span class="p">((</span><span class="s2">&quot;model_number&quot;</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;binary&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;star1_history_saved_columns&quot;</span><span class="p">:</span>
                <span class="k">assert</span> <span class="s2">&quot;S1_star_age&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">initial_values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
                <span class="k">assert</span> <span class="s2">&quot;S1_star_age&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">final_values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;star2_history_saved_columns&quot;</span><span class="p">:</span>
                <span class="k">assert</span> <span class="s2">&quot;S2_star_age&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">initial_values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
                <span class="k">assert</span> <span class="s2">&quot;S2_star_age&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">final_values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> setting not recognized.&quot;</span><span class="p">):</span>
                <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span>\
                                        <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span>\
                                                         <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="c1"># examples: read star_age from stellar histories</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;star1_history_saved_columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;star_age&quot;</span><span class="p">]</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;star2_history_saved_columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;star_age&quot;</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because of &quot;</span>\
                                              <span class="o">+</span><span class="s2">&quot;missing binary history in:&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span>\
                                    <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="p">)</span>
        <span class="n">ADDITIONAL_KEYS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;S1_star_age&quot;</span><span class="p">,</span> <span class="s2">&quot;S2_star_age&quot;</span><span class="p">]</span> <span class="c1"># more keys then usual</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">BINARY_INITIAL_KEYS</span> <span class="o">+</span> <span class="n">ADDITIONAL_KEYS</span><span class="p">,</span>\
                   <span class="n">BINARY_FINAL_KEYS</span> <span class="o">+</span> <span class="n">ADDITIONAL_KEYS</span><span class="p">)</span>
        <span class="c1"># examples: no He_core_fix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;He_core_fix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because of &quot;</span>\
                                              <span class="o">+</span><span class="s2">&quot;missing binary history in:&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span>\
                                    <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="p">)</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">BINARY_INITIAL_KEYS</span><span class="p">,</span> <span class="n">BINARY_FINAL_KEYS</span><span class="p">)</span>
        <span class="c1"># examples: initial_RLO_fix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;initial_RLO_fix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">totest</span><span class="p">,</span> <span class="s2">&quot;get_nearest_known_initial_RLO&quot;</span><span class="p">,</span>\
                            <span class="n">mock_get_nearest_known_initial_RLO</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because of &quot;</span>\
                                              <span class="o">+</span><span class="s2">&quot;missing binary history in:&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span>\
                                    <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># all runs in initial_RLO_fix</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">BINARY_INITIAL_KEYS</span><span class="p">,</span> <span class="n">BINARY_FINAL_KEYS</span><span class="p">)</span>
        <span class="c1"># examples: initial_RLO_fix and v1 run</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;initial_RLO_fix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because of &quot;</span>\
                                              <span class="o">+</span><span class="s2">&quot;missing binary history in:&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_v1_files</span><span class="p">,</span>\
                                    <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">BINARY_INITIAL_KEYS</span><span class="p">,</span> <span class="n">BINARY_FINAL_KEYS</span><span class="p">)</span>
        <span class="c1"># examples: stop_before_carbon_depletion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;stop_before_carbon_depletion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because of &quot;</span>\
                                              <span class="o">+</span><span class="s2">&quot;missing binary history in:&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span>\
                                    <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="p">)</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">BINARY_INITIAL_KEYS</span><span class="p">,</span> <span class="n">BINARY_FINAL_KEYS</span><span class="p">)</span>
        <span class="c1"># examples: start_at_RLO</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">totest</span><span class="p">,</span> <span class="s2">&quot;keep_after_RLO&quot;</span><span class="p">,</span> <span class="n">mock_keep_after_RLO</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">RLO_fix</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;start_at_RLO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;initial_RLO_fix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RLO_fix</span>
            <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;of missing binary &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;history in:&quot;</span><span class="p">):</span>
                <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span>\
                                         <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">RLO_fix</span><span class="p">:</span> <span class="c1"># all runs are kept in initial_RLO_fix</span>
                <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># only one RLO system</span>
                <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">BINARY_INITIAL_KEYS</span><span class="p">,</span> <span class="n">BINARY_FINAL_KEYS</span><span class="p">)</span>
        <span class="c1"># examples: missing mass columns -&gt; ignore all runs</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_BINARY_HISTORY_COLS</span>\
                      <span class="k">if</span> <span class="s2">&quot;mass&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;binary_history_saved_columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cols</span>
        <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because of &quot;</span>\
                                              <span class="o">+</span><span class="s2">&quot;missing binary history in:&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span>\
                                    <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span>\
                   <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">BINARY_INITIAL_KEYS</span> <span class="k">if</span> <span class="s2">&quot;mass&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">],</span>\
                   <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">BINARY_FINAL_KEYS</span> <span class="k">if</span> <span class="s2">&quot;mass&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">])</span>
        <span class="c1"># examples: missing mass columns -&gt; ignore all runs (single)</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_SINGLE_HISTORY_COLS</span>\
                      <span class="k">if</span> <span class="s2">&quot;mass&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;binary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;star1_history_saved_columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cols</span>
        <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because of &quot;</span>\
                                              <span class="o">+</span><span class="s2">&quot;missing history in:&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files_single</span><span class="p">,</span>\
                                    <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span>\
                   <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">SINGLE_INITIAL_KEYS</span> <span class="k">if</span> <span class="s2">&quot;mass&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">],</span>\
                   <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">SINGLE_FINAL_KEYS</span> <span class="k">if</span> <span class="s2">&quot;mass&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">])</span>
        <span class="c1"># examples: initial values without X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">monkeypatch</span><span class="o">.</span><span class="n">context</span><span class="p">()</span> <span class="k">as</span> <span class="n">mp</span><span class="p">:</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">totest</span><span class="p">,</span> <span class="s2">&quot;initialize_empty_array&quot;</span><span class="p">,</span>\
                       <span class="n">mock_initialize_empty_array_noX</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;of missing binary &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;history in:&quot;</span><span class="p">):</span>
                <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span>\
                                         <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="p">)</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">BINARY_INITIAL_KEYS</span> <span class="k">if</span> <span class="n">k</span><span class="o">!=</span><span class="s2">&quot;X&quot;</span><span class="p">],</span>\
                   <span class="n">BINARY_FINAL_KEYS</span><span class="p">)</span>
        <span class="c1"># examples: initial values without Y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">monkeypatch</span><span class="o">.</span><span class="n">context</span><span class="p">()</span> <span class="k">as</span> <span class="n">mp</span><span class="p">:</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">totest</span><span class="p">,</span> <span class="s2">&quot;initialize_empty_array&quot;</span><span class="p">,</span>\
                       <span class="n">mock_initialize_empty_array_noY</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;of missing binary &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;history in:&quot;</span><span class="p">):</span>
                <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span>\
                                         <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="p">)</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">BINARY_INITIAL_KEYS</span> <span class="k">if</span> <span class="n">k</span><span class="o">!=</span><span class="s2">&quot;Y&quot;</span><span class="p">],</span>\
                   <span class="n">BINARY_FINAL_KEYS</span><span class="p">)</span>
        <span class="c1"># examples: initial values without Z</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">monkeypatch</span><span class="o">.</span><span class="n">context</span><span class="p">()</span> <span class="k">as</span> <span class="n">mp</span><span class="p">:</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">totest</span><span class="p">,</span> <span class="s2">&quot;initialize_empty_array&quot;</span><span class="p">,</span>\
                       <span class="n">mock_initialize_empty_array_noZ</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;of missing binary &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;history in:&quot;</span><span class="p">):</span>
                <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span>\
                                         <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="p">)</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">BINARY_INITIAL_KEYS</span> <span class="k">if</span> <span class="n">k</span><span class="o">!=</span><span class="s2">&quot;Z&quot;</span><span class="p">],</span>\
                   <span class="n">BINARY_FINAL_KEYS</span><span class="p">)</span>
        <span class="c1"># examples: initial_RLO_fix and termination flags: initial RLO and None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;initial_RLO_fix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">with</span> <span class="n">monkeypatch</span><span class="o">.</span><span class="n">context</span><span class="p">()</span> <span class="k">as</span> <span class="n">mp</span><span class="p">:</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">totest</span><span class="p">,</span> <span class="s2">&quot;get_flags_from_MESA_run&quot;</span><span class="p">,</span>\
                       <span class="n">mock_get_flags_from_MESA_run</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;of missing binary &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;history in:&quot;</span><span class="p">):</span>
                <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span>\
                                         <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">BINARY_INITIAL_KEYS</span><span class="p">,</span> <span class="n">BINARY_FINAL_KEYS</span><span class="p">)</span>
        <span class="c1"># examples: slim</span>
        <span class="k">for</span> <span class="n">RLO_fix</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;initial_RLO_fix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RLO_fix</span>
            <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;of missing binary &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;history in:&quot;</span><span class="p">):</span>
                <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span>\
                                         <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">),</span> <span class="n">slim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">RLO_fix</span><span class="p">:</span> <span class="c1"># all runs are kept in initial_RLO_fix</span>
                <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="p">)</span>
            <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">BINARY_INITIAL_KEYS</span><span class="p">,</span> <span class="n">BINARY_FINAL_KEYS</span><span class="p">)</span>
        <span class="c1"># examples: add runs twice (missing reset)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;initial_RLO_fix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># twice warned</span>
        <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">InappropriateValueWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Non synchronous &quot;</span>\
                                                    <span class="o">+</span><span class="s2">&quot;indexing:&quot;</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;of missing binary &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;history in:&quot;</span><span class="p">):</span>
                <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span>\
                                         <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">initial_values</span><span class="p">)</span> <span class="o">==</span> <span class="n">N_MESA_runs</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">final_values</span><span class="p">)</span> <span class="o">==</span> <span class="n">N_MESA_runs</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">MESA_dirs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="o">*</span><span class="n">N_MESA_runs</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">BINARY_INITIAL_KEYS</span><span class="p">,</span> <span class="n">BINARY_FINAL_KEYS</span><span class="p">)</span>
        <span class="c1"># examples: initial_RLO_fix mock returns other period and only TF4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;initial_RLO_fix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">with</span> <span class="n">monkeypatch</span><span class="o">.</span><span class="n">context</span><span class="p">()</span> <span class="k">as</span> <span class="n">mp</span><span class="p">:</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">totest</span><span class="p">,</span> <span class="s2">&quot;get_nearest_known_initial_RLO&quot;</span><span class="p">,</span>\
                       <span class="n">mock_get_nearest_known_initial_RLO2</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;of missing binary &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;history in:&quot;</span><span class="p">):</span>
                <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span>\
                                         <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="p">)</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">BINARY_INITIAL_KEYS</span><span class="p">,</span> <span class="n">BINARY_FINAL_KEYS</span><span class="p">)</span>
        <span class="c1"># examples: no model_number and star_age columns in binary history</span>
        <span class="n">run_path</span> <span class="o">=</span> <span class="n">add_MESA_run_files</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">binary_run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>\
                                      <span class="n">with_histories</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_profiles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_BINARY_HISTORY_COLS</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
        <span class="k">for</span> <span class="n">RLO_fix</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;binary_history_saved_columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cols</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;initial_RLO_fix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RLO_fix</span>
            <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;of missing binary &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;history in:&quot;</span><span class="p">):</span>
                <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Problems with reading &quot;</span>\
                                                      <span class="o">+</span><span class="s2">&quot;file&quot;</span><span class="p">):</span>
                    <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">InappropriateValueWarning</span><span class="p">,</span>\
                               <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because of scrubbed &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;binary history in:&quot;</span><span class="p">):</span>
                        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span>\
                                                 <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">RLO_fix</span><span class="p">:</span> <span class="c1"># all runs are kept in initial_RLO_fix</span>
                <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="p">)</span>
            <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span>\
                       <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">BINARY_INITIAL_KEYS</span>\
                        <span class="k">if</span> <span class="p">((</span><span class="n">k</span><span class="o">!=</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_BINARY_HISTORY_COLS</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span>\
                            <span class="p">(</span><span class="n">k</span><span class="o">!=</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_BINARY_HISTORY_COLS</span><span class="p">[</span><span class="mi">1</span><span class="p">]))],</span>\
                       <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">BINARY_FINAL_KEYS</span>\
                        <span class="k">if</span> <span class="p">((</span><span class="n">k</span><span class="o">!=</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_BINARY_HISTORY_COLS</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span>\
                            <span class="p">(</span><span class="n">k</span><span class="o">!=</span><span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_BINARY_HISTORY_COLS</span><span class="p">[</span><span class="mi">1</span><span class="p">]))])</span>
        <span class="c1"># examples: no model_number and star_age columns in star history</span>
        <span class="n">rmtree</span><span class="p">(</span><span class="n">run_path</span><span class="p">)</span>
        <span class="n">run_path</span> <span class="o">=</span> <span class="n">add_MESA_run_files</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">binary_run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>\
                                      <span class="n">with_histories</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_profiles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because of &quot;</span>\
                                              <span class="o">+</span><span class="s2">&quot;missing binary history in:&quot;</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Problems with reading &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;file&quot;</span><span class="p">):</span>
                <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span>\
                                         <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="p">)</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">BINARY_INITIAL_KEYS</span><span class="p">,</span> <span class="n">BINARY_FINAL_KEYS</span><span class="p">)</span>
        <span class="c1"># examples: no model_number and star_age columns in history (single)</span>
        <span class="n">rmtree</span><span class="p">(</span><span class="n">run_path</span><span class="p">)</span>
        <span class="n">run_path</span> <span class="o">=</span> <span class="n">add_MESA_run_files</span><span class="p">(</span><span class="n">MESA_files_single</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">binary_run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                                      <span class="n">with_histories</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_profiles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;binary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;star1_history_saved_columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="s2">&quot;star_mass&quot;</span><span class="p">]</span>\
         <span class="o">+</span> <span class="n">totest</span><span class="o">.</span><span class="n">DEFAULT_STAR_HISTORY_COLS</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because of &quot;</span>\
                                              <span class="o">+</span><span class="s2">&quot;missing history in:&quot;</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Problems with reading &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;file&quot;</span><span class="p">):</span>
                <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">InappropriateValueWarning</span><span class="p">,</span>\
                           <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because of scrubbed &quot;</span>\
                                 <span class="o">+</span><span class="s2">&quot;history in:&quot;</span><span class="p">):</span>
                    <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files_single</span><span class="p">,</span>\
                                            <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span>\
                                                             <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span>\
                   <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">SINGLE_INITIAL_KEYS</span>\
                    <span class="k">if</span> <span class="p">((</span><span class="s2">&quot;model_number&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;star_age&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">))],</span>\
                   <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">SINGLE_FINAL_KEYS</span>\
                    <span class="k">if</span> <span class="p">((</span><span class="s2">&quot;model_number&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;star_age&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">))])</span>
        <span class="c1"># examples: incomplete lines in star and binary history (additional</span>
        <span class="c1"># model and age)</span>
        <span class="n">rmtree</span><span class="p">(</span><span class="n">run_path</span><span class="p">)</span>
        <span class="n">run_path</span> <span class="o">=</span> <span class="n">add_MESA_run_files</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">binary_run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>\
                                      <span class="n">with_histories</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_profiles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;binary_history_saved_columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cols</span>
        <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because of &quot;</span>\
                                              <span class="o">+</span><span class="s2">&quot;missing binary history in:&quot;</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Some errors were detected !&quot;</span><span class="p">):</span>
                <span class="c1"># actually, it is a ConversionWarning (numpy internal),</span>
                <span class="c1"># which is a child from UserWarning</span>
                <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">ReplaceValueWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Reduce mod in&quot;</span><span class="p">):</span>
                    <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">ReplaceValueWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Reduce age in&quot;</span><span class="p">):</span>
                        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span>\
                                                 <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span>\
                   <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">BINARY_INITIAL_KEYS</span>\
                    <span class="k">if</span> <span class="p">((</span><span class="s2">&quot;model_number&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;age&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">))],</span>\
                   <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">BINARY_FINAL_KEYS</span>\
                    <span class="k">if</span> <span class="p">((</span><span class="s2">&quot;model_number&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;age&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">))])</span>
        <span class="c1"># examples: incomplete lines in star and binary history (missing</span>
        <span class="c1"># model and age)</span>
        <span class="n">rmtree</span><span class="p">(</span><span class="n">run_path</span><span class="p">)</span>
        <span class="n">run_path</span> <span class="o">=</span> <span class="n">add_MESA_run_files</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="n">binary_run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>\
                                      <span class="n">with_histories</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_profiles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;binary_history_saved_columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cols</span>
        <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because of &quot;</span>\
                                              <span class="o">+</span><span class="s2">&quot;missing binary history in:&quot;</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Some errors were detected !&quot;</span><span class="p">):</span>
                <span class="c1"># actually, it is a ConversionWarning (numpy internal),</span>
                <span class="c1"># which is a child from UserWarning</span>
                <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">ReplaceValueWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Expand mod in&quot;</span><span class="p">):</span>
                    <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">ReplaceValueWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Expand age in&quot;</span><span class="p">):</span>
                        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span>\
                                                 <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span>\
                   <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">BINARY_INITIAL_KEYS</span>\
                    <span class="k">if</span> <span class="p">((</span><span class="s2">&quot;model_number&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;age&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">))],</span>\
                   <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">BINARY_FINAL_KEYS</span>\
                    <span class="k">if</span> <span class="p">((</span><span class="s2">&quot;model_number&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;age&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">))])</span>
        <span class="c1"># examples: no data lines in star and binary history</span>
        <span class="n">rmtree</span><span class="p">(</span><span class="n">run_path</span><span class="p">)</span>
        <span class="n">run_path</span> <span class="o">=</span> <span class="n">add_MESA_run_files</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="n">binary_run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>\
                                      <span class="n">with_histories</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_profiles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because of &quot;</span>\
                                              <span class="o">+</span><span class="s2">&quot;missing binary history in:&quot;</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">InappropriateValueWarning</span><span class="p">,</span>
                       <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because of scrubbed binary &quot;</span>\
                             <span class="o">+</span><span class="s2">&quot;history in:&quot;</span><span class="p">):</span>
                <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span>\
                                         <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="p">)</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">BINARY_INITIAL_KEYS</span><span class="p">,</span> <span class="n">BINARY_FINAL_KEYS</span><span class="p">)</span>
        <span class="c1"># examples: no final profile (single)</span>
        <span class="n">rmtree</span><span class="p">(</span><span class="n">run_path</span><span class="p">)</span>
        <span class="n">run_path</span> <span class="o">=</span> <span class="n">add_MESA_run_files</span><span class="p">(</span><span class="n">MESA_files_single</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">binary_run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                                      <span class="n">with_histories</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_profiles</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Including MESA run despite the missing profile in:&quot;</span><span class="p">),</span>\
                 <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Ignored MESA run because of missing profile in:&quot;</span><span class="p">)]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;binary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;accept_missing_profile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flag</span>
            <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because &quot;</span>\
                                                  <span class="o">+</span><span class="s2">&quot;of missing history in:&quot;</span><span class="p">):</span>
                <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="n">message</span><span class="p">):</span>
                    <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files_single</span><span class="p">,</span>\
                                            <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span>\
                                                             <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">SINGLE_INITIAL_KEYS</span><span class="p">,</span> <span class="n">SINGLE_FINAL_KEYS</span><span class="p">)</span>
        <span class="c1"># examples: no star1 history, but star2 history</span>
        <span class="n">rmtree</span><span class="p">(</span><span class="n">run_path</span><span class="p">)</span>
        <span class="n">run_path</span> <span class="o">=</span> <span class="n">add_MESA_run_files</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="n">binary_run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>\
                                      <span class="n">with_histories</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_profiles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because of &quot;</span>\
                                              <span class="o">+</span><span class="s2">&quot;missing binary history in:&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span>\
                                    <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">BINARY_INITIAL_KEYS</span><span class="p">,</span> <span class="n">BINARY_FINAL_KEYS</span><span class="p">)</span>
        <span class="c1"># examples: no star1 history, but star2 history</span>
        <span class="n">rmtree</span><span class="p">(</span><span class="n">run_path</span><span class="p">)</span>
        <span class="n">run_path</span> <span class="o">=</span> <span class="n">add_MESA_run_files</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">binary_run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>\
                                      <span class="n">with_histories</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_profiles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_grid</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;initial_RLO_fix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">MissingFilesWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Ignored MESA run because of &quot;</span>\
                                              <span class="o">+</span><span class="s2">&quot;missing binary history in:&quot;</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">ReplaceValueWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;No star_1_mass in&quot;</span><span class="p">):</span>
                <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">ReplaceValueWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;No star_2_mass in&quot;</span><span class="p">):</span>
                    <span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="n">ReplaceValueWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;No period_days in&quot;</span><span class="p">):</span>
                        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_create_psygrid</span><span class="p">(</span><span class="n">MESA_files</span><span class="p">,</span> <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span>\
                                                 <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">check_len</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">N_MESA_runs</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">check_keys</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">BINARY_INITIAL_KEYS</span><span class="p">,</span> <span class="n">BINARY_FINAL_KEYS</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_add_column">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_add_column">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_add_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">add_column</span><span class="p">)</span>
        <span class="c1"># missing argument</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;missing 2 required positional &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;arguments: &#39;colname&#39; and &#39;array&#39;&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">add_column</span><span class="p">()</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;`array` has 2 elements but the grid &quot;</span>\
                                      <span class="o">+</span><span class="s2">&quot;has 0 runs&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Only adding columns to `final_values` &quot;</span>\
                                      <span class="o">+</span><span class="s2">&quot;allowed.&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">where</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
        <span class="c1"># missing final values</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;The final values have to be a ndarray.&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="c1"># examples</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;TestPSyGrid.h5&quot;</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">final_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s2">&quot;Unit&quot;</span><span class="p">)],</span>\
                                        <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;test1&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">),</span>\
                                               <span class="p">(</span><span class="s1">&#39;test2&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">),</span>\
                                               <span class="p">(</span><span class="s1">&#39;test_state&#39;</span><span class="p">,</span> <span class="s1">&#39;U10&#39;</span><span class="p">)])</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">n_runs</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">new_values1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">new_values1</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">final_values</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">],</span> <span class="n">new_values1</span><span class="p">)</span>
        <span class="c1"># examples: overwrite</span>
        <span class="n">new_values2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">new_values2</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">final_values</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">],</span> <span class="n">new_values2</span><span class="p">)</span>
        <span class="c1"># examples: overwrite protected</span>
        <span class="n">new_values3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">])</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">POSYDONError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Column `test` already exists &quot;</span>\
                                               <span class="o">+</span><span class="s2">&quot;in final values.&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">new_values3</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">final_values</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">],</span> <span class="n">new_values2</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_update_final_values">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_update_final_values">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_update_final_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">update_final_values</span><span class="p">)</span>
        <span class="c1"># missing final values</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;The final values have to be a ndarray.&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">update_final_values</span><span class="p">()</span>
        <span class="c1"># missing filepath</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">final_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;The path of the HDF5 file was not &quot;</span>\
                                      <span class="o">+</span><span class="s2">&quot;defined.&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">update_final_values</span><span class="p">()</span>
        <span class="c1"># examples</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;TestPSyGrid.h5&quot;</span><span class="p">)</span>
        <span class="n">fv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s2">&quot;Unit&quot;</span><span class="p">)],</span>\
                      <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;test1&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;test2&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">),</span>\
                             <span class="p">(</span><span class="s1">&#39;test_state&#39;</span><span class="p">,</span> <span class="s1">&#39;U10&#39;</span><span class="p">)])</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">final_values</span> <span class="o">=</span> <span class="n">fv</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">update_final_values</span><span class="p">()</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="ow">in</span> <span class="n">fv</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">descr</span><span class="p">:</span>
           <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">final_values</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">fv</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
           <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="s1">&#39;test_state&#39;</span><span class="p">:</span>
               <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">hdf5</span><span class="p">[</span><span class="s2">&quot;/grid/final_values&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>\
                                     <span class="n">fv</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">H5_REC_STR_DTYPE</span><span class="p">))</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">hdf5</span><span class="p">[</span><span class="s2">&quot;/grid/final_values&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>\
                                     <span class="n">fv</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="c1"># examples: replace previous</span>
        <span class="n">fv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mf">3.0</span><span class="p">,</span> <span class="s2">&quot;UnitTest&quot;</span><span class="p">)],</span>\
                      <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;test2&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;test_state&#39;</span><span class="p">,</span> <span class="s1">&#39;U10&#39;</span><span class="p">)])</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">final_values</span> <span class="o">=</span> <span class="n">fv</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">update_final_values</span><span class="p">()</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="ow">in</span> <span class="n">fv</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">descr</span><span class="p">:</span>
           <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">final_values</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">fv</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
           <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="s1">&#39;test_state&#39;</span><span class="p">:</span>
               <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">hdf5</span><span class="p">[</span><span class="s2">&quot;/grid/final_values&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>\
                                     <span class="n">fv</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">H5_REC_STR_DTYPE</span><span class="p">))</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">hdf5</span><span class="p">[</span><span class="s2">&quot;/grid/final_values&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>\
                                     <span class="n">fv</span><span class="p">[</span><span class="n">n</span><span class="p">])</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_reload_hdf5_file">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_reload_hdf5_file">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_reload_hdf5_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">_reload_hdf5_file</span><span class="p">)</span>
        <span class="c1"># missing filepath</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;The path of the HDF5 file was not &quot;</span>\
                                      <span class="o">+</span><span class="s2">&quot;defined.&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_reload_hdf5_file</span><span class="p">()</span>
        <span class="c1"># examples</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;TestPSyGrid.h5&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">writeable</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">_reload_hdf5_file</span><span class="p">(</span><span class="n">writeable</span><span class="o">=</span><span class="n">writeable</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">hdf5</span><span class="p">,</span> <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">hdf5</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;r+&#39;</span> <span class="k">if</span> <span class="n">writeable</span> <span class="k">else</span> <span class="s1">&#39;r&#39;</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_load">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_load">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">,</span> <span class="n">grid_path</span><span class="p">,</span> <span class="n">grid_path_negative_run</span><span class="p">,</span>\
                  <span class="n">grid_path_additional_run</span><span class="p">,</span> <span class="n">grid_path_missing_run</span><span class="p">,</span>\
                  <span class="n">grid_path_no_runs</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">)</span>
        <span class="c1"># missing filepath</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;The path of the HDF5 file was not &quot;</span>\
                                      <span class="o">+</span><span class="s2">&quot;defined.&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;TestPSyGrid.h5&quot;</span><span class="p">))</span>
        <span class="c1"># bad PSyGrid</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Negative index -1 does not make sense&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path_negative_run</span><span class="p">)</span>
        <span class="c1"># bad PSyGrid</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;More runs than MESA dirs</span><span class="se">\\</span><span class="s2">? Gaps</span><span class="se">\\</span><span class="s2">?&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path_additional_run</span><span class="p">)</span>
        <span class="c1"># bad PSyGrid</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Some runs are missing from the HDF5 &quot;</span>\
                                    <span class="o">+</span><span class="s2">&quot;grid.&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path_missing_run</span><span class="p">)</span>
        <span class="c1"># examples</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">n_runs</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="c1"># examples: no runs</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path_no_runs</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">n_runs</span> <span class="o">==</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_close">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_close">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
        <span class="c1"># examples: neither None nor file handler</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">hdf5</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">hdf5</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="c1"># examples: None</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">hdf5</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="c1"># examples: open file</span>
        <span class="n">test_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;TestPSyGrid.h5&quot;</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">hdf5</span> <span class="o">=</span> <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">test_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">OSError</span><span class="p">):</span> <span class="c1"># file is already open</span>
            <span class="n">test_file</span> <span class="o">=</span> <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">test_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">hdf5</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="c1"># try to reopen, which will raise an error in case the closing failed</span>
        <span class="n">test_file</span> <span class="o">=</span> <span class="n">totest</span><span class="o">.</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">test_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">test_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_str">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_str">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">,</span> <span class="n">grid_path</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__str__</span><span class="p">)</span>
        <span class="c1"># examples: no grid</span>
        <span class="n">PSyGrid_str</span> <span class="o">=</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="k">assert</span> <span class="s2">&quot;PSyGrid instance:&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;No HDF5 file path. PSyGrid instance is likely empty.&quot;</span>\
               <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="c1"># examples: test grid</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on load should fail</span>
            <span class="k">assert</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">grid_path</span>
            <span class="k">return</span>
        <span class="n">PSyGrid_str</span> <span class="o">=</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="k">assert</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">n_runs</span><span class="si">}</span><span class="s2"> runs found. They include:&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;1 binary_history files.&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;1 history1 files.&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;1 history2 files.&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;1 final_profile1 files.&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;1 final_profile2 files.&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;Columns in binary_history: (&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;Columns in history1: (&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;Columns in history2: (&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;Columns in final_profile1: (&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;Columns in final_profile2: (&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;Columns in initial values:&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;Columns in final values:&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;Configuration:&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;Relative paths to MESA run directories:&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="c1"># examples: no runs</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">n_runs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="s2">&quot;No runs found in the grid (empty or &#39;slim&#39; version).&quot;</span>\
               <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="c1"># examples: runs without histories and profiles</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on load should fail</span>
            <span class="k">assert</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">grid_path</span>
            <span class="k">return</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">n_runs</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># the first run has no histories and profiles</span>
        <span class="n">PSyGrid_str</span> <span class="o">=</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="k">assert</span> <span class="s2">&quot;0 binary_history files.&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;0 history1 files.&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;0 history2 files.&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;0 final_profile1 files.&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;0 final_profile2 files.&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;Columns in binary_history: (&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;Columns in history1: (&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;Columns in history2: (&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;Columns in final_profile1: (&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="k">assert</span> <span class="s2">&quot;Columns in final_profile2: (&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">PSyGrid_str</span>
        <span class="c1"># examples: no initial values</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on load should fail</span>
            <span class="k">assert</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">grid_path</span>
            <span class="k">return</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">initial_values</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="s2">&quot;Initial values array is not loaded.&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="c1"># examples: no final values</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on load should fail</span>
            <span class="k">assert</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">grid_path</span>
            <span class="k">return</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">final_values</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="s2">&quot;Final values array is not loaded.&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="c1"># examples: no configuration</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on load should fail</span>
            <span class="k">assert</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">grid_path</span>
            <span class="k">return</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">assert</span> <span class="s2">&quot;Configuration:</span><span class="se">\n\t</span><span class="s2">(empty)&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="c1"># examples: MESA_dirs</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on load should fail</span>
            <span class="k">assert</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">grid_path</span>
            <span class="k">return</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">MESA_dirs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">assert</span> <span class="s2">&quot;No MESA directory found.&quot;</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">MESA_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;dir1&quot;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="s2">&quot;Relative paths to MESA run directories:</span><span class="se">\n\t</span><span class="s2">dir1</span><span class="se">\n</span><span class="s2">&quot;</span>\
               <span class="o">==</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()[</span><span class="o">-</span><span class="mi">46</span><span class="p">:]</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">MESA_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;dir1&quot;</span><span class="p">,</span> <span class="s2">&quot;dir2&quot;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="s2">&quot;Relative paths to MESA run directories:</span><span class="se">\n\t</span><span class="s2">dir1</span><span class="se">\n\t</span><span class="s2">dir2</span><span class="se">\n</span><span class="s2">&quot;</span>\
               <span class="o">==</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()[</span><span class="o">-</span><span class="mi">52</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">MESA_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;dir</span><span class="si">{</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">)]</span>
            <span class="k">assert</span> <span class="s2">&quot;Relative paths to MESA run directories:</span><span class="se">\n\t</span><span class="s2">dir1</span><span class="se">\n</span><span class="s2">&quot;</span>\
                   <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">...(</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> other directories)</span><span class="se">\n\t</span><span class="s2">dir</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>\
                   <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="c1"># examples: neither runs nor MESA_dirs</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">n_runs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">MESA_dirs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">assert</span> <span class="s2">&quot;Relative paths to MESA run directories:&quot;</span>\
               <span class="ow">not</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_getitem">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_getitem">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_getitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">,</span> <span class="n">grid_path</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">)</span>
        <span class="c1"># missing argument</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;missing 1 required positional &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;argument: &#39;index&#39;&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">()</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Index None is not of type int&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Index </span><span class="si">{</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">n_runs</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> out of &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;bounds.&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">n_runs</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># examples</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on load should fail</span>
            <span class="k">assert</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">grid_path</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">n_runs</span><span class="p">):</span>
            <span class="n">test_run</span> <span class="o">=</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">test_run</span><span class="p">,</span> <span class="n">totest</span><span class="o">.</span><span class="n">PSyRunView</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">test_run</span><span class="o">.</span><span class="n">psygrid</span> <span class="o">==</span> <span class="n">PSyGrid</span>
            <span class="k">assert</span> <span class="n">test_run</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">i</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_get_pandas_initial_final">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_get_pandas_initial_final">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_get_pandas_initial_final</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">,</span> <span class="n">grid_path</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">get_pandas_initial_final</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;&#39;NoneType&#39; object has no &quot;</span>\
                                          <span class="o">+</span><span class="s2">&quot;attribute &#39;dtype&#39;&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">get_pandas_initial_final</span><span class="p">()</span>
        <span class="c1"># examples</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on load should fail</span>
            <span class="k">assert</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">grid_path</span>
            <span class="k">return</span>
        <span class="n">test_df</span> <span class="o">=</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">get_pandas_initial_final</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">initial_values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="k">assert</span> <span class="s2">&quot;initial_&quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">test_df</span>
            <span class="c1"># for float types allow nans, but others e.g. strings would fail on</span>
            <span class="c1"># allowing nans</span>
            <span class="n">allow_nan</span> <span class="o">=</span> <span class="s1">&#39;f&#39;</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">initial_values</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">descr</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">initial_values</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>\
                                  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;initial_&quot;</span><span class="o">+</span><span class="n">key</span><span class="p">]),</span>\
                                  <span class="n">equal_nan</span><span class="o">=</span><span class="n">allow_nan</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">final_values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="k">assert</span> <span class="s2">&quot;final_&quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">test_df</span>
            <span class="c1"># for float types allow nans, but others e.g. strings would fail on</span>
            <span class="c1"># allowing nans</span>
            <span class="n">allow_nan</span> <span class="o">=</span> <span class="s1">&#39;f&#39;</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">final_values</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">descr</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">final_values</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>\
                                  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;final_&quot;</span><span class="o">+</span><span class="n">key</span><span class="p">]),</span>\
                                  <span class="n">equal_nan</span><span class="o">=</span><span class="n">allow_nan</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_len">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_len">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_len</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__len__</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">n_runs</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">==</span> <span class="n">i</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_contains">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_contains">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">)</span>
        <span class="c1"># missing argument</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;missing 1 required positional &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;argument: &#39;index&#39;&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">()</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Index None is not of type int&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="c1"># examples</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">n_runs</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">j</span><span class="o">&lt;</span><span class="n">i</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_iter">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_iter">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">,</span> <span class="n">grid_path</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__iter__</span><span class="p">)</span>
        <span class="c1"># examples</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on load should fail</span>
            <span class="k">assert</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">grid_path</span>
            <span class="k">return</span>
        <span class="n">test_iterator</span> <span class="o">=</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__iter__</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">test_iterator</span><span class="p">,</span> <span class="n">totest</span><span class="o">.</span><span class="n">PSyGridIterator</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">test_iterator</span><span class="o">.</span><span class="n">_grid</span> <span class="o">==</span> <span class="n">PSyGrid</span>
        <span class="k">assert</span> <span class="n">test_iterator</span><span class="o">.</span><span class="n">_index</span> <span class="o">==</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_del">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_del">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_del</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">mock_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">close_check</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;close_check&#39; is already set.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close_check</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__del__</span><span class="p">)</span>
        <span class="c1"># examples</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">close_check</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span> <span class="n">mock_close</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__del__</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">close_check</span> <span class="o">==</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_rerun">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_rerun">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_rerun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">,</span> <span class="n">grid_path</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">check_grid_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">runs</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">f</span><span class="p">)</span> <span class="o">==</span> <span class="n">runs</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">rerun</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on load should fail</span>
            <span class="k">assert</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">grid_path</span>
            <span class="k">return</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Either &#39;runs_to_rerun&#39; or &quot;</span>\
                                      <span class="o">+</span><span class="s2">&quot;&#39;termination_flags&#39; has to be &quot;</span>\
                                      <span class="o">+</span><span class="s2">&quot;specified and therefore different &quot;</span>\
                                      <span class="o">+</span><span class="s2">&quot;from None.&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">rerun</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="n">tmp_path</span><span class="p">)</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;&#39;runs_to_rerun&#39; should be a list or &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;None.&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">rerun</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">runs_to_rerun</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">IndexError</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">rerun</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">runs_to_rerun</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;&#39;termination_flags&#39; should be a string &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;or a list of strings.&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">rerun</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">termination_flags</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;&#39;flags_to_check&#39; should be a string or &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;a list of strings.&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">rerun</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">termination_flags</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>\
                          <span class="n">flags_to_check</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;&#39;new_mesa_flag&#39; should be a dictionary &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;or None&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">rerun</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">runs_to_rerun</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>\
                          <span class="n">new_mesa_flag</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
        <span class="c1"># examples: list of runs</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">rerun</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">runs_to_rerun</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">check_grid_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;grid.csv&quot;</span><span class="p">),</span> <span class="n">runs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># examples: termination_flags</span>
        <span class="n">new_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;termination_flags_test1&quot;</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">rerun</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="n">new_path</span><span class="p">,</span> <span class="n">termination_flags</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
        <span class="n">check_grid_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="s2">&quot;grid.csv&quot;</span><span class="p">))</span>
        <span class="c1"># examples: termination_flags, specify flag (single string)</span>
        <span class="n">new_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;termination_flags_test2&quot;</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">rerun</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="n">new_path</span><span class="p">,</span> <span class="n">termination_flags</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>\
                      <span class="n">flags_to_check</span><span class="o">=</span><span class="s1">&#39;termination_flag_1&#39;</span><span class="p">)</span>
        <span class="n">check_grid_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="s2">&quot;grid.csv&quot;</span><span class="p">))</span>
        <span class="c1"># examples: termination_flags, specify flag(s) (list)</span>
        <span class="n">new_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;termination_flags_test3&quot;</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">rerun</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="n">new_path</span><span class="p">,</span> <span class="n">termination_flags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>\
                                                                <span class="s2">&quot;test&quot;</span><span class="p">],</span>\
                      <span class="n">flags_to_check</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;termination_flag_1&#39;</span><span class="p">,</span>\
                                      <span class="s1">&#39;termination_flag_2&#39;</span><span class="p">])</span>
        <span class="n">check_grid_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="s2">&quot;grid.csv&quot;</span><span class="p">))</span>
        <span class="c1"># examples: termination_flags, specify flag(s) (tuple)</span>
        <span class="n">new_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;termination_flags_test4&quot;</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">rerun</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="n">new_path</span><span class="p">,</span> <span class="n">termination_flags</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>\
                                                                <span class="s2">&quot;TF1&quot;</span><span class="p">),</span>\
                      <span class="n">flags_to_check</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;termination_flag_1&#39;</span><span class="p">,</span>\
                                      <span class="s1">&#39;termination_flag_2&#39;</span><span class="p">))</span>
        <span class="n">check_grid_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="s2">&quot;grid.csv&quot;</span><span class="p">),</span> <span class="n">runs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># examples: list of runs and termination_flags</span>
        <span class="n">new_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;termination_flags_test5&quot;</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">rerun</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="n">new_path</span><span class="p">,</span> <span class="n">runs_to_rerun</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>\
                      <span class="n">termination_flags</span><span class="o">=</span><span class="s2">&quot;TF1&quot;</span><span class="p">)</span>
        <span class="n">check_grid_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="s2">&quot;grid.csv&quot;</span><span class="p">),</span> <span class="n">runs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># examples: list of runs and termination_flags, no initial values</span>
        <span class="n">new_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;termination_flags_test6&quot;</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">initial_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">)])</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">rerun</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="n">new_path</span><span class="p">,</span> <span class="n">runs_to_rerun</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>\
                      <span class="n">termination_flags</span><span class="o">=</span><span class="s2">&quot;TF1&quot;</span><span class="p">)</span>
        <span class="n">check_grid_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="s2">&quot;grid.csv&quot;</span><span class="p">),</span> <span class="n">runs</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># examples: list of runs and termination_flags, other initial values</span>
        <span class="n">new_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;termination_flags_test7&quot;</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">initial_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>\
                                           <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)],</span>\
                                          <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;star_1_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">),</span>\
                                                 <span class="p">(</span><span class="s1">&#39;star_2_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">),</span>\
                                                 <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">)])</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">rerun</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="n">new_path</span><span class="p">,</span> <span class="n">runs_to_rerun</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>\
                      <span class="n">termination_flags</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
        <span class="n">check_grid_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="s2">&quot;grid.csv&quot;</span><span class="p">),</span> <span class="n">runs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="s2">&quot;grid.csv&quot;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># check header</span>
                    <span class="k">assert</span> <span class="n">line</span> <span class="o">==</span> <span class="s2">&quot;m1,m2,initial_z</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span> <span class="c1"># check data</span>
                    <span class="k">assert</span> <span class="n">line</span> <span class="o">==</span> <span class="s2">&quot;1.0,1.0,0.01</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="c1"># examples: list of runs and termination_flags, other initial values,</span>
        <span class="c1"># other Z values</span>
        <span class="n">new_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;termination_flags_test8&quot;</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">MESA_dirs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span>\
                                <span class="n">PSyGrid</span><span class="o">.</span><span class="n">MESA_dirs</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="sa">b</span><span class="s2">&quot;m1_1.0_m2_1.0_&quot;</span>\
                                <span class="o">+</span><span class="sa">b</span><span class="s2">&quot;initial_period_in_days_0.0_Zbase_0.01_&quot;</span>\
                                <span class="o">+</span><span class="sa">b</span><span class="s2">&quot;new_Z_0.01_idx_0&quot;</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">rerun</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="n">new_path</span><span class="p">,</span> <span class="n">runs_to_rerun</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>\
                      <span class="n">termination_flags</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
        <span class="n">check_grid_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="s2">&quot;grid.csv&quot;</span><span class="p">),</span> <span class="n">runs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="s2">&quot;grid.csv&quot;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># check header</span>
                    <span class="k">assert</span> <span class="n">line</span> <span class="o">==</span> <span class="s2">&quot;m1,m2,Zbase,new_Z</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span> <span class="c1"># check data</span>
                    <span class="k">assert</span> <span class="n">line</span> <span class="o">==</span> <span class="s2">&quot;1.0,1.0,0.01,0.01</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="c1"># examples: list of runs and new mesa flags</span>
        <span class="n">new_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;termination_flags_test9&quot;</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">rerun</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="n">new_path</span><span class="p">,</span> <span class="n">runs_to_rerun</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>\
                      <span class="n">new_mesa_flag</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;test2&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s2">&quot;test3&quot;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">})</span>
        <span class="n">check_grid_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="s2">&quot;grid.csv&quot;</span><span class="p">),</span> <span class="n">runs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="s2">&quot;grid.csv&quot;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># check header</span>
                    <span class="k">assert</span> <span class="n">line</span> <span class="o">==</span> <span class="s2">&quot;m1,m2,Zbase,new_Z,test2,test3</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span> <span class="c1"># check data</span>
                    <span class="k">assert</span> <span class="n">line</span> <span class="o">==</span> <span class="s2">&quot;1.0,1.0,0.01,0.01,2.0,3.0</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="c1"># bad input</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">MESA_dirs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">GridError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;No MESA dirs of previous runs &quot;</span>\
                                            <span class="o">+</span><span class="s2">&quot;in the grid.&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">rerun</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="n">new_path</span><span class="p">,</span> <span class="n">runs_to_rerun</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>\
                          <span class="n">termination_flags</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_plot2D">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_plot2D">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_plot2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">):</span>
        <span class="k">class</span><span class="w"> </span><span class="nc">mock_plot2D_class</span><span class="p">:</span>
            <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psygrid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="n">psygrid</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
            <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">plot2D</span><span class="p">)</span>
        <span class="c1"># missing argument</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;missing 2 required positional &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;arguments: &#39;x_var_str&#39; and &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;&#39;y_var_str&#39;&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">plot2D</span><span class="p">()</span>
        <span class="c1"># examples: check defaults</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">totest</span><span class="p">,</span> <span class="s2">&quot;plot2D&quot;</span><span class="p">,</span> <span class="n">mock_plot2D_class</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">plot2D</span><span class="p">(</span><span class="s2">&quot;test_x_str&quot;</span><span class="p">,</span> <span class="s2">&quot;test_y_str&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;x_var_str&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;test_x_str&quot;</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;y_var_str&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;test_y_str&quot;</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_var_str&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;termination_flag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;termination_flag_1&#39;</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;grid_3D&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;slice_3D_var_str&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;slice_3D_var_range&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;grid_4D&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;slice_4D_var_str&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;slice_4D_var_range&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;extra_grid&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;slice_at_RLO&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;MARKERS_COLORS_LEGENDS&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;max_cols&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;legend_pos&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;verbose&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span>
        <span class="c1"># examples: test all the arguments</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;z_var_str&#39;</span><span class="p">:</span> <span class="s2">&quot;Test&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;termination_flag&#39;</span><span class="p">:</span> <span class="s2">&quot;Test&quot;</span><span class="p">},</span>\
                 <span class="p">{</span><span class="s1">&#39;grid_3D&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;slice_3D_var_str&#39;</span><span class="p">:</span> <span class="s2">&quot;Test&quot;</span><span class="p">},</span>\
                 <span class="p">{</span><span class="s1">&#39;slice_3D_var_range&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)},</span> <span class="p">{</span><span class="s1">&#39;grid_4D&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>\
                 <span class="p">{</span><span class="s1">&#39;slice_4D_var_str&#39;</span><span class="p">:</span> <span class="s2">&quot;Test&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;slice_4D_var_range&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)},</span>\
                 <span class="p">{</span><span class="s1">&#39;extra_grid&#39;</span><span class="p">:</span> <span class="s2">&quot;Test&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;slice_at_RLO&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>\
                 <span class="p">{</span><span class="s1">&#39;MARKERS_COLORS_LEGENDS&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Unit&quot;</span><span class="p">:</span> <span class="s2">&quot;Test&quot;</span><span class="p">}},</span>\
                 <span class="p">{</span><span class="s1">&#39;max_cols&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;legend_pos&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>\
                 <span class="p">{</span><span class="s1">&#39;test_keyword&#39;</span><span class="p">:</span> <span class="s2">&quot;Test&quot;</span><span class="p">}]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">kwargs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tests</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">plot2D</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;test_x_str_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;test_y_str_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;x_var_str&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="sa">f</span><span class="s2">&quot;test_x_str_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;y_var_str&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="sa">f</span><span class="s2">&quot;test_y_str_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_plot">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_plot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">,</span> <span class="n">grid_path</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">):</span>
        <span class="k">class</span><span class="w"> </span><span class="nc">mock_plot1D_class</span><span class="p">:</span>
            <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">run</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No runs to plot.&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">run</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;idx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">run</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">idx_list</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">run</span><span class="p">:</span>
                        <span class="n">idx_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;idx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_list</span>
                <span class="n">run</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">psygrid</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
            <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">plot</span><span class="p">)</span>
        <span class="c1"># missing argument</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;missing 3 required positional &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;arguments: &#39;idx&#39;, &#39;x_var_str&#39;, and &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;&#39;y_var_str&#39;&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Invalid idx = None!&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;test_x_str&quot;</span><span class="p">,</span> <span class="s2">&quot;test_y_str&quot;</span><span class="p">)</span>
        <span class="c1"># examples: check defaults, use index list</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on load should fail</span>
            <span class="k">assert</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">grid_path</span>
            <span class="k">return</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">totest</span><span class="p">,</span> <span class="s2">&quot;plot1D&quot;</span><span class="p">,</span> <span class="n">mock_plot1D_class</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;test_x_str&quot;</span><span class="p">,</span> <span class="s2">&quot;test_y_str&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;idx&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;x_var_str&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;test_x_str&quot;</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;y_var_str&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;test_y_str&quot;</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;z_var_str&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;binary_history&#39;</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;verbose&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span>
        <span class="c1"># examples: test all the arguments</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;z_var_str&#39;</span><span class="p">:</span> <span class="s2">&quot;Test&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;history&#39;</span><span class="p">:</span> <span class="s2">&quot;Test&quot;</span><span class="p">},</span>\
                 <span class="p">{</span><span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;test_keyword&#39;</span><span class="p">:</span> <span class="s2">&quot;Test&quot;</span><span class="p">}]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">kwargs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tests</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">n_runs</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;test_x_str_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>\
                         <span class="sa">f</span><span class="s2">&quot;test_y_str_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;idx&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="o">%</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">n_runs</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;x_var_str&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="sa">f</span><span class="s2">&quot;test_x_str_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;y_var_str&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="sa">f</span><span class="s2">&quot;test_y_str_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_HR">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_HR">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_HR</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">,</span> <span class="n">grid_path</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">):</span>
        <span class="k">class</span><span class="w"> </span><span class="nc">mock_plot1D_class</span><span class="p">:</span>
            <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">run</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No runs to plot.&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">run</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;idx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">run</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">idx_list</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">run</span><span class="p">:</span>
                        <span class="n">idx_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;idx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_list</span>
                <span class="n">run</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">psygrid</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
            <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">HR</span><span class="p">)</span>
        <span class="c1"># missing argument</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;missing 1 required positional &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;argument: &#39;idx&#39;&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">HR</span><span class="p">()</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Invalid idx = None!&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">HR</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="c1"># examples: check defaults</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on load should fail</span>
            <span class="k">assert</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">grid_path</span>
            <span class="k">return</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">totest</span><span class="p">,</span> <span class="s2">&quot;plot1D&quot;</span><span class="p">,</span> <span class="n">mock_plot1D_class</span><span class="p">)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">HR</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;idx&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;x_var_str&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;y_var_str&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;history1&#39;</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;star_states&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;verbose&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span>
        <span class="c1"># examples: test all the arguments beside states</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;history&#39;</span><span class="p">:</span> <span class="s2">&quot;Test&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>\
                 <span class="p">{</span><span class="s1">&#39;test_keyword&#39;</span><span class="p">:</span> <span class="s2">&quot;Test&quot;</span><span class="p">}]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">kwargs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tests</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">HR</span><span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">n_runs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;idx&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="o">%</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">n_runs</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span>
        <span class="c1"># examples: test states (works only for run 0)</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">PSyGrid</span><span class="o">.</span><span class="n">HR</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">states</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;idx&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;HR&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span>
        <span class="k">assert</span> <span class="s1">&#39;star_states&#39;</span> <span class="ow">in</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;star_states&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="TestPSyGrid.test_eq">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGrid.test_eq">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_eq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">,</span> <span class="n">grid_path</span><span class="p">,</span> <span class="n">capsys</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">mock_getitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">((</span><span class="s2">&quot;description&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span>\
                                                    <span class="o">==</span> <span class="s2">&quot;missing run&quot;</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">totest</span><span class="o">.</span><span class="n">PSyRunView</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">totest</span><span class="o">.</span><span class="n">PSyRunView</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">mock_getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;binary_history&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;description&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">psygrid</span><span class="o">.</span><span class="n">config</span><span class="p">)</span> <span class="ow">and</span>\
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psygrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;missing run&quot;</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.0e+2</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.0e+3</span><span class="p">)],</span>\
                                <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;period_days&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">)</span>
        <span class="c1"># missing argument</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;missing 1 required positional &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;argument: &#39;other&#39;&quot;</span><span class="p">):</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">()</span>
        <span class="c1"># bad input</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>
        <span class="k">assert</span> <span class="s2">&quot;COMPARISON: Only PSyGrid instances should be compared.&quot;</span>\
               <span class="ow">in</span> <span class="n">capsys</span><span class="o">.</span><span class="n">readouterr</span><span class="p">()</span><span class="o">.</span><span class="n">out</span>
        <span class="c1"># examples: same grids</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on load should fail</span>
            <span class="k">assert</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">grid_path</span>
            <span class="k">return</span>
        <span class="n">test_PSyGrid</span> <span class="o">=</span> <span class="n">totest</span><span class="o">.</span><span class="n">PSyGrid</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">test_PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on load should fail</span>
            <span class="k">assert</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">grid_path</span>
            <span class="k">return</span>
        <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">test_PSyGrid</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span>
        <span class="c1"># examples: different length, with and without verbose</span>
        <span class="n">test_PSyGrid</span><span class="o">.</span><span class="n">n_runs</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">test_PSyGrid</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
                <span class="k">assert</span> <span class="s2">&quot;COMPARISON: The grids do not contain the same number &quot;</span>\
                       <span class="o">+</span><span class="sa">f</span><span class="s2">&quot;of runs (</span><span class="si">{</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">n_runs</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">test_PSyGrid</span><span class="o">.</span><span class="n">n_runs</span><span class="si">}</span><span class="s2">)&quot;</span>\
                       <span class="ow">in</span> <span class="n">capsys</span><span class="o">.</span><span class="n">readouterr</span><span class="p">()</span><span class="o">.</span><span class="n">out</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">capsys</span><span class="o">.</span><span class="n">readouterr</span><span class="p">()</span><span class="o">.</span><span class="n">out</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
        <span class="c1"># examples: different config</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_TO_BE_CONSISTENT</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span>\
                                                       <span class="s2">&quot;description&quot;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">test_PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on load should fail</span>
                <span class="k">assert</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">grid_path</span>
                <span class="k">return</span>
            <span class="n">test_PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Test&quot;</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">test_PSyGrid</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>\
                   <span class="o">==</span> <span class="p">(</span><span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">PROPERTIES_TO_BE_CONSISTENT</span><span class="p">)</span>
            <span class="k">assert</span> <span class="sa">f</span><span class="s2">&quot;COMPARISON: Property `</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">` is not the same &quot;</span>\
                   <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="si">}</span><span class="s2"> != Test)&quot;</span>\
                   <span class="ow">in</span> <span class="n">capsys</span><span class="o">.</span><span class="n">readouterr</span><span class="p">()</span><span class="o">.</span><span class="n">out</span>
        <span class="c1"># examples: different initial/final values</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;initial_values&quot;</span><span class="p">,</span> <span class="s2">&quot;COMPARISON: Columns in `initial_values` &quot;</span>\
                                    <span class="o">+</span><span class="s2">&quot;do not match:</span><span class="se">\n</span><span class="s2">period_days</span><span class="se">\n</span><span class="s2">!=</span><span class="se">\n</span><span class="s2">Test&quot;</span><span class="p">),</span>\
                 <span class="p">(</span><span class="s2">&quot;final_values&quot;</span><span class="p">,</span> <span class="s2">&quot;Number of columns in `final_values` do &quot;</span>\
                                  <span class="o">+</span><span class="s2">&quot;not match (2 != 1)&quot;</span><span class="p">)]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">m</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">test_PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on load should fail</span>
                <span class="k">assert</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">grid_path</span>
                <span class="k">return</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">test_PSyGrid</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">)]))</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">test_PSyGrid</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>
            <span class="k">assert</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">capsys</span><span class="o">.</span><span class="n">readouterr</span><span class="p">()</span><span class="o">.</span><span class="n">out</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;initial_values&quot;</span><span class="p">,</span> <span class="s2">&quot;final_values&quot;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">test_PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on load should fail</span>
                <span class="k">assert</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">grid_path</span>
                <span class="k">return</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">test_PSyGrid</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="nb">getattr</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span>\
                                                     <span class="nb">getattr</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="n">t</span><span class="p">))))</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">test_PSyGrid</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>
            <span class="k">assert</span> <span class="sa">f</span><span class="s2">&quot; in `</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">` not of same length.&quot;</span> <span class="ow">in</span> <span class="n">capsys</span><span class="o">.</span><span class="n">readouterr</span><span class="p">()</span><span class="o">.</span><span class="n">out</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;initial_values&quot;</span><span class="p">,</span> <span class="s2">&quot;final_values&quot;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">test_PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on load should fail</span>
                <span class="k">assert</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">grid_path</span>
                <span class="k">return</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">test_PSyGrid</span><span class="p">,</span> <span class="n">t</span><span class="p">)[:]</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">test_PSyGrid</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>
            <span class="k">assert</span> <span class="sa">f</span><span class="s2">&quot; in `</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">` is not the same&quot;</span> <span class="ow">in</span> <span class="n">capsys</span><span class="o">.</span><span class="n">readouterr</span><span class="p">()</span><span class="o">.</span><span class="n">out</span>
        <span class="c1"># examples: different runs</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">test_PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on load should fail</span>
            <span class="k">assert</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">grid_path</span>
            <span class="k">return</span>
        <span class="n">test_PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;missing run&quot;</span>
        <span class="k">with</span> <span class="n">monkeypatch</span><span class="o">.</span><span class="n">context</span><span class="p">()</span> <span class="k">as</span> <span class="n">mp</span><span class="p">:</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="s2">&quot;__getitem__&quot;</span><span class="p">,</span> <span class="n">mock_getitem</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">test_PSyGrid</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>
            <span class="k">assert</span> <span class="s2">&quot;COMPARISON: Table `binary_history` for run `1` missing &quot;</span>\
                   <span class="o">+</span> <span class="s2">&quot;in 2nd grid.&quot;</span> <span class="ow">in</span> <span class="n">capsys</span><span class="o">.</span><span class="n">readouterr</span><span class="p">()</span><span class="o">.</span><span class="n">out</span>
        <span class="c1"># examples: different runs</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">test_PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on load should fail</span>
            <span class="k">assert</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">grid_path</span>
            <span class="k">return</span>
        <span class="n">test_PSyGrid</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;missing run&quot;</span>
        <span class="k">with</span> <span class="n">monkeypatch</span><span class="o">.</span><span class="n">context</span><span class="p">()</span> <span class="k">as</span> <span class="n">mp</span><span class="p">:</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">PSyRunView</span><span class="p">,</span> <span class="s2">&quot;__getattr__&quot;</span><span class="p">,</span> <span class="n">mock_getattr</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">PSyGrid</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">test_PSyGrid</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>
            <span class="k">assert</span> <span class="s2">&quot;COMPARISON: Table `binary_history` for run `1` is not &quot;</span>\
                   <span class="o">+</span><span class="s2">&quot;the same.&quot;</span> <span class="ow">in</span> <span class="n">capsys</span><span class="o">.</span><span class="n">readouterr</span><span class="p">()</span><span class="o">.</span><span class="n">out</span></div>
</div>



<div class="viewcode-block" id="TestPSyGridIterator">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGridIterator">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestPSyGridIterator</span><span class="p">:</span>
<div class="viewcode-block" id="TestPSyGridIterator.grid_path">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGridIterator.grid_path">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">grid_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span> <span class="n">profile</span><span class="p">):</span>
        <span class="c1"># a path to a psygrid file for testing</span>
        <span class="k">return</span> <span class="n">get_PSyGrid</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestPSyGridIterator.PSyGrid">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGridIterator.PSyGrid">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">PSyGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid_path</span><span class="p">):</span>
        <span class="c1"># initialize an PSyGrid for testing</span>
        <span class="n">test_PSyGrid</span> <span class="o">=</span> <span class="n">totest</span><span class="o">.</span><span class="n">PSyGrid</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">test_PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on load should fail</span>
            <span class="k">assert</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">grid_path</span>
            <span class="k">return</span>
        <span class="k">return</span> <span class="n">test_PSyGrid</span></div>


<div class="viewcode-block" id="TestPSyGridIterator.PSyGridIterator">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGridIterator.PSyGridIterator">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">PSyGridIterator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">):</span>
        <span class="c1"># initialize an instance of the class with defaults</span>
        <span class="k">return</span> <span class="n">totest</span><span class="o">.</span><span class="n">PSyGridIterator</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">)</span></div>


    <span class="c1"># test the PSyGridIterator class</span>
<div class="viewcode-block" id="TestPSyGridIterator.test_init">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGridIterator.test_init">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGridIterator</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGridIterator</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>
        <span class="c1"># check that the instance is of correct type and all code in the</span>
        <span class="c1"># __init__ got executed: the elements are created and initialized</span>
        <span class="k">assert</span> <span class="n">PSyGridIterator</span><span class="o">.</span><span class="n">_grid</span> <span class="o">==</span> <span class="n">PSyGrid</span>
        <span class="k">assert</span> <span class="n">PSyGridIterator</span><span class="o">.</span><span class="n">_index</span> <span class="o">==</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="TestPSyGridIterator.test_next">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyGridIterator.test_next">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGridIterator</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyGridIterator</span><span class="o">.</span><span class="fm">__next__</span><span class="p">)</span>
        <span class="c1"># iterate throught the grid</span>
        <span class="k">assert</span> <span class="n">PSyGridIterator</span><span class="o">.</span><span class="n">_index</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">PSyGridIterator</span><span class="o">.</span><span class="n">_grid</span><span class="o">.</span><span class="n">n_runs</span><span class="p">):</span>
            <span class="n">test_run</span> <span class="o">=</span> <span class="n">PSyGridIterator</span><span class="o">.</span><span class="fm">__next__</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">test_run</span><span class="o">.</span><span class="n">psygrid</span> <span class="o">==</span> <span class="n">PSyGridIterator</span><span class="o">.</span><span class="n">_grid</span>
            <span class="k">assert</span> <span class="n">test_run</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">i</span>
            <span class="k">assert</span> <span class="n">PSyGridIterator</span><span class="o">.</span><span class="n">_index</span> <span class="o">==</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="c1"># end of iteration</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">StopIteration</span><span class="p">):</span>
            <span class="n">PSyGridIterator</span><span class="o">.</span><span class="fm">__next__</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="TestPSyRunView">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyRunView">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestPSyRunView</span><span class="p">:</span>
<div class="viewcode-block" id="TestPSyRunView.grid_path">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyRunView.grid_path">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">grid_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span> <span class="n">profile</span><span class="p">):</span>
        <span class="c1"># a path to a psygrid file for testing</span>
        <span class="k">return</span> <span class="n">get_PSyGrid</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">binary_history</span><span class="p">,</span> <span class="n">star_history</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestPSyRunView.PSyGrid">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyRunView.PSyGrid">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">PSyGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid_path</span><span class="p">):</span>
        <span class="c1"># initialize an PSyGrid for testing</span>
        <span class="n">test_PSyGrid</span> <span class="o">=</span> <span class="n">totest</span><span class="o">.</span><span class="n">PSyGrid</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">test_PSyGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">grid_path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on load should fail</span>
            <span class="k">assert</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">grid_path</span>
            <span class="k">return</span>
        <span class="k">return</span> <span class="n">test_PSyGrid</span></div>


<div class="viewcode-block" id="TestPSyRunView.PSyRunView">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyRunView.PSyRunView">[docs]</a>
    <span class="nd">@fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">PSyRunView</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">):</span>
        <span class="c1"># initialize an instance of the class with defaults</span>
        <span class="k">return</span> <span class="n">totest</span><span class="o">.</span><span class="n">PSyRunView</span><span class="p">(</span><span class="n">PSyGrid</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>


    <span class="c1"># test the PSyRunView class</span>
<div class="viewcode-block" id="TestPSyRunView.test_init">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyRunView.test_init">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyRunView</span><span class="p">,</span> <span class="n">PSyGrid</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyRunView</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>
        <span class="c1"># check that the instance is of correct type and all code in the</span>
        <span class="c1"># __init__ got executed: the elements are created and initialized</span>
        <span class="k">assert</span> <span class="n">PSyRunView</span><span class="o">.</span><span class="n">psygrid</span> <span class="o">==</span> <span class="n">PSyGrid</span>
        <span class="k">assert</span> <span class="n">PSyRunView</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="TestPSyRunView.test_hdf5_key">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyRunView.test_hdf5_key">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_hdf5_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyRunView</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyRunView</span><span class="o">.</span><span class="n">_hdf5_key</span><span class="p">)</span>
        <span class="c1"># examples</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">PSyRunView</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">assert</span> <span class="sa">f</span><span class="s2">&quot;/grid/run</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="n">PSyRunView</span><span class="o">.</span><span class="n">_hdf5_key</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestPSyRunView.test_getitem">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyRunView.test_getitem">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_getitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyRunView</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyRunView</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">)</span>
        <span class="c1"># missing argument</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;missing 1 required positional &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;argument: &#39;key&#39;&quot;</span><span class="p">):</span>
            <span class="n">PSyRunView</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">()</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Key Test not in list of valid keys.&quot;</span><span class="p">):</span>
            <span class="n">PSyRunView</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="c1"># examples</span>
        <span class="n">PSyRunView</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">VALID_KEYS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;initial_values&quot;</span><span class="p">,</span> <span class="s2">&quot;final_values&quot;</span><span class="p">]:</span>
                <span class="k">assert</span> <span class="n">PSyRunView</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="c1"># examples</span>
        <span class="n">PSyRunView</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">totest</span><span class="o">.</span><span class="n">VALID_KEYS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;initial_values&quot;</span><span class="p">,</span> <span class="s2">&quot;final_values&quot;</span><span class="p">]:</span>
                <span class="k">assert</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">PSyRunView</span><span class="o">.</span><span class="n">psygrid</span><span class="p">[</span><span class="n">PSyRunView</span><span class="o">.</span><span class="n">index</span><span class="p">],</span> <span class="n">k</span><span class="p">)</span>\
                       <span class="o">==</span> <span class="n">PSyRunView</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">PSyRunView</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">k</span><span class="p">),</span>\
                        <span class="nb">getattr</span><span class="p">(</span><span class="n">PSyRunView</span><span class="o">.</span><span class="n">psygrid</span><span class="p">[</span><span class="n">PSyRunView</span><span class="o">.</span><span class="n">index</span><span class="p">],</span> <span class="n">k</span><span class="p">))</span>
        <span class="c1"># bad input</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;The HDF5 file is not open.&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">PSyRunView</span><span class="o">.</span><span class="n">psygrid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span> <span class="c1"># skip test as test on close should fail</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;The HDF5 file is not open.&quot;</span><span class="p">)</span>
            <span class="n">PSyRunView</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">VALID_KEYS</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="TestPSyRunView.test_getattr">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyRunView.test_getattr">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyRunView</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">mock_getitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getitem_check</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;getitem_check&#39; is already set.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getitem_check</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyRunView</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">)</span>
        <span class="c1"># missing argument</span>
        <span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;missing 1 required positional &quot;</span>\
                                     <span class="o">+</span><span class="s2">&quot;argument: &#39;key&#39;&quot;</span><span class="p">):</span>
            <span class="n">PSyRunView</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">()</span>
        <span class="c1"># examples</span>
        <span class="n">PSyRunView</span><span class="o">.</span><span class="n">getitem_check</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">totest</span><span class="o">.</span><span class="n">PSyRunView</span><span class="p">,</span> <span class="s2">&quot;__getitem__&quot;</span><span class="p">,</span> <span class="n">mock_getitem</span><span class="p">)</span>
        <span class="n">PSyRunView</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">PSyRunView</span><span class="o">.</span><span class="n">getitem_check</span> <span class="o">==</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="TestPSyRunView.test_str">
<a class="viewcode-back" href="../../../../api_reference/posydon.unit_tests.grids.html#posydon.unit_tests.grids.test_psygrid.TestPSyRunView.test_str">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PSyRunView</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isroutine</span><span class="p">(</span><span class="n">PSyRunView</span><span class="o">.</span><span class="fm">__str__</span><span class="p">)</span>
        <span class="c1"># examples</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">PSyRunView</span><span class="o">.</span><span class="n">psygrid</span><span class="o">.</span><span class="n">n_runs</span><span class="p">):</span>
            <span class="n">PSyRunView</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">assert</span> <span class="sa">f</span><span class="s2">&quot;View of the run </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> in the file &quot;</span>\
                   <span class="o">+</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">PSyRunView</span><span class="o">.</span><span class="n">psygrid</span><span class="o">.</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&#39; at key &quot;</span>\
                   <span class="o">+</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">PSyRunView</span><span class="o">.</span><span class="n">_hdf5_key</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39;&quot;</span> <span class="o">==</span> <span class="n">PSyRunView</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Tassos Fragos.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>