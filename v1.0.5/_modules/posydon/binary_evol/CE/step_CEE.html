<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>posydon.binary_evol.CE.step_CEE &mdash; posydon 1.0.5 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            posydon
          </a>
              <div class="version">
                1.0.5
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../data/data.html">Data Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api.html">Application Programming Interface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Binary Star Grids</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../run_mesa_grids/inifile.html">.ini file documentation for POSYDON GRIDS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../run_mesa_grids/fixed/fixed.html">Run a fixed MESA grid</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../PSyGrid/PSyGrid.html">The PSyGrid Object</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Generating Populations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../pop_synth/POSYDON_populations.html">Running populations using POSYDON</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pop_synth/pop_synth.html">Running a POSYDON population synthesis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pop_synth/custom_flow.html">Custom population synthesis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../SingleStar/SingleStar.html">The SingleStar object</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../BinaryStar/BinaryStar.html">The BinaryStar object</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../advanced_pop_options/custom_hooks.html">Evolutionary Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../advanced_pop_options/debugging_binaries.html">Debugging Failed Binaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../interpolation/IF-Interpolator/IFInterpolator.html">Initial-Final Interpolation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Plotting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../visualization/plot1D/plot1D.html">1D plotting functionalities for POSYDON GRIDS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../visualization/plot2D/plot2D.html">2D plotting functionalities for POSYDON GRIDS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../visualization/VHD/VHD.html">Van den Heuvel diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../interpolation/violinplot.html">Making the Violin Plot</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../about/licence.html">Licence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../about/attribution.html">Attribution</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">posydon</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">posydon.binary_evol.CE.step_CEE</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for posydon.binary_evol.CE.step_CEE</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Common envelope evolution step.</span>

<span class="sd">Calculates the evolution of a star in a BinaryStar object. It uses</span>
<span class="sd">the alpha-perscription and caclulates how much the orbit has to shrink in</span>
<span class="sd">order to expel its envelope. If in that separation, one of the star fills its</span>
<span class="sd">RL, then the system is considered a merger. Else the common envelope is lost</span>
<span class="sd">and we are left with a binary system with the core of the donor star (which</span>
<span class="sd">initiated the unstable CEE) and the core of the copmanion. For now it works</span>
<span class="sd">with the donor star being either a type of H_giant (with a He core) or</span>
<span class="sd">He_giant (with a CO core) and the companion star being either a MS or compact</span>
<span class="sd">object star, not contribyting to the CE.</span>

<span class="sd">If profiles exist we are able to calculate on the spot the lambda parameter</span>
<span class="sd">for the donor star, else we use the default values</span>

<span class="sd">Parameters</span>
<span class="sd">----------</span>
<span class="sd">binary : BinaryStar (An objets of class BinaryStar defined in POSYDON)</span>
<span class="sd">verbose : Boolean</span>
<span class="sd">    In case we want information about the CEE  (the default is False).</span>

<span class="sd">&quot;&quot;&quot;</span>


<span class="n">__authors__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Emmanouil Zapartas &lt;ezapartas@gmail.com&gt;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Devina Misra &lt;devina.misra@unige.ch&gt;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Jaime Roman Garza &lt;Jaime.Roman@etu.unige.ch&gt;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Simone Bavera &lt;Simone.Bavera@unige.ch&gt;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Konstantinos Kovlakas &lt;Konstantinos.Kovlakas@unige.ch&gt;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Jeffrey Andrews &lt;jeffrey.andrews@northwestern.edu&gt;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Tassos Fragos &lt;Anastasios.Fragkos@unige.ch&gt;&quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">posydon.utils</span> <span class="kn">import</span> <span class="n">common_functions</span> <span class="k">as</span> <span class="n">cf</span>
<span class="kn">from</span> <span class="nn">posydon.utils</span> <span class="kn">import</span> <span class="n">constants</span> <span class="k">as</span> <span class="n">const</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">posydon.binary_evol.binarystar</span> <span class="kn">import</span> <span class="n">BINARYPROPERTIES</span>
<span class="kn">from</span> <span class="nn">posydon.binary_evol.singlestar</span> <span class="kn">import</span> <span class="n">STARPROPERTIES</span>
<span class="kn">from</span> <span class="nn">posydon.utils.common_functions</span> <span class="kn">import</span> <span class="n">PATH_TO_POSYDON</span>
<span class="kn">from</span> <span class="nn">posydon.utils.common_functions</span> <span class="kn">import</span> <span class="n">check_state_of_star</span>
<span class="kn">from</span> <span class="nn">posydon.utils.common_functions</span> <span class="kn">import</span> <span class="n">calculate_lambda_from_profile</span>


<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;always&#39;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>


<span class="n">MODEL</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;prescription&quot;</span><span class="p">:</span> <span class="s1">&#39;alpha-lambda&#39;</span><span class="p">,</span>
         <span class="s2">&quot;common_envelope_efficiency&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
         <span class="s2">&quot;common_envelope_lambda_default&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
         <span class="s2">&quot;common_envelope_option_for_lambda&quot;</span><span class="p">:</span> <span class="s1">&#39;lambda_from_grid_final_values&#39;</span><span class="p">,</span>
         <span class="s2">&quot;common_envelope_option_for_HG_star&quot;</span><span class="p">:</span> <span class="s2">&quot;optimistic&quot;</span><span class="p">,</span>
         <span class="s2">&quot;common_envelope_alpha_thermal&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
         <span class="s2">&quot;core_definition_H_fraction&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>     <span class="c1"># with 0.01 no CE BBHs</span>
         <span class="s2">&quot;core_definition_He_fraction&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
         <span class="s2">&quot;CEE_tolerance_err&quot;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span>
         <span class="s2">&quot;verbose&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
         <span class="s2">&quot;common_envelope_option_after_succ_CEE&quot;</span><span class="p">:</span> <span class="s1">&#39;core_not_replaced_noMT&#39;</span><span class="p">,</span>
         <span class="c1"># &quot;core_replaced_noMT&quot; for core_definition_H_fraction=0.01</span>
         <span class="p">}</span>


<span class="c1"># common_envelope_option_for_lambda:</span>
<span class="c1"># 1) &#39;default_lambda&#39;: using for lambda the constant value of</span>
<span class="c1"># common_envelope_lambda_default parameter</span>
<span class="c1"># 2) &#39;lambda_from_grid_final_values&#39;: using lambda parameter from MESA history</span>
<span class="c1"># which was calulated ni the same way as method (5) below</span>
<span class="c1"># 3) &#39;lambda_from_profile_gravitational&#39;: calculating the lambda parameter</span>
<span class="c1"># from the donor&#39;s profile by using the gravitational binding energy from the</span>
<span class="c1"># surface to the core (needing &quot;mass&quot;, and &quot;radius&quot; as columns in the profile)</span>
<span class="c1"># 4) &#39;lambda_from_profile_gravitational_plus_internal&#39;: as above but taking</span>
<span class="c1"># into account a factor of common_envelope_alpha_thermal * internal energy too</span>
<span class="c1"># in the binding energy (needing also &quot;energy&quot; as column in the profile)</span>
<span class="c1"># 5) &#39;lambda_from_profile_gravitational_plus_internal_minus_recombination&#39;:</span>
<span class="c1"># as above but not taking into account the recombination energy in the internal</span>
<span class="c1"># energy (needing also &quot;y_mass_fraction_He&quot;, &quot;x_mass_fraction_H&quot;,</span>
<span class="c1"># &quot;neutral_fraction_H&quot;, &quot;neutral_fraction_He&quot;, and &quot;avg_charge_He&quot; as column</span>
<span class="c1"># in the profile)</span>
<span class="c1"># the mass fraction of an element which is used as threshold to define a core,</span>


<span class="n">STAR_STATE_POST_MS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;H-rich_Core_H_burning&quot;</span><span class="p">,</span>
    <span class="s2">&quot;H-rich_Shell_H_burning&quot;</span><span class="p">,</span>
    <span class="s2">&quot;H-rich_Core_He_burning&quot;</span><span class="p">,</span>
    <span class="s2">&quot;H-rich_Central_He_depleted&quot;</span><span class="p">,</span>
    <span class="s2">&quot;H-rich_Central_C_depletion&quot;</span><span class="p">,</span>
    <span class="s2">&quot;H-rich_non_burning&quot;</span>
<span class="p">]</span>


<span class="n">STAR_STATE_POST_HeMS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;stripped_He_Core_He_burning&#39;</span><span class="p">,</span>
    <span class="s1">&#39;stripped_He_Central_He_depleted&#39;</span><span class="p">,</span>
    <span class="s1">&#39;stripped_He_Central_C_depletion&#39;</span><span class="p">,</span>
    <span class="s1">&#39;stripped_He_non_burning&#39;</span>
<span class="p">]</span>


<div class="viewcode-block" id="StepCEE"><a class="viewcode-back" href="../../../../api/posydon.binary_evol.CE.step_CEE.html#posydon.binary_evol.CE.step_CEE.StepCEE">[docs]</a><span class="k">class</span> <span class="nc">StepCEE</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute supernova final remnant mass, fallback fraction &amp; stellar state.</span>

<span class="sd">    This consider the nearest neighboor of the He core mass of the star,</span>
<span class="sd">    previous to the collapse. Considering a set of data for which the He core</span>
<span class="sd">    mass of the compact object projenitos previous the collapse, the final</span>
<span class="sd">    remnant mass and final stellar state of the compact object is known.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    verbose : bool</span>
<span class="sd">        If True, the messages will be prited in the console.</span>


<span class="sd">    Keyword Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    prescription : str</span>
<span class="sd">        Prescription to use for computing the prediction of common enevelope</span>
<span class="sd">        evolution. Available options are:</span>

<span class="sd">        * &#39;alpha-lambda&#39; : Considers the the alpha-lambda prescription</span>
<span class="sd">        described in [1] and [2] to predict the outcome of the common envelope</span>
<span class="sd">        evolution. If the profile of the donor star is available then it is</span>
<span class="sd">        used to compute the value of lambda.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Webbink, R. F. (1984). Double white dwarfs as progenitors of R</span>
<span class="sd">    Coronae Borealis stars and Type I supernovae. The Astrophysical Journal,</span>
<span class="sd">    277, 355-360.</span>

<span class="sd">    .. [2] De Kool, M. (1990). Common envelope evolution and double cores of</span>
<span class="sd">    planetary nebulae. The Astrophysical Journal, 358, 189-195.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">prescription</span><span class="o">=</span><span class="n">MODEL</span><span class="p">[</span><span class="s1">&#39;prescription&#39;</span><span class="p">],</span>
            <span class="n">common_envelope_efficiency</span><span class="o">=</span><span class="n">MODEL</span><span class="p">[</span><span class="s1">&#39;common_envelope_efficiency&#39;</span><span class="p">],</span>
            <span class="n">common_envelope_lambda_default</span><span class="o">=</span><span class="n">MODEL</span><span class="p">[</span>
                <span class="s1">&#39;common_envelope_lambda_default&#39;</span><span class="p">],</span>
            <span class="n">common_envelope_option_for_lambda</span><span class="o">=</span><span class="n">MODEL</span><span class="p">[</span>
                <span class="s1">&#39;common_envelope_option_for_lambda&#39;</span><span class="p">],</span>
            <span class="n">common_envelope_option_for_HG_star</span><span class="o">=</span><span class="n">MODEL</span><span class="p">[</span>
                <span class="s1">&#39;common_envelope_option_for_HG_star&#39;</span><span class="p">],</span>
            <span class="n">common_envelope_option_after_succ_CEE</span><span class="o">=</span><span class="n">MODEL</span><span class="p">[</span>
                <span class="s1">&#39;common_envelope_option_after_succ_CEE&#39;</span><span class="p">],</span>
            <span class="n">common_envelope_alpha_thermal</span><span class="o">=</span><span class="n">MODEL</span><span class="p">[</span>
                <span class="s1">&#39;common_envelope_alpha_thermal&#39;</span><span class="p">],</span>
            <span class="n">core_definition_H_fraction</span><span class="o">=</span><span class="n">MODEL</span><span class="p">[</span>
                <span class="s1">&#39;core_definition_H_fraction&#39;</span><span class="p">],</span>
            <span class="n">core_definition_He_fraction</span><span class="o">=</span><span class="n">MODEL</span><span class="p">[</span>
                <span class="s1">&#39;core_definition_He_fraction&#39;</span><span class="p">],</span>
            <span class="n">CEE_tolerance_err</span><span class="o">=</span><span class="n">MODEL</span><span class="p">[</span><span class="s1">&#39;CEE_tolerance_err&#39;</span><span class="p">],</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">MODEL</span><span class="p">[</span><span class="s1">&#39;verbose&#39;</span><span class="p">],</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a StepCEE instance.&quot;&quot;&quot;</span>
        <span class="c1"># read kwargs to initialize the class</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">MODEL</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; is not a valid parameter name!&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">varname</span> <span class="ow">in</span> <span class="n">MODEL</span><span class="p">:</span>
                <span class="n">default_value</span> <span class="o">=</span> <span class="n">MODEL</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">default_value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prescription</span> <span class="o">=</span> <span class="n">prescription</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">common_envelope_efficiency</span> <span class="o">=</span> <span class="n">common_envelope_efficiency</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">common_envelope_lambda_default</span> <span class="o">=</span> \
                <span class="n">common_envelope_lambda_default</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">common_envelope_option_for_lambda</span> <span class="o">=</span> \
                <span class="n">common_envelope_option_for_lambda</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">common_envelope_option_for_HG_star</span> <span class="o">=</span> \
                <span class="n">common_envelope_option_for_HG_star</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">common_envelope_alpha_thermal</span> <span class="o">=</span> <span class="n">common_envelope_alpha_thermal</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">core_definition_H_fraction</span> <span class="o">=</span> <span class="n">core_definition_H_fraction</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">core_definition_He_fraction</span> <span class="o">=</span> <span class="n">core_definition_He_fraction</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CEE_tolerance_err</span> <span class="o">=</span> <span class="n">CEE_tolerance_err</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">common_envelope_option_after_succ_CEE</span> <span class="o">=</span> \
                <span class="n">common_envelope_option_after_succ_CEE</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path_to_posydon</span> <span class="o">=</span> <span class="n">PATH_TO_POSYDON</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">binary</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform the CEE step for a BinaryStar object.&quot;&quot;&quot;</span>
        <span class="c1"># Determine which star is the donor and which is the companion</span>
        <span class="k">if</span> <span class="n">binary</span><span class="o">.</span><span class="n">event</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;oCE1&quot;</span><span class="p">,</span> <span class="s2">&quot;oDoubleCE1&quot;</span><span class="p">]:</span>
            <span class="n">donor_star</span> <span class="o">=</span> <span class="n">binary</span><span class="o">.</span><span class="n">star_1</span>
            <span class="n">comp_star</span> <span class="o">=</span> <span class="n">binary</span><span class="o">.</span><span class="n">star_2</span>
        <span class="k">elif</span> <span class="n">binary</span><span class="o">.</span><span class="n">event</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;oCE2&quot;</span><span class="p">,</span> <span class="s2">&quot;oDoubleCE2&quot;</span><span class="p">]:</span>
            <span class="n">donor_star</span> <span class="o">=</span> <span class="n">binary</span><span class="o">.</span><span class="n">star_2</span>
            <span class="n">comp_star</span> <span class="o">=</span> <span class="n">binary</span><span class="o">.</span><span class="n">star_1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CEE does not apply if `event` is not &quot;</span>
                             <span class="s2">&quot;`oCE1`, &#39;oDoubleCE1&#39; or `oCE2`, &#39;oDoubleCE1&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Check for double CE</span>
        <span class="k">if</span> <span class="n">binary</span><span class="o">.</span><span class="n">event</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;oDoubleCE1&quot;</span><span class="p">,</span> <span class="s2">&quot;oDoubleCE2&quot;</span><span class="p">]:</span>
            <span class="n">double_CE</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">double_CE</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;binary.event : &quot;</span><span class="p">,</span> <span class="n">binary</span><span class="o">.</span><span class="n">event</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;common_envelope_efficiency : &quot;</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">common_envelope_efficiency</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;common_envelope_option_for_lambda : &quot;</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">common_envelope_option_for_lambda</span><span class="p">)</span>

        <span class="c1"># Check to make sure binary can go through a CE</span>
        <span class="k">if</span> <span class="n">donor_star</span><span class="o">.</span><span class="n">state</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;H-rich_Core_H_burning&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;stripped_He_Core_He_burning&#39;</span><span class="p">]:</span>
            <span class="c1"># system merges</span>
            <span class="n">binary</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s1">&#39;merged&#39;</span>
            <span class="n">binary</span><span class="o">.</span><span class="n">event</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">BINARYPROPERTIES</span><span class="p">:</span>
                <span class="c1"># the binary attributes that are changed in the CE step</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="s1">&#39;V_sys&#39;</span><span class="p">,</span> <span class="s1">&#39;mass_transfer_case&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;nearest_neighbour_distance&#39;</span><span class="p">]:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>    <span class="c1"># the rest become np.nan</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;mass_transfer_case&#39;</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">)</span>
            <span class="n">stars</span> <span class="o">=</span> <span class="p">[</span><span class="n">donor_star</span><span class="p">,</span> <span class="n">comp_star</span><span class="p">]</span>
            <span class="c1"># for now we just add all initial mass to the (merger) star_1</span>
            <span class="n">masses</span> <span class="o">=</span> <span class="p">[</span><span class="n">donor_star</span><span class="o">.</span><span class="n">mass</span> <span class="o">+</span> <span class="n">comp_star</span><span class="o">.</span><span class="n">mass</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span>
            <span class="n">star_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">donor_star</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">comp_star</span><span class="o">.</span><span class="n">state</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">star</span><span class="p">,</span> <span class="n">star_state</span><span class="p">,</span> <span class="n">mass</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">stars</span><span class="p">,</span> <span class="n">star_states</span><span class="p">,</span> <span class="n">masses</span><span class="p">):</span>
                <span class="n">star</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="n">mass</span>
                <span class="n">star</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">star_state</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">STARPROPERTIES</span><span class="p">:</span>
                    <span class="c1"># the binary attributes that are changed in the CE step</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;mass&quot;</span><span class="p">,</span> <span class="s2">&quot;state&quot;</span><span class="p">]:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">star</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">common_envelope_option_for_HG_star</span> <span class="o">==</span> <span class="s2">&quot;pessimistic&quot;</span><span class="p">:</span>
            <span class="c1"># Merging if HG donor</span>
            <span class="k">if</span> <span class="n">donor_star</span><span class="o">.</span><span class="n">state</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;H-rich_Shell_H_burning&#39;</span><span class="p">]:</span>
                <span class="c1"># system merges</span>
                <span class="n">binary</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s1">&#39;merged&#39;</span>
                <span class="n">binary</span><span class="o">.</span><span class="n">event</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">BINARYPROPERTIES</span><span class="p">:</span>
                    <span class="c1"># the binary attributes that are changed in the CE step</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="s1">&#39;V_sys&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;mass_transfer_case&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;nearest_neighbour_distance&#39;</span><span class="p">]:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>   <span class="c1"># the rest become np.nan</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;mass_transfer_case&#39;</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">)</span>
                <span class="n">stars</span> <span class="o">=</span> <span class="p">[</span><span class="n">donor_star</span><span class="p">,</span> <span class="n">comp_star</span><span class="p">]</span>
                <span class="c1"># for now we just add all initial mass to the (merger) star_1</span>
                <span class="n">masses</span> <span class="o">=</span> <span class="p">[</span><span class="n">donor_star</span><span class="o">.</span><span class="n">mass</span> <span class="o">+</span> <span class="n">comp_star</span><span class="o">.</span><span class="n">mass</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span>
                <span class="n">star_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">donor_star</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">comp_star</span><span class="o">.</span><span class="n">state</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">star</span><span class="p">,</span> <span class="n">star_state</span><span class="p">,</span> <span class="n">mass</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">stars</span><span class="p">,</span> <span class="n">star_states</span><span class="p">,</span> <span class="n">masses</span><span class="p">):</span>
                    <span class="n">star</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="n">mass</span>
                    <span class="n">star</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">star_state</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">STARPROPERTIES</span><span class="p">:</span>
                        <span class="c1"># the binary attributes that are changed in the CE step</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;mass&quot;</span><span class="p">,</span> <span class="s2">&quot;state&quot;</span><span class="p">]:</span>
                            <span class="nb">setattr</span><span class="p">(</span><span class="n">star</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="c1"># Calculate binary&#39;s evolution</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prescription</span> <span class="o">==</span> <span class="s1">&#39;alpha-lambda&#39;</span><span class="p">:</span>

            <span class="c1"># Determine lambda and associated CE parameters</span>
            <span class="n">lambda1_CE</span><span class="p">,</span> <span class="n">mc1_i</span><span class="p">,</span> <span class="n">rc1_i</span><span class="p">,</span> <span class="n">donor_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_lambda_CE</span><span class="p">(</span>
                <span class="n">donor_star</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">double_CE</span><span class="p">:</span>
                <span class="n">lambda2_CE</span><span class="p">,</span> <span class="n">mc2_i</span><span class="p">,</span> <span class="n">rc2_i</span><span class="p">,</span> <span class="n">comp_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_lambda_CE</span><span class="p">(</span>
                    <span class="n">comp_star</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lambda2_CE</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">mc2_i</span> <span class="o">=</span> <span class="n">comp_star</span><span class="o">.</span><span class="n">mass</span>
                <span class="n">rc2_i</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">comp_star</span><span class="o">.</span><span class="n">log_R</span>
                <span class="n">comp_type</span> <span class="o">=</span> <span class="s2">&quot;not_giant_companion&quot;</span>

            <span class="c1"># Evolve binary</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CEE_simple_alpha_prescription</span><span class="p">(</span>
                <span class="n">binary</span><span class="p">,</span> <span class="n">donor_star</span><span class="p">,</span> <span class="n">comp_star</span><span class="p">,</span> <span class="n">lambda1_CE</span><span class="p">,</span>
                <span class="n">mc1_i</span><span class="p">,</span> <span class="n">rc1_i</span><span class="p">,</span> <span class="n">donor_type</span><span class="p">,</span> <span class="n">lambda2_CE</span><span class="p">,</span> <span class="n">mc2_i</span><span class="p">,</span> <span class="n">rc2_i</span><span class="p">,</span> <span class="n">comp_type</span><span class="p">,</span>
                <span class="n">double_CE</span><span class="o">=</span><span class="n">double_CE</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
                <span class="n">common_envelope_option_after_succ_CEE</span><span class="o">=</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">common_envelope_option_after_succ_CEE</span><span class="p">),</span>
                <span class="n">core_definition_H_fraction</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">core_definition_H_fraction</span><span class="p">,</span>
                <span class="n">core_definition_He_fraction</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">core_definition_He_fraction</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid common envelope prescription given.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="StepCEE.calculate_lambda_CE"><a class="viewcode-back" href="../../../../api/posydon.binary_evol.CE.step_CEE.html#posydon.binary_evol.CE.step_CEE.StepCEE.calculate_lambda_CE">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_lambda_CE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">donor</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate lambda_CE from an assumed constant value or from profile.</span>

<span class="sd">        If lambda_CE is calculated from donor&#39;s profile, we also pass a more</span>
<span class="sd">        accurate calculation of the donor core mass for the purposes of CEE.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        donor : instance of SingleStar</span>
<span class="sd">            The donor star to calculate pre-CE quantities.</span>
<span class="sd">        verbose : bool</span>
<span class="sd">            In case we want information about the CEE  (the default is False).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        lambda_CE: float</span>
<span class="sd">            lambda_CE calculated either as an assumed constant value or</span>
<span class="sd">            calculated from profile</span>
<span class="sd">        mc1_i: float</span>
<span class="sd">            If lambda_CE is calculated from donor&#39;s profile, we also pass a</span>
<span class="sd">            more accurate calculation of the donor core mass for the purposes</span>
<span class="sd">            of CEE.</span>
<span class="sd">        rc1_i: float</span>
<span class="sd">            The radius of the donor&#39;s core</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">m1_i</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">mass</span>
        <span class="n">radius1</span> <span class="o">=</span> <span class="mf">10.</span> <span class="o">**</span> <span class="n">donor</span><span class="o">.</span><span class="n">log_R</span>

        <span class="k">if</span> <span class="n">donor</span><span class="o">.</span><span class="n">state</span> <span class="ow">in</span> <span class="n">STAR_STATE_POST_MS</span><span class="p">:</span>       <span class="c1"># &quot;H_Giant&quot;:</span>
            <span class="n">donor_type</span> <span class="o">=</span> <span class="s1">&#39;He_core&#39;</span>
            <span class="n">core_element_fraction_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_definition_H_fraction</span>
            <span class="k">if</span> <span class="n">core_element_fraction_definition</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;He-core defintion should always be &quot;</span>
                                 <span class="s2">&quot;set to a H abundance of 1%, 10%, or 30%&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">donor</span><span class="o">.</span><span class="n">state</span> <span class="ow">in</span> <span class="n">STAR_STATE_POST_HeMS</span><span class="p">:</span>   <span class="c1"># &quot;He_Giant&quot;:</span>
            <span class="n">donor_type</span> <span class="o">=</span> <span class="s1">&#39;CO_core&#39;</span>
            <span class="n">core_element_fraction_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_definition_He_fraction</span>
            <span class="k">if</span> <span class="n">core_element_fraction_definition</span> <span class="o">!=</span> <span class="mf">0.1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CO-core should always be &quot;</span>
                                 <span class="s2">&quot;set to a He abudance of 10%&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;type = </span><span class="si">%s</span><span class="s2"> of donor of CEE not recognized&quot;</span>
                             <span class="o">%</span> <span class="n">donor</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">common_envelope_option_for_lambda</span> <span class="o">==</span> <span class="s2">&quot;default_lambda&quot;</span><span class="p">:</span>
            <span class="n">lambda_CE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">common_envelope_lambda_default</span>
            <span class="k">if</span> <span class="n">donor_type</span> <span class="o">==</span> <span class="s1">&#39;He_core&#39;</span><span class="p">:</span>
                <span class="n">mc1_i</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">he_core_mass</span>
                <span class="n">rc1_i</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">he_core_radius</span>
            <span class="k">elif</span> <span class="n">donor_type</span> <span class="o">==</span> <span class="s2">&quot;CO_core&quot;</span><span class="p">:</span>
                <span class="n">mc1_i</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">co_core_mass</span>
                <span class="n">rc1_i</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">co_core_radius</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;type = </span><span class="si">%s</span><span class="s2"> of donor of CEE not recognized&quot;</span>
                                 <span class="o">%</span> <span class="n">donor</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">common_envelope_option_for_lambda</span>
                <span class="o">==</span> <span class="s2">&quot;lambda_from_grid_final_values&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">donor_type</span> <span class="o">==</span> <span class="s1">&#39;CO_core&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">core_element_fraction_definition</span> <span class="o">==</span> <span class="mf">0.1</span><span class="p">:</span>
                    <span class="n">lambda_CE</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">lambda_CE_pure_He_star_10cent</span>
                    <span class="n">mc1_i</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">m_core_CE_pure_He_star_10cent</span>
                    <span class="n">rc1_i</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">r_core_CE_pure_He_star_10cent</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;An impossible core_definition was &quot;</span>
                                     <span class="s2">&quot;provided in calculate lambda function&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">donor_type</span> <span class="o">==</span> <span class="s1">&#39;He_core&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">core_element_fraction_definition</span> <span class="o">==</span> <span class="mf">0.01</span><span class="p">:</span>
                    <span class="n">lambda_CE</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">lambda_CE_1cent</span>
                    <span class="n">mc1_i</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">m_core_CE_1cent</span>
                    <span class="n">rc1_i</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">r_core_CE_1cent</span>
                <span class="k">elif</span> <span class="n">core_element_fraction_definition</span> <span class="o">==</span> <span class="mf">0.1</span><span class="p">:</span>
                    <span class="n">lambda_CE</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">lambda_CE_10cent</span>
                    <span class="n">mc1_i</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">m_core_CE_10cent</span>
                    <span class="n">rc1_i</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">r_core_CE_10cent</span>
                <span class="k">elif</span> <span class="n">core_element_fraction_definition</span> <span class="o">==</span> <span class="mf">0.3</span><span class="p">:</span>
                    <span class="n">lambda_CE</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">lambda_CE_30cent</span>
                    <span class="n">mc1_i</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">m_core_CE_30cent</span>
                    <span class="n">rc1_i</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">r_core_CE_30cent</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;An impossible core_definition was &quot;</span>
                                     <span class="s2">&quot;provided in calculate lambda function&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;An impossible CE donor-star type was &quot;</span>
                                 <span class="s2">&quot;provided in calculate lambda function&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;verbose for lambda_from_grid_final_values&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;core_element_fraction_definition :&quot;</span><span class="p">,</span>
                      <span class="n">core_element_fraction_definition</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lambda_CE : &quot;</span><span class="p">,</span> <span class="n">lambda_CE</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;donor state: &quot;</span><span class="p">,</span> <span class="n">donor</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;donor_type: &quot;</span><span class="p">,</span> <span class="n">donor_type</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;donor R, rc1_i (for CEE calculation), he_core_radius, &quot;</span>
                      <span class="s2">&quot;co_core_radius  = &quot;</span><span class="p">,</span> <span class="n">radius1</span><span class="p">,</span> <span class="n">rc1_i</span><span class="p">,</span>
                      <span class="n">donor</span><span class="o">.</span><span class="n">he_core_radius</span><span class="p">,</span> <span class="n">donor</span><span class="o">.</span><span class="n">co_core_radius</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;donor M, mc1_i (for CEE calculation), he_core_mass, &quot;</span>
                      <span class="s2">&quot;co_core_mass = &quot;</span><span class="p">,</span> <span class="n">m1_i</span><span class="p">,</span> <span class="n">mc1_i</span><span class="p">,</span>
                      <span class="n">donor</span><span class="o">.</span><span class="n">he_core_mass</span><span class="p">,</span> <span class="n">donor</span><span class="o">.</span><span class="n">co_core_mass</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">donor</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Profile does not exist -- Proceeding with &quot;</span>
                          <span class="s2">&quot;default_lambda alpha-CE prescription&quot;</span><span class="p">)</span>
            <span class="c1"># like in the &quot;default_lambda&quot; option</span>
            <span class="n">lambda_CE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">common_envelope_lambda_default</span>
            <span class="k">if</span> <span class="n">donor_type</span> <span class="o">==</span> <span class="s1">&#39;He_core&#39;</span><span class="p">:</span>
                <span class="n">mc1_i</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">he_core_mass</span>
                <span class="n">rc1_i</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">he_core_radius</span>
            <span class="k">elif</span> <span class="n">donor_type</span> <span class="o">==</span> <span class="s2">&quot;CO_core&quot;</span><span class="p">:</span>
                <span class="n">mc1_i</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">co_core_mass</span>
                <span class="n">rc1_i</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">co_core_radius</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;type = </span><span class="si">%s</span><span class="s2"> of donor of CEE not recognized&quot;</span>
                                 <span class="o">%</span> <span class="n">donor</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">valid_options</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lambda_from_profile_gravitational&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;lambda_from_profile_gravitational_plus_internal&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;lambda_from_profile_gravitational_plus_&quot;</span>
                             <span class="o">+</span> <span class="s2">&quot;internal_minus_recombination&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">common_envelope_option_for_lambda</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_options</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;common_envelope_option_for_lambda not a &quot;</span>
                                 <span class="s2">&quot;valid option - Should never occur&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            lambda_CE, mc1_i, rc1_i = \</span>
<span class="sd">                self.calculate_lambda_from_profile_duringstepCEE(</span>
<span class="sd">                    donor, core_element_fraction_definition, verbose)</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">lambda_CE</span><span class="p">,</span> <span class="n">mc1_i</span><span class="p">,</span> <span class="n">rc1_i</span> <span class="o">=</span> <span class="n">calculate_lambda_from_profile</span><span class="p">(</span>
                <span class="n">profile</span><span class="o">=</span><span class="n">donor</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="n">donor_star_state</span><span class="o">=</span><span class="n">donor</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
                <span class="n">m1_i</span><span class="o">=</span><span class="n">m1_i</span><span class="p">,</span> <span class="n">radius1</span><span class="o">=</span><span class="n">radius1</span><span class="p">,</span>
                <span class="n">common_envelope_option_for_lambda</span><span class="o">=</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">common_envelope_option_for_lambda</span><span class="p">),</span>
                <span class="n">core_element_fraction_definition</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">core_element_fraction_definition</span><span class="p">),</span>
                <span class="n">ind_core</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">common_envelope_alpha_thermal</span><span class="o">=</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">common_envelope_alpha_thermal</span><span class="p">),</span>
                <span class="n">tolerance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CEE_tolerance_err</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lambda_CE</span><span class="p">,</span> <span class="n">mc1_i</span><span class="p">,</span> <span class="n">rc1_i</span><span class="p">,</span> <span class="n">donor_type</span></div>

<div class="viewcode-block" id="StepCEE.CEE_simple_alpha_prescription"><a class="viewcode-back" href="../../../../api/posydon.binary_evol.CE.step_CEE.html#posydon.binary_evol.CE.step_CEE.StepCEE.CEE_simple_alpha_prescription">[docs]</a>    <span class="k">def</span> <span class="nf">CEE_simple_alpha_prescription</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">binary</span><span class="p">,</span> <span class="n">donor</span><span class="p">,</span> <span class="n">comp_star</span><span class="p">,</span> <span class="n">lambda1_CE</span><span class="p">,</span> <span class="n">mc1_i</span><span class="p">,</span> <span class="n">rc1_i</span><span class="p">,</span>
            <span class="n">donor_type</span><span class="p">,</span> <span class="n">lambda2_CE</span><span class="p">,</span> <span class="n">mc2_i</span><span class="p">,</span> <span class="n">rc2_i</span><span class="p">,</span> <span class="n">comp_type</span><span class="p">,</span> <span class="n">double_CE</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">common_envelope_option_after_succ_CEE</span><span class="o">=</span><span class="n">MODEL</span><span class="p">[</span>
                <span class="s1">&#39;common_envelope_option_after_succ_CEE&#39;</span><span class="p">],</span>
            <span class="n">core_definition_H_fraction</span><span class="o">=</span><span class="n">MODEL</span><span class="p">[</span><span class="s1">&#39;core_definition_H_fraction&#39;</span><span class="p">],</span>
            <span class="n">core_definition_He_fraction</span><span class="o">=</span><span class="n">MODEL</span><span class="p">[</span><span class="s1">&#39;core_definition_He_fraction&#39;</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply the alpha-lambda common-envelope prescription.</span>

<span class="sd">        It uses energetics to calculate the shrinakge of the orbit</span>
<span class="sd">        (and possible merger) of the two components, as well as upadate</span>
<span class="sd">        their new masses, during a common-envelope phase.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        binary : BinaryStar object</span>
<span class="sd">            Instance of the binary to evolve.</span>
<span class="sd">        donor : SingleStar object</span>
<span class="sd">            The donor star</span>
<span class="sd">        comp_star : SingleStar object</span>
<span class="sd">            The companion star</span>
<span class="sd">        lambda1_CE : float</span>
<span class="sd">            Lambda previously calculated for the donor&#39;s envelope</span>
<span class="sd">            binding energy.</span>
<span class="sd">        mc1_i : float</span>
<span class="sd">            core mass of the donor</span>
<span class="sd">        rc1_i : float</span>
<span class="sd">            core radius of the donor</span>
<span class="sd">        donor_type : string</span>
<span class="sd">            String dictating whether the donor has a H-envelope or He-envelope</span>
<span class="sd">        lambda2_CE : float</span>
<span class="sd">            Lambda previously calculated for the companion&#39;s envelope</span>
<span class="sd">            binding energy.</span>
<span class="sd">        mc2_i : float</span>
<span class="sd">            core mass of the companion</span>
<span class="sd">        rc2_i : float</span>
<span class="sd">            core radius of the companion</span>
<span class="sd">        comp_type : string</span>
<span class="sd">            String dictating whether the companion has a</span>
<span class="sd">            H-envelope or He-envelope.</span>
<span class="sd">        double_CE : bool</span>
<span class="sd">            In case we have a double CE situation.</span>
<span class="sd">        verbose : bool</span>
<span class="sd">            In case we want information about the CEE.</span>
<span class="sd">        common_envelope_option_after_succ_CEE: str</span>
<span class="sd">            Options are:</span>
<span class="sd">            1) &quot;core_replaced_noMT&quot;</span>
<span class="sd">                he_core_mass/radius (or co_core_mass/radius for CEE of</span>
<span class="sd">                stripped_He*) are replaced according to the new core boundary</span>
<span class="sd">                used for CEE (based on core_definition_H/He_fraction) but no</span>
<span class="sd">                other change in period after succesful ejection at</span>
<span class="sd">                alpha-lambda prescription.</span>
<span class="sd">            2) &quot;core_not_replaced_noMT&quot;</span>
<span class="sd">                he_core_mass/radius (or co_core_mass/radius for CEE of</span>
<span class="sd">                stripped_He*) staying as preCEE and no other change in period</span>
<span class="sd">                after succesful ejection at alpha-lambda prescription.</span>
<span class="sd">            3) &quot;core_not_replaced_stableMT&quot;</span>
<span class="sd">                he_core_mass/radius (or co_core_mass/radius for CEE of</span>
<span class="sd">                stripped_He*) staying as preCEE and after succesful ejection at</span>
<span class="sd">                alpha-lambda prescription, we assume an instantaneous stableMT</span>
<span class="sd">                phase (non-conservative, with mass lost from accretor) from the</span>
<span class="sd">                donor (or from donor and simultaneously the accretor at</span>
<span class="sd">                double_CE), taking away the extra &quot;core&quot; mass as defined by the</span>
<span class="sd">                core boundary used for CEE (based on</span>
<span class="sd">                core_definition_H/He_fraction).</span>
<span class="sd">            4) &quot;core_not_replaced_windloss&quot;</span>
<span class="sd">                he_core_mass/radius (or co_core_mass/radius for CEE of</span>
<span class="sd">                stripped_He*) staying as preCEE and after succesful ejection</span>
<span class="sd">                at alpha-lambda prescription, we assume a instantaneous</span>
<span class="sd">                windloss phase from the donor (or from donor and simultaneously</span>
<span class="sd">                the accretor at double_CE), taking away the extra &quot;core&quot; mass</span>
<span class="sd">                as defined by the core boundary used for CEE (based on</span>
<span class="sd">                core_definition_H/He_fraction).</span>
<span class="sd">        core_definition_H_fraction: float</span>
<span class="sd">            The value of the H abundance to define the envelope-core boundary</span>
<span class="sd">            in He_cores.</span>
<span class="sd">        core_definition_He_fraction: float</span>
<span class="sd">            The value of the He abundance to define the envelope-core boundary</span>
<span class="sd">            in CO_cores.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get star properties</span>
        <span class="n">m1_i</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">mass</span>
        <span class="n">radius1</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">donor</span><span class="o">.</span><span class="n">log_R</span>
        <span class="n">state1_i</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">state</span>
        <span class="n">m2_i</span> <span class="o">=</span> <span class="n">comp_star</span><span class="o">.</span><span class="n">mass</span>
        <span class="n">radius2</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">comp_star</span><span class="o">.</span><span class="n">log_R</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pre CE&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;binary event :&quot;</span><span class="p">,</span> <span class="n">binary</span><span class="o">.</span><span class="n">event</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;double CEE : &quot;</span><span class="p">,</span> <span class="n">double_CE</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;donor state: &quot;</span><span class="p">,</span> <span class="n">state1_i</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;donor mass / core mass = &quot;</span><span class="p">,</span> <span class="n">m1_i</span><span class="p">,</span> <span class="n">mc1_i</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;companion state: &quot;</span><span class="p">,</span> <span class="n">comp_star</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;companion mass / core mass = &quot;</span><span class="p">,</span> <span class="n">m2_i</span><span class="p">,</span> <span class="n">mc2_i</span><span class="p">)</span>

        <span class="c1"># Get binary parameters</span>
        <span class="n">period_i</span> <span class="o">=</span> <span class="n">binary</span><span class="o">.</span><span class="n">orbital_period</span>
        <span class="n">alpha_CE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">common_envelope_efficiency</span>

        <span class="c1"># calculate evolution of the orbit</span>
        <span class="n">ebind_i</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">const</span><span class="o">.</span><span class="n">standard_cgrav</span> <span class="o">/</span> <span class="n">lambda1_CE</span>
                   <span class="o">*</span> <span class="p">(</span><span class="n">m1_i</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">Msun</span> <span class="o">*</span> <span class="p">(</span><span class="n">m1_i</span> <span class="o">-</span> <span class="n">mc1_i</span><span class="p">)</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">Msun</span><span class="p">)</span>
                   <span class="o">/</span> <span class="p">(</span><span class="n">radius1</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">Rsun</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">double_CE</span><span class="p">:</span>
            <span class="n">ebind_i</span> <span class="o">+=</span> <span class="p">(</span><span class="o">-</span><span class="n">const</span><span class="o">.</span><span class="n">standard_cgrav</span> <span class="o">/</span> <span class="n">lambda2_CE</span>
                        <span class="o">*</span> <span class="p">(</span><span class="n">m2_i</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">Msun</span> <span class="o">*</span> <span class="p">(</span><span class="n">m2_i</span> <span class="o">-</span> <span class="n">mc2_i</span><span class="p">)</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">Msun</span><span class="p">)</span>
                        <span class="o">/</span> <span class="p">(</span><span class="n">radius2</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">Rsun</span><span class="p">))</span>

        <span class="n">separation_i</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">Rsun</span> <span class="o">*</span> <span class="n">cf</span><span class="o">.</span><span class="n">orbital_separation_from_period</span><span class="p">(</span>
            <span class="n">period_i</span><span class="p">,</span> <span class="n">m1_i</span><span class="p">,</span> <span class="n">m2_i</span><span class="p">)</span>   <span class="c1"># in cgs units</span>
        <span class="n">eorb_i</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">standard_cgrav</span> <span class="o">*</span> <span class="n">m1_i</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">Msun</span>
                  <span class="o">*</span> <span class="n">m2_i</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">Msun</span> <span class="o">/</span> <span class="n">separation_i</span><span class="p">)</span>
        <span class="c1"># TODO use core masses or total masses?</span>

        <span class="n">eorb_postCEE</span> <span class="o">=</span> <span class="n">eorb_i</span> <span class="o">+</span> <span class="n">ebind_i</span><span class="o">/</span><span class="n">alpha_CE</span>

        <span class="n">separation_postCEE</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">standard_cgrav</span> <span class="o">*</span> <span class="n">mc1_i</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">Msun</span>
                              <span class="o">*</span> <span class="n">mc2_i</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">Msun</span> <span class="o">/</span> <span class="n">eorb_postCEE</span><span class="p">)</span>

        <span class="c1"># Check to make sure final orbital separation is positive</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">separation_postCEE</span> <span class="o">&gt;</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">CEE_tolerance_err</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;CEE problem, negative postCEE separation&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CEE alpha-lambda prescription&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ebind_i&quot;</span><span class="p">,</span> <span class="n">ebind_i</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;eorb_i&quot;</span><span class="p">,</span> <span class="n">eorb_i</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;eorb_postCEE&quot;</span><span class="p">,</span> <span class="n">eorb_postCEE</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DEorb&quot;</span><span class="p">,</span> <span class="n">eorb_postCEE</span> <span class="o">-</span> <span class="n">eorb_i</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;separation_i in Rsun&quot;</span><span class="p">,</span> <span class="n">separation_i</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">Rsun</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;separation_postCEE in Rsun&quot;</span><span class="p">,</span> <span class="n">separation_postCEE</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">Rsun</span><span class="p">)</span>

        <span class="c1"># now we check if the roche Lobe of any of the cores that spiralled-in</span>
        <span class="c1"># will be filled if reached this final separation</span>
        <span class="n">RL1</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">roche_lobe_radius</span><span class="p">(</span><span class="n">mc1_i</span><span class="o">/</span><span class="n">mc2_i</span><span class="p">,</span> <span class="n">separation_postCEE</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">Rsun</span><span class="p">)</span>
        <span class="n">RL2</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">roche_lobe_radius</span><span class="p">(</span><span class="n">mc2_i</span><span class="o">/</span><span class="n">mc1_i</span><span class="p">,</span> <span class="n">separation_postCEE</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">Rsun</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;donor radius / core radius / RL1:&quot;</span><span class="p">,</span> <span class="n">radius1</span><span class="p">,</span> <span class="n">rc1_i</span><span class="p">,</span> <span class="n">RL1</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;companion radius / core radius / RL2:&quot;</span><span class="p">,</span> <span class="n">radius2</span><span class="p">,</span> <span class="n">rc2_i</span><span class="p">,</span> <span class="n">RL2</span><span class="p">)</span>

        <span class="c1"># Check if binary merges or survives</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">rc1_i</span> <span class="o">-</span> <span class="n">RL1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CEE_tolerance_err</span>
                <span class="ow">and</span> <span class="p">(</span><span class="n">rc2_i</span> <span class="o">-</span> <span class="n">RL2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CEE_tolerance_err</span><span class="p">):</span>
            <span class="c1"># system survives CEE, the whole CE is ejected</span>
            <span class="c1"># and the new orbital separation for the cores is returned</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;system survives CEE, the whole CE is ejected and the &quot;</span>
                      <span class="s2">&quot;new orbital separation for the cores is returned&quot;</span><span class="p">)</span>

            <span class="c1"># possible change of core masses</span>
            <span class="k">if</span> <span class="n">common_envelope_option_after_succ_CEE</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;core_replaced_noMT&quot;</span><span class="p">]:</span>
                <span class="n">mc1_f</span> <span class="o">=</span> <span class="n">mc1_i</span>
                <span class="n">rc1_f</span> <span class="o">=</span> <span class="n">rc1_i</span>
                <span class="n">mc2_f</span> <span class="o">=</span> <span class="n">mc2_i</span>
                <span class="n">rc2_f</span> <span class="o">=</span> <span class="n">rc2_i</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;m1 core mass pre CEE (He,CO) / to after CEE : &quot;</span><span class="p">,</span>
                          <span class="n">donor</span><span class="o">.</span><span class="n">he_core_mass</span><span class="p">,</span> <span class="n">donor</span><span class="o">.</span><span class="n">co_core_mass</span><span class="p">,</span> <span class="n">mc1_f</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;m1 core radius pre CEE (He,CO) / to after CEE : &quot;</span><span class="p">,</span>
                          <span class="n">donor</span><span class="o">.</span><span class="n">he_core_radius</span><span class="p">,</span> <span class="n">donor</span><span class="o">.</span><span class="n">co_core_radius</span><span class="p">,</span> <span class="n">rc1_f</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;m2 core mass pre CEE (He,CO) / to after CEE : &quot;</span><span class="p">,</span>
                          <span class="n">comp_star</span><span class="o">.</span><span class="n">he_core_mass</span><span class="p">,</span> <span class="n">comp_star</span><span class="o">.</span><span class="n">co_core_mass</span><span class="p">,</span> <span class="n">mc2_f</span>
                          <span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;m2 core radius pre CEE (He,CO) / to after CEE : &quot;</span><span class="p">,</span>
                          <span class="n">comp_star</span><span class="o">.</span><span class="n">he_core_radius</span><span class="p">,</span>
                          <span class="n">comp_star</span><span class="o">.</span><span class="n">co_core_radius</span><span class="p">,</span> <span class="n">rc2_f</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">common_envelope_option_after_succ_CEE</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s2">&quot;core_not_replaced_noMT&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;core_not_replaced_stableMT&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;core_not_replaced_windloss&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">donor_type</span> <span class="o">==</span> <span class="s1">&#39;He_core&#39;</span><span class="p">:</span>
                    <span class="n">mc1_f</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">he_core_mass</span>
                    <span class="n">rc1_f</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">he_core_radius</span>
                <span class="k">elif</span> <span class="n">donor_type</span> <span class="o">==</span> <span class="s2">&quot;CO_core&quot;</span><span class="p">:</span>
                    <span class="n">mc1_f</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">co_core_mass</span>
                    <span class="n">rc1_f</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">co_core_radius</span>
                <span class="k">if</span> <span class="n">mc1_f</span> <span class="o">&gt;</span> <span class="n">mc1_i</span><span class="p">:</span>
                    <span class="n">mc1_f</span> <span class="o">=</span> <span class="n">mc1_i</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="s2">&quot;donor core mass final (after even stable, postCEE MT)&quot;</span>
                        <span class="s2">&quot; assumed higher than postCEE core mass. Equalized to &quot;</span>
                        <span class="s2">&quot;postCEE mass&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">double_CE</span><span class="p">:</span>
                    <span class="n">mc2_f</span> <span class="o">=</span> <span class="n">mc2_i</span>
                    <span class="n">rc2_f</span> <span class="o">=</span> <span class="n">rc2_i</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">comp_type</span> <span class="o">==</span> <span class="s1">&#39;He_core&#39;</span><span class="p">:</span>
                        <span class="n">mc2_f</span> <span class="o">=</span> <span class="n">comp_star</span><span class="o">.</span><span class="n">he_core_mass</span>
                        <span class="n">rc2_f</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">he_core_radius</span>
                    <span class="k">elif</span> <span class="n">comp_type</span> <span class="o">==</span> <span class="s2">&quot;CO_core&quot;</span><span class="p">:</span>
                        <span class="n">mc2_f</span> <span class="o">=</span> <span class="n">comp_star</span><span class="o">.</span><span class="n">co_core_mass</span>
                        <span class="n">rc2_f</span> <span class="o">=</span> <span class="n">donor</span><span class="o">.</span><span class="n">co_core_radius</span>
                    <span class="k">elif</span> <span class="n">comp_type</span> <span class="o">==</span> <span class="s2">&quot;not_giant_companion&quot;</span><span class="p">:</span>
                        <span class="n">mc2_f</span> <span class="o">=</span> <span class="n">comp_star</span><span class="o">.</span><span class="n">mass</span>
                        <span class="n">rc2_f</span> <span class="o">=</span> <span class="mf">10.</span><span class="o">**</span><span class="p">(</span><span class="n">comp_star</span><span class="o">.</span><span class="n">log_R</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">mc2_f</span> <span class="o">&gt;</span> <span class="n">mc2_i</span><span class="p">:</span>
                        <span class="n">mc2_f</span> <span class="o">=</span> <span class="n">mc2_i</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;accretor&#39;s core mass final (after even &quot;</span>
                                      <span class="s2">&quot;non-conservative stable, postCEE MT) &quot;</span>
                                      <span class="s2">&quot;assumed higher that postCEE core mass. &quot;</span>
                                      <span class="s2">&quot;Equialized to postCEE mass&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;difference between m1 core mass defined by CEE step&quot;</span>
                          <span class="s2">&quot; / to the final one as pre CEE : &quot;</span><span class="p">,</span> <span class="n">mc1_f</span><span class="p">,</span> <span class="n">mc1_i</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;difference between r1 core mass defined by CEE step&quot;</span>
                          <span class="s2">&quot; / to the final one as pre CEE : &quot;</span><span class="p">,</span> <span class="n">rc1_f</span><span class="p">,</span> <span class="n">rc1_i</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;difference between m2 core mass defined by CEE step&quot;</span>
                          <span class="s2">&quot; / to the final one as pre CEE : &quot;</span><span class="p">,</span> <span class="n">mc2_f</span><span class="p">,</span> <span class="n">mc2_i</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;difference between r2 core mass defined by CEE step&quot;</span>
                          <span class="s2">&quot; / to the final one as pre CEE : &quot;</span><span class="p">,</span> <span class="n">rc2_f</span><span class="p">,</span> <span class="n">rc2_i</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Not accepted option in common_envelope_option_after_succ_&quot;</span>
                    <span class="s2">&quot;CEE = </span><span class="si">{}</span><span class="s2">, dont know how to proceed&quot;</span><span class="o">.</span>
                    <span class="nb">format</span><span class="p">(</span><span class="n">common_envelope_option_after_succ_CEE</span><span class="p">))</span>

            <span class="c1"># possible change of orbital period after CEE</span>
            <span class="n">orbital_period_postCEE</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">orbital_period_from_separation</span><span class="p">(</span>
                <span class="n">separation_postCEE</span> <span class="o">/</span> <span class="n">const</span><span class="o">.</span><span class="n">Rsun</span><span class="p">,</span> <span class="n">mc1_i</span><span class="p">,</span> <span class="n">mc2_i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">common_envelope_option_after_succ_CEE</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s2">&quot;core_replaced_noMT&quot;</span><span class="p">,</span> <span class="s2">&quot;core_not_replaced_noMT&quot;</span><span class="p">]:</span>
                <span class="n">orbital_period_f</span> <span class="o">=</span> <span class="n">orbital_period_postCEE</span>
            <span class="k">elif</span> <span class="n">common_envelope_option_after_succ_CEE</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s2">&quot;core_not_replaced_stableMT&quot;</span><span class="p">]:</span>
                <span class="c1"># An assumed stable mass transfer case after postCEE with</span>
                <span class="c1"># fully non-conservative MT and mass lost from the vicinity</span>
                <span class="c1"># of the accretor:</span>
                <span class="n">orbital_period_f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">period_change_stabe_MT</span><span class="p">(</span>
                    <span class="n">orbital_period_postCEE</span><span class="p">,</span> <span class="n">Mdon_i</span><span class="o">=</span><span class="n">mc1_i</span><span class="p">,</span> <span class="n">Mdon_f</span><span class="o">=</span><span class="n">mc1_f</span><span class="p">,</span>
                    <span class="n">Macc_i</span><span class="o">=</span><span class="n">mc2_i</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">double_CE</span><span class="p">:</span>
                    <span class="c1"># a reverse stable MT assumed to be happening</span>
                    <span class="c1"># at the same time</span>
                    <span class="n">orbital_period_f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">period_change_stabe_MT</span><span class="p">(</span>
                        <span class="n">orbital_period_f</span><span class="p">,</span> <span class="n">Mdon_i</span><span class="o">=</span><span class="n">mc2_i</span><span class="p">,</span> <span class="n">Mdon_f</span><span class="o">=</span><span class="n">mc2_f</span><span class="p">,</span>
                        <span class="n">Macc_i</span><span class="o">=</span><span class="n">mc1_i</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;during the assumed stable MT phase after postCE&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;with &#39;common_envelope_option_after_succ_CEE&#39; :&quot;</span><span class="p">,</span>
                          <span class="n">common_envelope_option_after_succ_CEE</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;the orbit cahnged from postCEE : &quot;</span><span class="p">,</span>
                          <span class="n">orbital_period_postCEE</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;to : &quot;</span><span class="p">,</span> <span class="n">orbital_period_f</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">common_envelope_option_after_succ_CEE</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s2">&quot;core_not_replaced_windloss&quot;</span><span class="p">]:</span>
                <span class="c1"># An assumed wind loss after postCEE with mass lost</span>
                <span class="c1"># from the vicinity of the donor</span>
                <span class="n">orbital_period_f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">period_change_stabe_MT</span><span class="p">(</span>
                    <span class="n">orbital_period_postCEE</span><span class="p">,</span> <span class="n">Mdon_i</span><span class="o">=</span><span class="n">mc1_i</span><span class="p">,</span> <span class="n">Mdon_f</span><span class="o">=</span><span class="n">mc1_f</span><span class="p">,</span>
                    <span class="n">Macc_i</span><span class="o">=</span><span class="n">mc2_i</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">double_CE</span><span class="p">:</span>
                    <span class="c1"># a wind mass loss from the 2nd star assumed to be</span>
                    <span class="c1"># happening at the same time</span>
                    <span class="n">orbital_period_f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">period_change_stabe_MT</span><span class="p">(</span>
                        <span class="n">orbital_period_f</span><span class="p">,</span> <span class="n">Mdon_i</span><span class="o">=</span><span class="n">mc2_i</span><span class="p">,</span> <span class="n">Mdon_f</span><span class="o">=</span><span class="n">mc2_f</span><span class="p">,</span>
                        <span class="n">Macc_i</span><span class="o">=</span><span class="n">mc1_i</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;during the assumed windloss phase after postCE&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;with &#39;common_envelope_option_after_succ_CEE&#39; :&quot;</span><span class="p">,</span>
                          <span class="n">common_envelope_option_after_succ_CEE</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;the orbit cahnged from postCEE : &quot;</span><span class="p">,</span>
                          <span class="n">orbital_period_postCEE</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;to : &quot;</span><span class="p">,</span> <span class="n">orbital_period_f</span><span class="p">)</span>
            <span class="n">separation_f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">orbital_separation_from_period</span><span class="p">(</span><span class="n">orbital_period_f</span><span class="p">,</span>
                                                             <span class="n">mc1_f</span><span class="p">,</span> <span class="n">mc2_f</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">state1_i</span> <span class="o">==</span> <span class="s1">&#39;stripped_He_Central_He_depleted&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">donor</span> <span class="o">==</span> <span class="n">binary</span><span class="o">.</span><span class="n">star_1</span><span class="p">:</span>
                    <span class="n">binary</span><span class="o">.</span><span class="n">event</span> <span class="o">=</span> <span class="s1">&#39;CC1&#39;</span>
                <span class="k">elif</span> <span class="n">donor</span> <span class="o">==</span> <span class="n">binary</span><span class="o">.</span><span class="n">star_2</span><span class="p">:</span>
                    <span class="n">binary</span><span class="o">.</span><span class="n">event</span> <span class="o">=</span> <span class="s1">&#39;CC2&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">binary</span><span class="o">.</span><span class="n">event</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># Adjust binary properties</span>
            <span class="n">binary</span><span class="o">.</span><span class="n">separation</span> <span class="o">=</span> <span class="n">separation_f</span>
            <span class="n">binary</span><span class="o">.</span><span class="n">orbital_period</span> <span class="o">=</span> <span class="n">orbital_period_f</span>
            <span class="n">binary</span><span class="o">.</span><span class="n">eccentricity</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">binary</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s1">&#39;detached&#39;</span>
            <span class="c1"># binary.event = None</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">BINARYPROPERTIES</span><span class="p">:</span>
                <span class="c1"># the binary attributes that are changed in the CE step</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;separation&quot;</span><span class="p">,</span> <span class="s2">&quot;orbital_period&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;eccentricity&quot;</span><span class="p">,</span> <span class="s2">&quot;state&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">]:</span>
                    <span class="c1"># the binary attributes that keep the same value from the</span>
                    <span class="c1"># previous step</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;V_sys&quot;</span><span class="p">,</span> <span class="s2">&quot;mass_transfer_case&quot;</span><span class="p">,</span>
                                   <span class="s2">&quot;nearest_neighbour_distance&quot;</span><span class="p">]:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>  <span class="c1"># the rest become np.nan</span>

            <span class="n">stars</span> <span class="o">=</span> <span class="p">[</span><span class="n">donor</span><span class="p">]</span>
            <span class="n">star_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">donor_type</span><span class="p">]</span>
            <span class="n">core_masses</span> <span class="o">=</span> <span class="p">[</span><span class="n">mc1_f</span><span class="p">]</span>
            <span class="n">core_radii</span> <span class="o">=</span> <span class="p">[</span><span class="n">rc1_f</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CEE succesfully ejected&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;new orbital period = &quot;</span><span class="p">,</span> <span class="n">binary</span><span class="o">.</span><span class="n">orbital_period</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;binary event : &quot;</span><span class="p">,</span> <span class="n">binary</span><span class="o">.</span><span class="n">event</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;double CEE : &quot;</span><span class="p">,</span> <span class="n">double_CE</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">double_CE</span><span class="p">:</span>
                <span class="n">stars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp_star</span><span class="p">)</span>
                <span class="n">star_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp_type</span><span class="p">)</span>
                <span class="n">core_masses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mc2_f</span><span class="p">)</span>
                <span class="n">core_radii</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rc2_f</span><span class="p">)</span>

            <span class="c1"># Adjust donor star properties</span>
            <span class="k">for</span> <span class="n">star</span><span class="p">,</span> <span class="n">star_type</span><span class="p">,</span> <span class="n">core_mass</span><span class="p">,</span> <span class="n">core_radius</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="n">stars</span><span class="p">,</span> <span class="n">star_types</span><span class="p">,</span> <span class="n">core_masses</span><span class="p">,</span> <span class="n">core_radii</span><span class="p">):</span>
                <span class="n">star</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="n">core_mass</span>
                <span class="n">star</span><span class="o">.</span><span class="n">log_R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">core_radius</span><span class="p">)</span>
                <span class="n">attributes_changing</span> <span class="o">=</span> <span class="p">[</span>
                                        <span class="s2">&quot;mass&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;log_R&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;state&quot;</span>
                                        <span class="p">]</span>

                <span class="k">if</span> <span class="n">star_type</span> <span class="o">==</span> <span class="s1">&#39;He_core&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">common_envelope_option_after_succ_CEE</span> <span class="ow">in</span> <span class="p">[</span>
                            <span class="s2">&quot;core_replaced_noMT&quot;</span><span class="p">]:</span>
                        <span class="n">star</span><span class="o">.</span><span class="n">surface_h1</span> <span class="o">=</span> <span class="n">core_definition_H_fraction</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">star</span><span class="o">.</span><span class="n">surface_h1</span> <span class="o">=</span> <span class="mf">0.01</span>
                    <span class="n">star</span><span class="o">.</span><span class="n">he_core_mass</span> <span class="o">=</span> <span class="n">core_mass</span>
                    <span class="n">star</span><span class="o">.</span><span class="n">he_core_radius</span> <span class="o">=</span> <span class="n">core_radius</span>
                    <span class="k">if</span> <span class="n">star</span><span class="o">.</span><span class="n">metallicity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">star</span><span class="o">.</span><span class="n">surface_he4</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">star</span><span class="o">.</span><span class="n">surface_h1</span> <span class="o">-</span> <span class="mf">0.0142</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">star</span><span class="o">.</span><span class="n">surface_he4</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">star</span><span class="o">.</span><span class="n">surface_h1</span><span class="o">-</span><span class="n">star</span><span class="o">.</span><span class="n">metallicity</span>
                    <span class="n">star</span><span class="o">.</span><span class="n">log_LH</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1e99</span>
                    <span class="n">attributes_changing</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
                                            <span class="s2">&quot;surface_h1&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;surface_he4&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;log_LH&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;log_LHe&quot;</span><span class="p">,</span>
                                            <span class="s1">&#39;he_core_mass&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;he_core_radius&#39;</span>
                        <span class="p">])</span>
                <span class="k">elif</span> <span class="n">star_type</span> <span class="o">==</span> <span class="s1">&#39;CO_core&#39;</span><span class="p">:</span>
                    <span class="n">star</span><span class="o">.</span><span class="n">he_core_mass</span> <span class="o">=</span> <span class="n">core_mass</span>
                    <span class="n">star</span><span class="o">.</span><span class="n">he_core_radius</span> <span class="o">=</span> <span class="n">core_radius</span>
                    <span class="n">star</span><span class="o">.</span><span class="n">co_core_mass</span> <span class="o">=</span> <span class="n">core_mass</span>
                    <span class="n">star</span><span class="o">.</span><span class="n">co_core_radius</span> <span class="o">=</span> <span class="n">core_radius</span>
                    <span class="n">star</span><span class="o">.</span><span class="n">surface_h1</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="k">if</span> <span class="n">common_envelope_option_after_succ_CEE</span> <span class="ow">in</span> <span class="p">[</span>
                            <span class="s2">&quot;core_replaced_noMT&quot;</span><span class="p">]:</span>
                        <span class="n">star</span><span class="o">.</span><span class="n">surface_he4</span> <span class="o">=</span> <span class="n">core_definition_He_fraction</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">star</span><span class="o">.</span><span class="n">surface_he4</span> <span class="o">=</span> <span class="mf">0.1</span>
                    <span class="n">star</span><span class="o">.</span><span class="n">log_LH</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1e99</span>
                    <span class="n">star</span><span class="o">.</span><span class="n">log_LHe</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1e99</span>
                    <span class="n">attributes_changing</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
                                            <span class="s2">&quot;surface_h1&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;surface_he4&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;log_LH&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;log_LHe&quot;</span><span class="p">,</span>
                                            <span class="s1">&#39;he_core_mass&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;he_core_radius&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;co_core_mass&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;co_core_radius&#39;</span>

                        <span class="p">])</span>
                <span class="k">elif</span> <span class="n">star_type</span> <span class="o">==</span> <span class="s2">&quot;not_giant_companion&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognized star type:&quot;</span><span class="p">,</span> <span class="n">star_type</span><span class="p">)</span>

                <span class="n">state_old</span> <span class="o">=</span> <span class="n">star</span><span class="o">.</span><span class="n">state</span>
                <span class="n">star</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">check_state_of_star</span><span class="p">(</span><span class="n">star</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;star state of before/ after CE : &quot;</span><span class="p">,</span>
                          <span class="n">state_old</span><span class="p">,</span> <span class="n">star</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">STARPROPERTIES</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attributes_changing</span><span class="p">:</span>
                        <span class="c1"># the singlestar attributes that are changed</span>
                        <span class="c1"># in the CE step</span>

                        <span class="c1"># the singlestar attributes that keep the same value</span>
                        <span class="c1"># from previous step if not in attributes_changing</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
                                <span class="s2">&quot;surface_h1&quot;</span><span class="p">,</span> <span class="s2">&quot;surface_he4&quot;</span><span class="p">,</span> <span class="s2">&quot;log_LH&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;log_LHe&quot;</span><span class="p">,</span> <span class="s2">&quot;he_core_mass&quot;</span><span class="p">,</span> <span class="s2">&quot;he_core_radius&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;co_core_mass&quot;</span><span class="p">,</span> <span class="s2">&quot;co_core_radius&quot;</span><span class="p">,</span> <span class="s2">&quot;center_h1&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;center_he4&quot;</span><span class="p">,</span> <span class="s2">&quot;center_c12&quot;</span><span class="p">,</span> <span class="s2">&quot;center_o16&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;center_n14&quot;</span><span class="p">,</span> <span class="s2">&quot;metallicity&quot;</span><span class="p">,</span> <span class="s2">&quot;log_LZ&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;log_Lnuc&quot;</span><span class="p">,</span> <span class="s2">&quot;c12_c12&quot;</span><span class="p">,</span> <span class="s2">&quot;center_gamma&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;avg_c_in_c_core&quot;</span><span class="p">]:</span>
                            <span class="nb">setattr</span><span class="p">(</span><span class="n">star</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>  <span class="c1"># the rest become NaN&#39;s</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># system merges</span>
            <span class="n">binary</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s1">&#39;merged&#39;</span>
            <span class="n">binary</span><span class="o">.</span><span class="n">event</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">BINARYPROPERTIES</span><span class="p">:</span>
                <span class="c1"># the binary attributes that are changed in the CE step</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="s1">&#39;V_sys&#39;</span><span class="p">,</span> <span class="s1">&#39;mass_transfer_case&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;nearest_neighbour_distance&#39;</span><span class="p">]:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>    <span class="c1"># the rest become np.nan</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;mass_transfer_case&#39;</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">)</span>
            <span class="c1"># binary.event = &#39;END&#39;</span>
            <span class="n">stars</span> <span class="o">=</span> <span class="p">[</span><span class="n">donor</span><span class="p">,</span> <span class="n">comp_star</span><span class="p">]</span>
            <span class="c1"># for now we just add all initial mass to the (merger) star_1</span>
            <span class="n">masses</span> <span class="o">=</span> <span class="p">[</span><span class="n">m1_i</span><span class="o">+</span><span class="n">m2_i</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span>
            <span class="n">star_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">donor</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">comp_star</span><span class="o">.</span><span class="n">state</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">star</span><span class="p">,</span> <span class="n">star_state</span><span class="p">,</span> <span class="n">mass</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">stars</span><span class="p">,</span> <span class="n">star_states</span><span class="p">,</span> <span class="n">masses</span><span class="p">):</span>
                <span class="n">star</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="n">mass</span>
                <span class="n">star</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">star_state</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">STARPROPERTIES</span><span class="p">:</span>
                    <span class="c1"># the binary attributes that are changed in the CE step</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;mass&quot;</span><span class="p">,</span> <span class="s2">&quot;state&quot;</span><span class="p">]:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">star</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;system merges due to one of the two star&#39;s core filling&quot;</span>
                      <span class="s2">&quot;its RL&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rdonor core vs RLdonor core = &quot;</span><span class="p">,</span> <span class="n">rc1_i</span><span class="p">,</span> <span class="n">RL1</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rcompanion vs RLcompanion= &quot;</span><span class="p">,</span> <span class="n">rc2_i</span><span class="p">,</span> <span class="n">RL2</span><span class="p">)</span>

        <span class="k">return</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Tassos Fragos.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      Version: 1.0.5
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        
        <dl>
            <dt> v2</dt>
            
            <dd><a href="https://posydon.org/POSYDON/v2.0.6/index.html">2.0</a></dd>
            
            <dd><a href="https://posydon.org/POSYDON/v2.1.7/index.html">2.1</a></dd>
            
            <dd><a href="https://posydon.org/POSYDON/v2.2.0/index.html">2.2</a></dd>
            
        </dl>
        
        <dl>
            <dt> v1</dt>
            
            <dd><a href="https://posydon.org/POSYDON/v1.0.5/index.html">1.0</a></dd>
            
        </dl>
        
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>